<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/MovFileIntegrityChecker/Program.Legacy.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/MovFileIntegrityChecker/Program.Legacy.cs" />
              <option name="originalContent" value="using System.Text;&#10;using System.Diagnostics;&#10;using System.Globalization;&#10;using System.Text.Json;&#10;using System.Text.Json.Serialization;&#10;using MovFileIntegrityChecker.Models;&#10;using MovFileIntegrityChecker.Services;&#10;using MovFileIntegrityChecker.Utilities;&#10;&#10;namespace MovFileIntegrityChecker&#10;{&#10;    public static class MovIntegrityChecker&#10;    {&#10;        // Common MOV/MP4 atom types&#10;        private static readonly HashSet&lt;string&gt; ValidAtomTypes = new()&#10;        {&#10;            &quot;ftyp&quot;, &quot;moov&quot;, &quot;mdat&quot;, &quot;free&quot;, &quot;skip&quot;, &quot;wide&quot;, &quot;pnot&quot;,&#10;            &quot;mvhd&quot;, &quot;trak&quot;, &quot;tkhd&quot;, &quot;mdia&quot;, &quot;mdhd&quot;, &quot;hdlr&quot;, &quot;minf&quot;,&#10;            &quot;vmhd&quot;, &quot;smhd&quot;, &quot;dinf&quot;, &quot;stbl&quot;, &quot;stsd&quot;, &quot;stts&quot;, &quot;stsc&quot;,&#10;            &quot;stsz&quot;, &quot;stco&quot;, &quot;co64&quot;, &quot;edts&quot;, &quot;elst&quot;, &quot;udta&quot;, &quot;meta&quot;&#10;        };&#10;&#10;        public class AtomInfo&#10;        {&#10;            public string Type       { get; set; } = string.Empty;&#10;            public long   Size       { get; set; }&#10;            public long   Offset     { get; set; }&#10;            public bool   IsComplete { get; set; }&#10;        }&#10;&#10;        // JSON Report Classes&#10;        public class JsonFileMetadata&#10;        {&#10;            [JsonPropertyName(&quot;fileName&quot;)]&#10;            public string FileName { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;fullPath&quot;)]&#10;            public string FullPath { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;fileSizeBytes&quot;)]&#10;            public long FileSizeBytes { get; set; }&#10;&#10;            [JsonPropertyName(&quot;fileSizeMB&quot;)]&#10;            public double FileSizeMB { get; set; }&#10;&#10;            [JsonPropertyName(&quot;creationTimeUtc&quot;)]&#10;            public DateTime CreationTimeUtc { get; set; }&#10;&#10;            [JsonPropertyName(&quot;lastModifiedTimeUtc&quot;)]&#10;            public DateTime LastModifiedTimeUtc { get; set; }&#10;&#10;            [JsonPropertyName(&quot;lastAccessTimeUtc&quot;)]&#10;            public DateTime LastAccessTimeUtc { get; set; }&#10;&#10;            [JsonPropertyName(&quot;fileExtension&quot;)]&#10;            public string FileExtension { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;isReadOnly&quot;)]&#10;            public bool IsReadOnly { get; set; }&#10;&#10;            [JsonPropertyName(&quot;attributes&quot;)]&#10;            public string Attributes { get; set; } = string.Empty;&#10;        }&#10;&#10;        public class JsonVideoDuration&#10;        {&#10;            [JsonPropertyName(&quot;totalDurationSeconds&quot;)]&#10;            public double TotalDurationSeconds { get; set; }&#10;&#10;            [JsonPropertyName(&quot;totalDurationFormatted&quot;)]&#10;            public string TotalDurationFormatted { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;playableDurationSeconds&quot;)]&#10;            public double PlayableDurationSeconds { get; set; }&#10;&#10;            [JsonPropertyName(&quot;playableDurationFormatted&quot;)]&#10;            public string PlayableDurationFormatted { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;missingDurationSeconds&quot;)]&#10;            public double MissingDurationSeconds { get; set; }&#10;&#10;            [JsonPropertyName(&quot;missingDurationFormatted&quot;)]&#10;            public string MissingDurationFormatted { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;playablePercentage&quot;)]&#10;            public double PlayablePercentage { get; set; }&#10;&#10;            [JsonPropertyName(&quot;corruptedPercentage&quot;)]&#10;            public double CorruptedPercentage { get; set; }&#10;        }&#10;&#10;        public class JsonAtomInfo&#10;        {&#10;            [JsonPropertyName(&quot;type&quot;)]&#10;            public string Type { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;sizeBytes&quot;)]&#10;            public long SizeBytes { get; set; }&#10;&#10;            [JsonPropertyName(&quot;offsetBytes&quot;)]&#10;            public long OffsetBytes { get; set; }&#10;&#10;            [JsonPropertyName(&quot;isComplete&quot;)]&#10;            public bool IsComplete { get; set; }&#10;&#10;            [JsonPropertyName(&quot;isKnownType&quot;)]&#10;            public bool IsKnownType { get; set; }&#10;        }&#10;&#10;        public class JsonIntegrityAnalysis&#10;        {&#10;            [JsonPropertyName(&quot;bytesValidated&quot;)]&#10;            public long BytesValidated { get; set; }&#10;&#10;            [JsonPropertyName(&quot;validationPercentage&quot;)]&#10;            public double ValidationPercentage { get; set; }&#10;&#10;            [JsonPropertyName(&quot;atomsFound&quot;)]&#10;            public int AtomsFound { get; set; }&#10;&#10;            [JsonPropertyName(&quot;hasStructuralIssues&quot;)]&#10;            public bool HasStructuralIssues { get; set; }&#10;&#10;            [JsonPropertyName(&quot;issues&quot;)]&#10;            public List&lt;string&gt; Issues { get; set; } = new();&#10;&#10;            [JsonPropertyName(&quot;atoms&quot;)]&#10;            public List&lt;JsonAtomInfo&gt; Atoms { get; set; } = new();&#10;&#10;            [JsonPropertyName(&quot;hasRequiredAtoms&quot;)]&#10;            public JsonRequiredAtoms HasRequiredAtoms { get; set; } = new();&#10;        }&#10;&#10;        public class JsonRequiredAtoms&#10;        {&#10;            [JsonPropertyName(&quot;ftyp&quot;)]&#10;            public bool Ftyp { get; set; }&#10;&#10;            [JsonPropertyName(&quot;moov&quot;)]&#10;            public bool Moov { get; set; }&#10;&#10;            [JsonPropertyName(&quot;mdat&quot;)]&#10;            public bool Mdat { get; set; }&#10;        }&#10;&#10;        public class JsonCorruptionReport&#10;        {&#10;            [JsonPropertyName(&quot;reportVersion&quot;)]&#10;            public string ReportVersion { get; set; } = &quot;1.0&quot;;&#10;&#10;            [JsonPropertyName(&quot;generatedByTool&quot;)]&#10;            public string GeneratedByTool { get; set; } = &quot;MovFileIntegrityChecker&quot;;&#10;&#10;            [JsonPropertyName(&quot;evaluationTimeUtc&quot;)]&#10;            public DateTime EvaluationTimeUtc { get; set; }&#10;&#10;            [JsonPropertyName(&quot;evaluationTimeLocal&quot;)]&#10;            public DateTime EvaluationTimeLocal { get; set; }&#10;&#10;            [JsonPropertyName(&quot;fileMetadata&quot;)]&#10;            public JsonFileMetadata FileMetadata { get; set; } = new();&#10;&#10;            [JsonPropertyName(&quot;videoDuration&quot;)]&#10;            public JsonVideoDuration? VideoDuration { get; set; }&#10;&#10;            [JsonPropertyName(&quot;integrityAnalysis&quot;)]&#10;            public JsonIntegrityAnalysis IntegrityAnalysis { get; set; } = new();&#10;&#10;            [JsonPropertyName(&quot;status&quot;)]&#10;            public JsonFileStatus Status { get; set; } = new();&#10;        }&#10;&#10;        public class JsonFileStatus&#10;        {&#10;            [JsonPropertyName(&quot;isCorrupted&quot;)]&#10;            public bool IsCorrupted { get; set; }&#10;&#10;            [JsonPropertyName(&quot;isComplete&quot;)]&#10;            public bool IsComplete { get; set; }&#10;&#10;            [JsonPropertyName(&quot;severity&quot;)]&#10;            public string Severity { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;recommendation&quot;)]&#10;            public string Recommendation { get; set; } = string.Empty;&#10;        }&#10;&#10;        public class FileCheckResult&#10;        {&#10;            public string         FilePath         { get; set; } = string.Empty;&#10;            public bool           HasIssues        =&gt; Issues.Count &gt; 0;&#10;            public List&lt;string&gt;   Issues           { get; set; } = new();&#10;            public List&lt;AtomInfo&gt; Atoms            { get; set; } = new();&#10;            public long           FileSize         { get; set; }&#10;            public long           BytesValidated   { get; set; }&#10;            public double         TotalDuration    { get; set; }&#10;            public double         PlayableDuration { get; set; }&#10;        }&#10;&#10;        private static FileCheckResult CheckFileIntegrity(string filePath)&#10;        {&#10;            var result = new FileCheckResult&#10;            {&#10;                FilePath = filePath,&#10;            };&#10;&#10;            if (!File.Exists(filePath))&#10;            {&#10;                result.Issues.Add(&quot;File does not exist&quot;);&#10;                return result;&#10;            }&#10;&#10;            try&#10;            {&#10;                using var fs = new FileStream(filePath, FileMode.Open, FileAccess.Read);&#10;                long fileLength = fs.Length;&#10;                result.FileSize = fileLength;&#10;&#10;                if (fileLength &lt; 8)&#10;                {&#10;                    result.Issues.Add(&quot;File too small to be a valid MOV (&lt; 8 bytes)&quot;);&#10;                    return result;&#10;                }&#10;&#10;                // Parse all atoms in the file&#10;                bool hasStructuralErrors = false;&#10;                bool hasIncompleteAtoms = false;&#10;                long position = 0;&#10;&#10;                while (position &lt; fileLength)&#10;                {&#10;                    fs.Position = position;&#10;&#10;                    // Read atom size (4 bytes, big-endian)&#10;                    byte[] sizeBytes = new byte[4];&#10;                    int bytesRead = fs.Read(sizeBytes, 0, 4);&#10;                    if (bytesRead &lt; 4)&#10;                    {&#10;                        result.Issues.Add($&quot;Incomplete atom header at offset {position:N0}&quot;);&#10;                        hasIncompleteAtoms = true;&#10;                        break;&#10;                    }&#10;&#10;                    long atomSize = ReadBigEndianUInt32(sizeBytes);&#10;&#10;                    // Read atom type (4 bytes)&#10;                    byte[] typeBytes = new byte[4];&#10;                    bytesRead = fs.Read(typeBytes, 0, 4);&#10;                    if (bytesRead &lt; 4)&#10;                    {&#10;                        result.Issues.Add($&quot;Incomplete atom type at offset {position:N0}&quot;);&#10;                        hasIncompleteAtoms = true;&#10;                        break;&#10;                    }&#10;&#10;                    string atomType = Encoding.ASCII.GetString(typeBytes);&#10;&#10;                    // Handle extended size (size == 1)&#10;                    long headerSize = 8;&#10;                    if (atomSize == 1)&#10;                    {&#10;                        byte[] extSizeBytes = new byte[8];&#10;                        bytesRead = fs.Read(extSizeBytes, 0, 8);&#10;                        if (bytesRead &lt; 8)&#10;                        {&#10;                            result.Issues.Add($&quot;Incomplete extended size for atom '{atomType}' at offset {position:N0}&quot;);&#10;                            hasIncompleteAtoms = true;&#10;                            break;&#10;                        }&#10;&#10;                        atomSize = ReadBigEndianUInt64(extSizeBytes);&#10;                        headerSize = 16;&#10;                    }&#10;                    // Handle size == 0 (atom extends to end of file)&#10;                    else if (atomSize == 0)&#10;                    {&#10;                        atomSize = fileLength - position;&#10;                    }&#10;&#10;                    // Validate atom size&#10;                    if (atomSize &lt; headerSize)&#10;                    {&#10;                        result.Issues.Add($&quot;Invalid atom size ({atomSize}) at offset {position:N0} for type '{atomType}'&quot;);&#10;                        hasStructuralErrors = true;&#10;                        break;&#10;                    }&#10;&#10;                    // Check if atom extends beyond file&#10;                    bool isComplete = (position + atomSize) &lt;= fileLength;&#10;&#10;                    var atom = new AtomInfo&#10;                    {&#10;                        Type = atomType,&#10;                        Size = atomSize,&#10;                        Offset = position,&#10;                        IsComplete = isComplete&#10;                    };&#10;                    result.Atoms.Add(atom);&#10;&#10;                    if (!isComplete)&#10;                    {&#10;                        long available = fileLength - position;&#10;                        long missing = atomSize - available;&#10;                        result.Issues.Add($&quot;Incomplete atom '{atomType}' at offset {position:N0}: Expected {atomSize:N0} bytes, available {available:N0} bytes, missing {missing:N0} bytes ({(missing * 100.0 / atomSize):F1}%)&quot;);&#10;                        hasIncompleteAtoms = true;&#10;                        break;&#10;                    }&#10;&#10;                    // Warn about unknown atom types&#10;                    if (!ValidAtomTypes.Contains(atomType) &amp;&amp; !IsAsciiPrintable(atomType))&#10;                    {&#10;                        result.Issues.Add($&quot;Unknown/invalid atom type '{atomType}' at offset {position:N0}&quot;);&#10;                    }&#10;&#10;                    position += atomSize;&#10;                }&#10;&#10;                result.BytesValidated = position;&#10;&#10;                // Check for required atoms&#10;                bool hasFtyp = result.Atoms.Any(a =&gt; a.Type == &quot;ftyp&quot;);&#10;                bool hasMoov = result.Atoms.Any(a =&gt; a.Type == &quot;moov&quot;);&#10;                bool hasMdat = result.Atoms.Any(a =&gt; a.Type == &quot;mdat&quot;);&#10;&#10;                if (!hasFtyp &amp;&amp; result.Atoms.Count &gt; 0)&#10;                {&#10;                    result.Issues.Add(&quot;Missing 'ftyp' atom (file type header)&quot;);&#10;                }&#10;&#10;                if (!hasMoov &amp;&amp; result.Atoms.Count &gt; 0)&#10;                {&#10;                    result.Issues.Add(&quot;Missing 'moov' atom (metadata)&quot;);&#10;                }&#10;&#10;                if (!hasMdat &amp;&amp; result.Atoms.Count &gt; 0)&#10;                {&#10;                    result.Issues.Add(&quot;Missing 'mdat' atom (media data)&quot;);&#10;                }&#10;&#10;                // Validate ftyp is first (if present)&#10;                if (hasFtyp &amp;&amp; result.Atoms.Count &gt; 0 &amp;&amp; result.Atoms[0].Type != &quot;ftyp&quot;)&#10;                {&#10;                    result.Issues.Add($&quot;'ftyp' atom should be first, but found at offset {result.Atoms.First(a =&gt; a.Type == &quot;ftyp&quot;).Offset:N0}&quot;);&#10;                }&#10;&#10;                // Check last atom alignment&#10;                if (result.Atoms.Count &gt; 0)&#10;                {&#10;                    var lastAtom = result.Atoms.Last();&#10;                    long declaredEnd = lastAtom.Offset + lastAtom.Size;&#10;&#10;                    if (lastAtom.IsComplete &amp;&amp; declaredEnd != fileLength)&#10;                    {&#10;                        long gap = fileLength - declaredEnd;&#10;                        result.Issues.Add($&quot;Gap of {gap:N0} bytes after last atom '{lastAtom.Type}' at offset {declaredEnd:N0}&quot;);&#10;                    }&#10;                }&#10;&#10;                // Final verdict&#10;                if (hasStructuralErrors || hasIncompleteAtoms || result.Atoms.Count == 0)&#10;                {&#10;                    result.Issues.Add(&quot;File structure is invalid or incomplete&quot;);&#10;                }&#10;&#10;                // Get video duration using ffprobe&#10;                result.TotalDuration = GetVideoDuration(filePath);&#10;&#10;                // Estimate playable duration based on bytes validated&#10;                if (result.TotalDuration &gt; 0 &amp;&amp; result.FileSize &gt; 0)&#10;                {&#10;                    double completionRatio = (double)result.BytesValidated / result.FileSize;&#10;                    result.PlayableDuration = result.TotalDuration * completionRatio;&#10;                }&#10;                else&#10;                {&#10;                    result.PlayableDuration = 0;&#10;                }&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                result.Issues.Add($&quot;Error reading file: {ex.Message}&quot;);&#10;            }&#10;&#10;            return result;&#10;        }&#10;&#10;        private static void PrintDetailedResult(FileCheckResult result)&#10;        {&#10;            Console.WriteLine($&quot;\n{'='}{new string('=', 80)}&quot;);&#10;            Console.WriteLine($&quot;File: {Path.GetFileName(result.FilePath)}&quot;);&#10;            Console.WriteLine(new string('=', 80));&#10;&#10;            Console.WriteLine($&quot;\n Analysis Summary:&quot;);&#10;            Console.WriteLine($&quot;   File Size: {result.FileSize:N0} bytes&quot;);&#10;            Console.WriteLine($&quot;   Atoms Found: {result.Atoms.Count}&quot;);&#10;            Console.WriteLine($&quot;   Bytes Validated: {result.BytesValidated:N0} / {result.FileSize:N0} ({(result.BytesValidated * 100.0 / Math.Max(1, result.FileSize)):F1}%)&quot;);&#10;&#10;            // Display duration timeline if available&#10;            if (result.TotalDuration &gt; 0)&#10;            {&#10;                Console.WriteLine($&quot;\n⏱️  Duration Timeline:&quot;);&#10;                Console.WriteLine($&quot;   Total Duration: {FormatDuration(result.TotalDuration)}&quot;);&#10;&#10;                if (result.HasIssues &amp;&amp; result.PlayableDuration &lt; result.TotalDuration)&#10;                {&#10;                    Console.WriteLine($&quot;   Playable Duration: {FormatDuration(result.PlayableDuration)}&quot;);&#10;                    double playablePercent = (result.PlayableDuration / result.TotalDuration) * 100.0;&#10;&#10;                    // Create visual timeline bar (50 chars wide)&#10;                    int barWidth = 50;&#10;                    int greenWidth = (int)(barWidth * playablePercent / 100.0);&#10;                    int redWidth = barWidth - greenWidth;&#10;&#10;                    string greenBar = new string('█', greenWidth);&#10;                    string redBar = new string('█', redWidth);&#10;&#10;                    Console.Write($&quot;   &quot;);&#10;                    WriteSuccess($&quot;{greenBar}&quot;);&#10;                    Console.Write($&quot;&quot;);&#10;                    WriteError($&quot;{redBar}\n&quot;);&#10;                    Console.WriteLine($&quot;   |&quot;);&#10;                    Console.WriteLine($&quot;   {FormatDuration(0)}          {FormatDuration(result.PlayableDuration)} (break)          {FormatDuration(result.TotalDuration)}&quot;);&#10;                    Console.WriteLine($&quot;   Start           Missing: {FormatDuration(result.TotalDuration - result.PlayableDuration)}           End&quot;);&#10;                }&#10;                else&#10;                {&#10;                    Console.WriteLine($&quot;   Status: Complete playback expected&quot;);&#10;                    int barWidth = 50;&#10;                    string greenBar = new string('█', barWidth);&#10;                    Console.Write($&quot;   &quot;);&#10;                    WriteSuccess($&quot;{greenBar}\n&quot;);&#10;                    Console.WriteLine($&quot;   |&quot;);&#10;                    Console.WriteLine($&quot;   {FormatDuration(0)}                                      {FormatDuration(result.TotalDuration)}&quot;);&#10;                    Console.WriteLine($&quot;   Start                                   End&quot;);&#10;                }&#10;            }&#10;&#10;            if (result.Atoms.Count &gt; 0)&#10;            {&#10;                Console.WriteLine($&quot;\n Atom Structure:&quot;);&#10;                foreach (var atom in result.Atoms)&#10;                {&#10;                    string status = atom.IsComplete ? &quot;✅&quot; : &quot;❌&quot;;&#10;                    string knownType = ValidAtomTypes.Contains(atom.Type) ? &quot;&quot; : &quot; (unknown)&quot;;&#10;                    Console.WriteLine($&quot;   {status} [{atom.Type}]{knownType} - Size: {atom.Size:N0} bytes, Offset: {atom.Offset:N0}&quot;);&#10;                }&#10;&#10;                // Check for required atoms&#10;                bool hasFtyp = result.Atoms.Any(a =&gt; a.Type == &quot;ftyp&quot;);&#10;                bool hasMoov = result.Atoms.Any(a =&gt; a.Type == &quot;moov&quot;);&#10;                bool hasMdat = result.Atoms.Any(a =&gt; a.Type == &quot;mdat&quot;);&#10;&#10;                Console.WriteLine($&quot;\n Key Atoms:&quot;);&#10;                Console.WriteLine($&quot;   ftyp (file type): {(hasFtyp ? &quot;✅ Found&quot; : &quot;❌ Missing&quot;)}&quot;);&#10;                Console.WriteLine($&quot;   moov (metadata): {(hasMoov ? &quot;✅ Found&quot; : &quot;❌ Missing&quot;)}&quot;);&#10;                Console.WriteLine($&quot;   mdat (media data): {(hasMdat ? &quot;✅ Found&quot; : &quot;❌ Missing&quot;)}&quot;);&#10;            }&#10;&#10;            if (result.Issues.Count &gt; 0)&#10;            {&#10;                Console.WriteLine($&quot;\n⚠️  Issues Found ({result.Issues.Count}):&quot;);&#10;                foreach (var issue in result.Issues)&#10;                {&#10;                    WriteWarning($&quot;   • {issue}&quot;);&#10;                }&#10;            }&#10;&#10;            if (result.HasIssues)&#10;            {&#10;                WriteError(&quot;\n❌ File Status: CORRUPTED or INCOMPLETE&quot;);&#10;            }&#10;            else&#10;            {&#10;                WriteSuccess(&quot;\n✅ File Status: VALID and COMPLETE&quot;);&#10;            }&#10;        }&#10;&#10;        private static uint ReadBigEndianUInt32(byte[] data)&#10;        {&#10;            return ((uint)data[0] &lt;&lt; 24) | ((uint)data[1] &lt;&lt; 16) | ((uint)data[2] &lt;&lt; 8) | data[3];&#10;        }&#10;&#10;        private static long ReadBigEndianUInt64(byte[] data)&#10;        {&#10;            return ((long)data[0] &lt;&lt; 56) | ((long)data[1] &lt;&lt; 48) | ((long)data[2] &lt;&lt; 40) | ((long)data[3] &lt;&lt; 32) |&#10;                   ((long)data[4] &lt;&lt; 24) | ((long)data[5] &lt;&lt; 16) | ((long)data[6] &lt;&lt; 8) | data[7];&#10;        }&#10;&#10;        private static bool IsAsciiPrintable(string str)&#10;        {&#10;            return str.All(c =&gt; c &gt;= 32 &amp;&amp; c &lt;= 126);&#10;        }&#10;&#10;        private static string FormatDuration(double seconds)&#10;        {&#10;            if (seconds &lt;= 0) return &quot;00:00:00&quot;;&#10;&#10;            int hours = (int)(seconds / 3600);&#10;            int minutes = (int)((seconds % 3600) / 60);&#10;            int secs = (int)(seconds % 60);&#10;&#10;            return $&quot;{hours:D2}:{minutes:D2}:{secs:D2}&quot;;&#10;        }&#10;&#10;        // --- Added helpers for extracting a random frame using ffprobe/ffmpeg ---&#10;        private static double GetVideoDuration(string filePath)&#10;        {&#10;            try&#10;            {&#10;                var psi = new ProcessStartInfo&#10;                {&#10;                    FileName = &quot;ffprobe&quot;,&#10;                    Arguments = $&quot;-v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 \&quot;{filePath}\&quot;&quot;,&#10;                    RedirectStandardOutput = true,&#10;                    RedirectStandardError = true,&#10;                    UseShellExecute = false,&#10;                    CreateNoWindow = true&#10;                };&#10;&#10;                using var p = Process.Start(psi);&#10;                if (p == null) return 0;&#10;&#10;                // Wait a bit for ffprobe to produce output&#10;                string output = p.StandardOutput.ReadToEnd();&#10;                string stderr = p.StandardError.ReadToEnd();&#10;                p.WaitForExit(3000);&#10;&#10;                if (!string.IsNullOrWhiteSpace(output) &amp;&amp; double.TryParse(output.Trim(), NumberStyles.Any, CultureInfo.InvariantCulture, out var duration))&#10;                    return duration;&#10;&#10;                // If ffprobe failed, try to parse duration from stderr as a fallback (sometimes ffprobe prints to stderr)&#10;                if (!string.IsNullOrWhiteSpace(stderr))&#10;                {&#10;                    var digits = new string(stderr.Where(c =&gt; char.IsDigit(c) || c == '.' || c == ',').ToArray());&#10;                    if (double.TryParse(digits.Replace(',', '.'), NumberStyles.Any, CultureInfo.InvariantCulture, out var dur2))&#10;                        return dur2;&#10;                }&#10;            }&#10;            catch&#10;            {&#10;                // ignore and return 0&#10;            }&#10;&#10;            return 0;&#10;        }&#10;&#10;        // Tries multiple extraction strategies and timestamps to increase the chance of success&#10;        public static string? GetRandomFrameBase64(string filePath)&#10;        {&#10;            try&#10;            {&#10;                double duration = GetVideoDuration(filePath);&#10;                var rnd = new Random();&#10;&#10;                // Candidate timestamps (seconds)&#10;                var timestamps = new List&lt;double&gt; { 0 };&#10;                if (duration &gt; 0)&#10;                {&#10;                    timestamps.Add(Math.Min(Math.Max(0.1, duration / 2.0), Math.Max(0.1, duration - 0.5)));&#10;                    if (duration &gt; 2.0) timestamps.Add(Math.Max(0.5, duration - 1.0));&#10;                }&#10;&#10;                // Add a random timestamp if duration is known&#10;                if (duration &gt; 0.5)&#10;                {&#10;                    double max = Math.Max(0.1, duration - 0.5);&#10;                    timestamps.Add(rnd.NextDouble() * max);&#10;                }&#10;&#10;                // Ensure unique and reasonable timestamps&#10;                timestamps = timestamps.Distinct().Select(t =&gt; Math.Max(0, t)).Take(5).ToList();&#10;&#10;                // Try extraction strategies for each timestamp&#10;                foreach (var ts in timestamps)&#10;                {&#10;                    // Strategy 1: write to a temp file using fast seek (-ss before -i)&#10;                    var tmp = Path.Combine(Path.GetTempPath(), Path.GetFileNameWithoutExtension(Path.GetRandomFileName()) + &quot;.png&quot;);&#10;                    try&#10;                    {&#10;                        var psi = new ProcessStartInfo&#10;                        {&#10;                            FileName = &quot;ffmpeg&quot;,&#10;                            Arguments = $&quot;-ss {ts.ToString(CultureInfo.InvariantCulture)} -i \&quot;{filePath}\&quot; -frames:v 1 -vf scale=640:-1 -y -hide_banner -loglevel error \&quot;{tmp}\&quot;&quot;,&#10;                            RedirectStandardError = true,&#10;                            UseShellExecute = false,&#10;                            CreateNoWindow = true&#10;                        };&#10;&#10;                        using var p = Process.Start(psi);&#10;                        if (p != null)&#10;                        {&#10;                            // wait longer for more complex files&#10;                            if (!p.WaitForExit(10000))&#10;                            {&#10;                                try&#10;                                {&#10;                                    p.Kill(true);&#10;                                }&#10;                                catch&#10;                                {&#10;                                }&#10;                            }&#10;                        }&#10;&#10;                        if (File.Exists(tmp))&#10;                        {&#10;                            var fi = new FileInfo(tmp);&#10;                            if (fi.Length &gt; 100) // small sanity size&#10;                            {&#10;                                byte[] data = File.ReadAllBytes(tmp);&#10;                                try&#10;                                {&#10;                                    File.Delete(tmp);&#10;                                }&#10;                                catch&#10;                                {&#10;                                }&#10;&#10;                                return Convert.ToBase64String(data);&#10;                            }&#10;&#10;                            try&#10;                            {&#10;                                File.Delete(tmp);&#10;                            }&#10;                            catch&#10;                            {&#10;                            }&#10;                        }&#10;                    }&#10;                    catch&#10;                    {&#10;                        try&#10;                        {&#10;                            if (File.Exists(tmp)) File.Delete(tmp);&#10;                        }&#10;                        catch&#10;                        {&#10;                        }&#10;                    }&#10;&#10;                    // Strategy 2: accurate seek (position after -i)&#10;                    try&#10;                    {&#10;                        var tmp2 = Path.Combine(Path.GetTempPath(), Path.GetFileNameWithoutExtension(Path.GetRandomFileName()) + &quot;.png&quot;);&#10;                        var psi2 = new ProcessStartInfo&#10;                        {&#10;                            FileName = &quot;ffmpeg&quot;,&#10;                            Arguments = $&quot;-i \&quot;{filePath}\&quot; -ss {ts.ToString(CultureInfo.InvariantCulture)} -frames:v 1 -vf scale=640:-1 -y -hide_banner -loglevel error \&quot;{tmp2}\&quot;&quot;,&#10;                            RedirectStandardError = true,&#10;                            UseShellExecute = false,&#10;                            CreateNoWindow = true&#10;                        };&#10;&#10;                        using var p2 = Process.Start(psi2);&#10;                        if (p2 != null)&#10;                        {&#10;                            if (!p2.WaitForExit(12000))&#10;                            {&#10;                                try&#10;                                {&#10;                                    p2.Kill(true);&#10;                                }&#10;                                catch&#10;                                {&#10;                                }&#10;                            }&#10;                        }&#10;&#10;                        if (File.Exists(tmp2))&#10;                        {&#10;                            var fi2 = new FileInfo(tmp2);&#10;                            if (fi2.Length &gt; 100)&#10;                            {&#10;                                byte[] data = File.ReadAllBytes(tmp2);&#10;                                try&#10;                                {&#10;                                    File.Delete(tmp2);&#10;                                }&#10;                                catch&#10;                                {&#10;                                }&#10;&#10;                                return Convert.ToBase64String(data);&#10;                            }&#10;&#10;                            try&#10;                            {&#10;                                File.Delete(tmp2);&#10;                            }&#10;                            catch&#10;                            {&#10;                            }&#10;                        }&#10;                    }&#10;                    catch&#10;                    {&#10;                        // ignore and continue&#10;                    }&#10;&#10;                    // Strategy 3: try piping to stdout (older approach) as a last resort&#10;                    try&#10;                    {&#10;                        var psi3 = new ProcessStartInfo&#10;                        {&#10;                            FileName = &quot;ffmpeg&quot;,&#10;                            Arguments = $&quot;-ss {ts.ToString(CultureInfo.InvariantCulture)} -i \&quot;{filePath}\&quot; -frames:v 1 -vf scale=640:-1 -f image2 -vcodec png pipe:1 -hide_banner -loglevel error&quot;,&#10;                            RedirectStandardOutput = true,&#10;                            RedirectStandardError = true,&#10;                            UseShellExecute = false,&#10;                            CreateNoWindow = true&#10;                        };&#10;&#10;                        using var proc = Process.Start(psi3);&#10;                        if (proc != null)&#10;                        {&#10;                            using var ms = new MemoryStream();&#10;                            // copy but with a timeout guard&#10;                            var copyTask = proc.StandardOutput.BaseStream.CopyToAsync(ms);&#10;                            if (!copyTask.Wait(7000))&#10;                            {&#10;                                try&#10;                                {&#10;                                    proc.Kill(true);&#10;                                }&#10;                                catch&#10;                                {&#10;                                }&#10;                            }&#10;                            else&#10;                            {&#10;                                proc.WaitForExit(2000);&#10;                            }&#10;&#10;                            if (ms.Length &gt; 100)&#10;                                return Convert.ToBase64String(ms.ToArray());&#10;                        }&#10;                    }&#10;                    catch&#10;                    {&#10;                        // ignore&#10;                    }&#10;                }&#10;&#10;                // All attempts failed&#10;                return null;&#10;            }&#10;            catch&#10;            {&#10;                return null;&#10;            }&#10;        }&#10;&#10;        private static void CreateJsonReport(FileCheckResult result)&#10;        {&#10;            try&#10;            {&#10;                string filePath = result.FilePath;&#10;                FileInfo fileInfo = new FileInfo(filePath);&#10;&#10;                // Create JSON report directory if it doesn't exist&#10;                string jsonReportDir = @&quot;T:\SPT\SP\Mont\Projets\3_PRJ\9-ALEXANDRE_DEMERS-ROBERGE\Fichiers Corrompus&quot;;&#10;&#10;                if (!Directory.Exists(jsonReportDir))&#10;                {&#10;                    Directory.CreateDirectory(jsonReportDir);&#10;                }&#10;&#10;                string baseName = Path.GetFileNameWithoutExtension(filePath);&#10;                string jsonFileName = $&quot;{baseName}_report.json&quot;;&#10;                string jsonReportPath = Path.Combine(jsonReportDir, jsonFileName);&#10;&#10;                DateTime evaluationTime = DateTime.UtcNow;&#10;&#10;                // Build the comprehensive JSON report&#10;                var jsonReport = new JsonCorruptionReport&#10;                {&#10;                    ReportVersion = &quot;1.0&quot;,&#10;                    GeneratedByTool = &quot;MovFileIntegrityChecker v1.0&quot;,&#10;                    EvaluationTimeUtc = evaluationTime,&#10;                    EvaluationTimeLocal = evaluationTime.ToLocalTime(),&#10;&#10;                    FileMetadata = new JsonFileMetadata&#10;                    {&#10;                        FileName = fileInfo.Name,&#10;                        FullPath = fileInfo.FullName,&#10;                        FileSizeBytes = fileInfo.Length,&#10;                        FileSizeMB = fileInfo.Length / (1024.0 * 1024.0),&#10;                        CreationTimeUtc = fileInfo.CreationTimeUtc,&#10;                        LastModifiedTimeUtc = fileInfo.LastWriteTimeUtc,&#10;                        LastAccessTimeUtc = fileInfo.LastAccessTimeUtc,&#10;                        FileExtension = fileInfo.Extension,&#10;                        IsReadOnly = fileInfo.IsReadOnly,&#10;                        Attributes = fileInfo.Attributes.ToString()&#10;                    },&#10;&#10;                    IntegrityAnalysis = new JsonIntegrityAnalysis&#10;                    {&#10;                        BytesValidated = result.BytesValidated,&#10;                        ValidationPercentage = result.FileSize &gt; 0 ? (result.BytesValidated * 100.0 / result.FileSize) : 0,&#10;                        AtomsFound = result.Atoms.Count,&#10;                        HasStructuralIssues = result.HasIssues,&#10;                        Issues = new List&lt;string&gt;(result.Issues),&#10;                        Atoms = result.Atoms.Select(a =&gt; new JsonAtomInfo&#10;                        {&#10;                            Type = a.Type,&#10;                            SizeBytes = a.Size,&#10;                            OffsetBytes = a.Offset,&#10;                            IsComplete = a.IsComplete,&#10;                            IsKnownType = ValidAtomTypes.Contains(a.Type)&#10;                        }).ToList(),&#10;                        HasRequiredAtoms = new JsonRequiredAtoms&#10;                        {&#10;                            Ftyp = result.Atoms.Any(a =&gt; a.Type == &quot;ftyp&quot;),&#10;                            Moov = result.Atoms.Any(a =&gt; a.Type == &quot;moov&quot;),&#10;                            Mdat = result.Atoms.Any(a =&gt; a.Type == &quot;mdat&quot;)&#10;                        }&#10;                    },&#10;&#10;                    Status = new JsonFileStatus&#10;                    {&#10;                        IsCorrupted = result.HasIssues,&#10;                        IsComplete = !result.HasIssues,&#10;                        Severity = result.HasIssues ? &quot;ERROR&quot; : &quot;OK&quot;,&#10;                        Recommendation = result.HasIssues&#10;                            ? &quot;File appears to be corrupted or incomplete. Review in VLC to verify playback.&quot;&#10;                            : &quot;File structure appears valid and complete.&quot;&#10;                    }&#10;                };&#10;&#10;                // Add video duration if available&#10;                if (result.TotalDuration &gt; 0)&#10;                {&#10;                    double missingDuration = result.TotalDuration - result.PlayableDuration;&#10;                    double playablePercent = (result.PlayableDuration / result.TotalDuration) * 100.0;&#10;                    double corruptedPercent = 100.0 - playablePercent;&#10;&#10;                    jsonReport.VideoDuration = new JsonVideoDuration&#10;                    {&#10;                        TotalDurationSeconds = result.TotalDuration,&#10;                        TotalDurationFormatted = FormatDuration(result.TotalDuration),&#10;                        PlayableDurationSeconds = result.PlayableDuration,&#10;                        PlayableDurationFormatted = FormatDuration(result.PlayableDuration),&#10;                        MissingDurationSeconds = missingDuration,&#10;                        MissingDurationFormatted = FormatDuration(missingDuration),&#10;                        PlayablePercentage = playablePercent,&#10;                        CorruptedPercentage = corruptedPercent&#10;                    };&#10;                }&#10;&#10;                // Serialize to JSON with pretty formatting&#10;                var options = new JsonSerializerOptions&#10;                {&#10;                    WriteIndented = true,&#10;                    PropertyNamingPolicy = JsonNamingPolicy.CamelCase,&#10;                    DefaultIgnoreCondition = JsonIgnoreCondition.Never,&#10;                    Encoder = System.Text.Encodings.Web.JavaScriptEncoder.UnsafeRelaxedJsonEscaping&#10;                };&#10;&#10;                string jsonContent = JsonSerializer.Serialize(jsonReport, options);&#10;                File.WriteAllText(jsonReportPath, jsonContent, Encoding.UTF8);&#10;&#10;                WriteSuccess($&quot;✅ JSON report saved: {jsonReportPath}&quot;);&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                WriteWarning($&quot;⚠️ Unable to create JSON report: {ex.Message}&quot;);&#10;            }&#10;        }&#10;&#10;        public static void CreateErrorReport(FileCheckResult result)&#10;        {&#10;            try&#10;            {&#10;                string filePath = result.FilePath;&#10;                string folder = Path.GetDirectoryName(filePath)!;&#10;                string baseName = Path.GetFileNameWithoutExtension(filePath);&#10;                string reportPath = Path.Combine(folder, $&quot;{baseName}-Incomplet.html&quot;);&#10;&#10;                var sb = new StringBuilder();&#10;&#10;                // Try to get a random frame as base64 (may return null)&#10;                string? frameBase64 = GetRandomFrameBase64(filePath);&#10;&#10;                // HTML Header with embedded CSS&#10;                sb.AppendLine(&quot;&lt;!DOCTYPE html&gt;&quot;);&#10;                sb.AppendLine(&quot;&lt;html lang=\&quot;fr\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;&lt;head&gt;&quot;);&#10;                sb.AppendLine(&quot;    &lt;meta charset=\&quot;UTF-8\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1.0\&quot;&gt;&quot;);&#10;                sb.AppendLine($&quot;    &lt;title&gt;Rapport d'Intégrité - {Path.GetFileName(filePath)}&lt;/title&gt;&quot;);&#10;                sb.AppendLine(&quot;    &lt;style&gt;&quot;);&#10;                sb.AppendLine(&quot;        * { margin: 0; padding: 0; box-sizing: border-box; }&quot;);&#10;                sb.AppendLine(&quot;        body {&quot;);&#10;                sb.AppendLine(&quot;            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;&quot;);&#10;                sb.AppendLine(&quot;            background: #000000;&quot;);&#10;                sb.AppendLine(&quot;            min-height: 100vh;&quot;);&#10;                sb.AppendLine(&quot;            padding: 40px 20px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .container {&quot;);&#10;                sb.AppendLine(&quot;            max-width: 1000px;&quot;);&#10;                sb.AppendLine(&quot;            margin: 0 auto;&quot;);&#10;                sb.AppendLine(&quot;            background: #1a1a1a;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 16px;&quot;);&#10;                sb.AppendLine(&quot;            box-shadow: 0 20px 60px rgba(0,0,0,0.5);&quot;);&#10;                sb.AppendLine(&quot;            overflow: hidden;&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .header {&quot;);&#10;                sb.AppendLine(&quot;            background: #111111;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            padding: 30px 40px;&quot;);&#10;                sb.AppendLine(&quot;            text-align: center;&quot;);&#10;                sb.AppendLine(&quot;            border-bottom: 2px solid #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .header h1 {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1.8em;&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 15px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .header .subtitle {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1em;&quot;);&#10;                sb.AppendLine(&quot;            color: #ccc;&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 15px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .header .warning {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.95em;&quot;);&#10;                sb.AppendLine(&quot;            color: #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;            line-height: 1.5;&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 15px;&quot;);&#10;                sb.AppendLine(&quot;            padding-top: 15px;&quot;);&#10;                sb.AppendLine(&quot;            border-top: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .header .warning strong {&quot;);&#10;                sb.AppendLine(&quot;            display: block;&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 8px;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .content {&quot;);&#10;                sb.AppendLine(&quot;            padding: 40px;&quot;);&#10;                sb.AppendLine(&quot;            background: #1a1a1a;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .section {&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 30px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .section-title {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1.5em;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 15px;&quot;);&#10;                sb.AppendLine(&quot;            padding-bottom: 10px;&quot;);&#10;                sb.AppendLine(&quot;            border-bottom: 2px solid #333;&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            align-items: center;&quot;);&#10;                sb.AppendLine(&quot;            gap: 10px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .info-grid {&quot;);&#10;                sb.AppendLine(&quot;            display: grid;&quot;);&#10;                sb.AppendLine(&quot;            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));&quot;);&#10;                sb.AppendLine(&quot;            gap: 20px;&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 20px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .info-card {&quot;);&#10;                sb.AppendLine(&quot;            background: #222222;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            padding: 20px;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 12px;&quot;);&#10;                sb.AppendLine(&quot;            box-shadow: 0 4px 15px rgba(0,0,0,0.5);&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;            border-left: 3px solid #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .info-card .label {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;                sb.AppendLine(&quot;            color: #999;&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 5px;&quot;);&#10;                sb.AppendLine(&quot;            text-transform: uppercase;&quot;);&#10;                sb.AppendLine(&quot;            letter-spacing: 0.5px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .info-card .value {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1.5em;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .issue-list {&quot;);&#10;                sb.AppendLine(&quot;            background: #2a1a1a;&quot;);&#10;                sb.AppendLine(&quot;            border-left: 4px solid #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;            padding: 20px;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 8px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .issue-item {&quot;);&#10;                sb.AppendLine(&quot;            padding: 10px 0;&quot;);&#10;                sb.AppendLine(&quot;            border-bottom: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            align-items: start;&quot;);&#10;                sb.AppendLine(&quot;            gap: 10px;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .issue-item:last-child {&quot;);&#10;                sb.AppendLine(&quot;            border-bottom: none;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .issue-icon {&quot;);&#10;                sb.AppendLine(&quot;            color: #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            flex-shrink: 0;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-table {&quot;);&#10;                sb.AppendLine(&quot;            width: 100%;&quot;);&#10;                sb.AppendLine(&quot;            border-collapse: collapse;&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 20px;&quot;);&#10;                sb.AppendLine(&quot;            box-shadow: 0 2px 10px rgba(0,0,0,0.5);&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 8px;&quot;);&#10;                sb.AppendLine(&quot;            overflow: hidden;&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-table thead {&quot;);&#10;                sb.AppendLine(&quot;            background: #111111;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            border-bottom: 2px solid #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-table th {&quot;);&#10;                sb.AppendLine(&quot;            padding: 15px;&quot;);&#10;                sb.AppendLine(&quot;            text-align: left;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: 600;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-table td {&quot;);&#10;                sb.AppendLine(&quot;            padding: 12px 15px;&quot;);&#10;                sb.AppendLine(&quot;            border-bottom: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-table tbody tr {&quot;);&#10;                sb.AppendLine(&quot;            background: #1a1a1a;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-table tbody tr:hover {&quot;);&#10;                sb.AppendLine(&quot;            background: #252525;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .status-badge {&quot;);&#10;                sb.AppendLine(&quot;            display: inline-block;&quot;);&#10;                sb.AppendLine(&quot;            padding: 5px 12px;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 20px;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.85em;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: 600;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .status-complete {&quot;);&#10;                sb.AppendLine(&quot;            background: #1a3a1a;&quot;);&#10;                sb.AppendLine(&quot;            color: #90ee90;&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #90ee90;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .status-incomplete {&quot;);&#10;                sb.AppendLine(&quot;            background: #3a1a1a;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-type {&quot;);&#10;                sb.AppendLine(&quot;            font-family: 'Courier New', monospace;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1.1em;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .footer {&quot;);&#10;                sb.AppendLine(&quot;            background: #111111;&quot;);&#10;                sb.AppendLine(&quot;            padding: 20px 40px;&quot;);&#10;                sb.AppendLine(&quot;            text-align: center;&quot;);&#10;                sb.AppendLine(&quot;            color: #888;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;                sb.AppendLine(&quot;            border-top: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .progress-bar {&quot;);&#10;                sb.AppendLine(&quot;            width: 100%;&quot;);&#10;                sb.AppendLine(&quot;            height: 30px;&quot;);&#10;                sb.AppendLine(&quot;            background: #2a2a2a;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 15px;&quot;);&#10;                sb.AppendLine(&quot;            overflow: hidden;&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 10px;&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #444;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .progress-fill {&quot;);&#10;                sb.AppendLine(&quot;            height: 100%;&quot;);&#10;                sb.AppendLine(&quot;            background: linear-gradient(90deg, #ff8c00 0%, #ffa500 100%);&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            align-items: center;&quot;);&#10;                sb.AppendLine(&quot;            justify-content: center;&quot;);&#10;                sb.AppendLine(&quot;            color: #000000;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.85em;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-container {&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 30px;&quot;);&#10;                sb.AppendLine(&quot;            padding: 20px;&quot;);&#10;                sb.AppendLine(&quot;            background: #222222;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 12px;&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-title {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1.2em;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 15px;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: 600;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-bar {&quot;);&#10;                sb.AppendLine(&quot;            width: 100%;&quot;);&#10;                sb.AppendLine(&quot;            height: 40px;&quot;);&#10;                sb.AppendLine(&quot;            background: #2a2a2a;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 8px;&quot;);&#10;                sb.AppendLine(&quot;            overflow: hidden;&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            border: 2px solid #444;&quot;);&#10;                sb.AppendLine(&quot;            margin: 15px 0;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-good {&quot;);&#10;                sb.AppendLine(&quot;            background: linear-gradient(90deg, #00aa00 0%, #00cc00 100%);&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            align-items: center;&quot;);&#10;                sb.AppendLine(&quot;            justify-content: center;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-bad {&quot;);&#10;                sb.AppendLine(&quot;            background: linear-gradient(90deg, #cc0000 0%, #aa0000 100%);&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            align-items: center;&quot;);&#10;                sb.AppendLine(&quot;            justify-content: center;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-labels {&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            justify-content: space-between;&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 10px;&quot;);&#10;                sb.AppendLine(&quot;            color: #ccc;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-label {&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            flex-direction: column;&quot;);&#10;                sb.AppendLine(&quot;            align-items: center;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-label.start { align-items: flex-start; }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-label.end { align-items: flex-end; }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-label .time {&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1.1em;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-info {&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 15px;&quot;);&#10;                sb.AppendLine(&quot;            padding: 15px;&quot;);&#10;                sb.AppendLine(&quot;            background: #1a1a1a;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 8px;&quot;);&#10;                sb.AppendLine(&quot;            border-left: 3px solid #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-info div {&quot;);&#10;                sb.AppendLine(&quot;            color: #ccc;&quot;);&#10;                sb.AppendLine(&quot;            margin: 5px 0;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-info strong {&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .preview img { max-width: 100%; border-radius: 8px; display: block; margin: 15px auto; }&quot;);&#10;                sb.AppendLine(&quot;    &lt;/style&gt;&quot;);&#10;                sb.AppendLine(&quot;&lt;/head&gt;&quot;);&#10;                sb.AppendLine(&quot;&lt;body&gt;&quot;);&#10;                sb.AppendLine(&quot;    &lt;div class=\&quot;container\&quot;&gt;&quot;);&#10;&#10;                // Header&#10;                sb.AppendLine(&quot;        &lt;div class=\&quot;header\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;            &lt;h1&gt;⚠️ Rapport d'Intégrité Fichier&lt;/h1&gt;&quot;);&#10;                sb.AppendLine($&quot;            &lt;div class=\&quot;subtitle\&quot;&gt;{System.Security.SecurityElement.Escape(Path.GetFileName(filePath))}&lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;            &lt;div class=\&quot;warning\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                &lt;strong&gt;Avertissement - Fichier potentiellement incomplet&lt;/strong&gt;&quot;);&#10;                sb.AppendLine(&quot;                Ce fichier a été automatiquement détecté comme étant potentiellement incomplet. &quot;);&#10;                sb.AppendLine(&quot;                Veuillez le visionner jusqu'à la fin dans VLC pour vérifier s'il se lit correctement.&quot;);&#10;                sb.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;                // Content&#10;                sb.AppendLine(&quot;        &lt;div class=\&quot;content\&quot;&gt;&quot;);&#10;&#10;                // Embed preview if available&#10;                if (!string.IsNullOrEmpty(frameBase64))&#10;                {&#10;                    sb.AppendLine(&quot;            &lt;div class=\&quot;section\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;div class=\&quot;section-title\&quot;&gt;Preview&lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;div class=\&quot;preview\&quot;&gt;&quot;);&#10;                    sb.AppendLine($&quot;                    &lt;img src=\&quot;data:image/png;base64,{frameBase64}\&quot; alt=\&quot;Preview\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;                }&#10;                else&#10;                {&#10;                    sb.AppendLine(&quot;            &lt;div class=\&quot;section\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;div class=\&quot;section-title\&quot;&gt;Preview&lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;div class=\&quot;issue-list\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                    &lt;div class=\&quot;issue-item\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                        &lt;span class=\&quot;issue-icon\&quot;&gt;ℹ️&lt;/span&gt;&quot;);&#10;                    sb.AppendLine(&quot;                        &lt;span&gt;Preview not available (ffmpeg/ffprobe not found or frame extraction failed).&lt;/span&gt;&quot;);&#10;                    sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;                }&#10;&#10;                sb.AppendLine(&quot;            &lt;div class=\&quot;section\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                &lt;div class=\&quot;section-title\&quot;&gt; Résumé Technique&lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                &lt;div class=\&quot;info-grid\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;div class=\&quot;info-card\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                        &lt;div class=\&quot;label\&quot;&gt;Nom du fichier&lt;/div&gt;&quot;);&#10;                sb.AppendLine($&quot;                        &lt;div class=\&quot;value\&quot;&gt;{System.Security.SecurityElement.Escape(Path.GetFileName(filePath))}&lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;div class=\&quot;info-card\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                        &lt;div class=\&quot;label\&quot;&gt;Taille du fichier&lt;/div&gt;&quot;);&#10;                sb.AppendLine($&quot;                        &lt;div class=\&quot;value\&quot;&gt;{result.FileSize:N0} octets&lt;/div&gt;&quot;);&#10;                sb.AppendLine($&quot;                        &lt;div class=\&quot;label\&quot;&gt;({result.FileSize / (1024.0 * 1024.0):F2} MB)&lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;div class=\&quot;info-card\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                        &lt;div class=\&quot;label\&quot;&gt;Octets validés&lt;/div&gt;&quot;);&#10;                sb.AppendLine($&quot;                        &lt;div class=\&quot;value\&quot;&gt;{result.BytesValidated:N0}&lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;div class=\&quot;info-card\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                        &lt;div class=\&quot;label\&quot;&gt;Atoms détectés&lt;/div&gt;&quot;);&#10;                sb.AppendLine($&quot;                        &lt;div class=\&quot;value\&quot;&gt;{result.Atoms.Count}&lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                &lt;/div&gt;&quot;);&#10;&#10;                double validationPercent = result.FileSize &gt; 0 ? (result.BytesValidated * 100.0 / result.FileSize) : 0;&#10;                sb.AppendLine(&quot;                &lt;div class=\&quot;progress-bar\&quot;&gt;&quot;);&#10;                sb.AppendLine($&quot;                    &lt;div class=\&quot;progress-fill\&quot; style=\&quot;width: {validationPercent.ToString(&quot;F1&quot;, CultureInfo.InvariantCulture)}%\&quot;&gt;\n                        {validationPercent:F1}% validé\n                    &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                &lt;/div&gt;&quot;);&#10;&#10;                // Add duration timeline if available&#10;                if (result.TotalDuration &gt; 0)&#10;                {&#10;                    sb.AppendLine(&quot;                &lt;div class=\&quot;timeline-container\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                    &lt;div class=\&quot;timeline-title\&quot;&gt;⏱️ Chronologie de la Vidéo&lt;/div&gt;&quot;);&#10;&#10;                    double playablePercent = result.TotalDuration &gt; 0 ? (result.PlayableDuration / result.TotalDuration) * 100.0 : 0;&#10;                    double brokenPercent = 100.0 - playablePercent;&#10;&#10;                    sb.AppendLine(&quot;                    &lt;div class=\&quot;timeline-bar\&quot;&gt;&quot;);&#10;                    if (playablePercent &gt; 0)&#10;                    {&#10;                        sb.AppendLine($&quot;                        &lt;div class=\&quot;timeline-good\&quot; style=\&quot;width: {playablePercent.ToString(&quot;F1&quot;, CultureInfo.InvariantCulture)}%\&quot;&gt;&quot;);&#10;                        sb.AppendLine($&quot;                            ✓ Lecture OK&quot;);&#10;                        sb.AppendLine(&quot;                        &lt;/div&gt;&quot;);&#10;                    }&#10;&#10;                    if (brokenPercent &gt; 0)&#10;                    {&#10;                        sb.AppendLine($&quot;                        &lt;div class=\&quot;timeline-bad\&quot; style=\&quot;width: {brokenPercent.ToString(&quot;F1&quot;, CultureInfo.InvariantCulture)}%\&quot;&gt;&quot;);&#10;                        sb.AppendLine($&quot;                            ✗ Corrompu&quot;);&#10;                        sb.AppendLine(&quot;                        &lt;/div&gt;&quot;);&#10;                    }&#10;&#10;                    sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;&#10;                    sb.AppendLine(&quot;                    &lt;div class=\&quot;timeline-labels\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                        &lt;div class=\&quot;timeline-label start\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                            &lt;div class=\&quot;time\&quot;&gt;00:00:00&lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                            &lt;div&gt;Début&lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                        &lt;/div&gt;&quot;);&#10;&#10;                    if (result.HasIssues &amp;&amp; result.PlayableDuration &lt; result.TotalDuration)&#10;                    {&#10;                        sb.AppendLine(&quot;                        &lt;div class=\&quot;timeline-label\&quot;&gt;&quot;);&#10;                        sb.AppendLine($&quot;                            &lt;div class=\&quot;time\&quot;&gt;{System.Security.SecurityElement.Escape(FormatDuration(result.PlayableDuration))}&lt;/div&gt;&quot;);&#10;                        sb.AppendLine(&quot;                            &lt;div style=\&quot;color: #ff8c00;\&quot;&gt;⚠️ Point de rupture&lt;/div&gt;&quot;);&#10;                        sb.AppendLine(&quot;                        &lt;/div&gt;&quot;);&#10;                    }&#10;&#10;                    sb.AppendLine(&quot;                        &lt;div class=\&quot;timeline-label end\&quot;&gt;&quot;);&#10;                    sb.AppendLine($&quot;                            &lt;div class=\&quot;time\&quot;&gt;{System.Security.SecurityElement.Escape(FormatDuration(result.TotalDuration))}&lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                            &lt;div&gt;Fin&lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                        &lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;&#10;                    sb.AppendLine(&quot;                    &lt;div class=\&quot;timeline-info\&quot;&gt;&quot;);&#10;                    sb.AppendLine($&quot;                        &lt;div&gt;&lt;strong&gt;Durée totale:&lt;/strong&gt; {System.Security.SecurityElement.Escape(FormatDuration(result.TotalDuration))}&lt;/div&gt;&quot;);&#10;                    sb.AppendLine($&quot;                        &lt;div&gt;&lt;strong&gt;Durée lisible:&lt;/strong&gt; {System.Security.SecurityElement.Escape(FormatDuration(result.PlayableDuration))} ({playablePercent:F1}%)&lt;/div&gt;&quot;);&#10;                    if (result.HasIssues &amp;&amp; result.PlayableDuration &lt; result.TotalDuration)&#10;                    {&#10;                        double missingDuration = result.TotalDuration - result.PlayableDuration;&#10;                        sb.AppendLine($&quot;                        &lt;div style=\&quot;color: #ff8c00;\&quot;&gt;&lt;strong&gt;Durée manquante:&lt;/strong&gt; {System.Security.SecurityElement.Escape(FormatDuration(missingDuration))} ({brokenPercent:F1}%)&lt;/div&gt;&quot;);&#10;                    }&#10;&#10;                    sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;/div&gt;&quot;);&#10;                }&#10;&#10;                sb.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;                if (result.Issues.Count &gt; 0)&#10;                {&#10;                    sb.AppendLine(&quot;            &lt;div class=\&quot;section\&quot;&gt;\n                &lt;div class=\&quot;section-title\&quot;&gt;❌ Problèmes Détectés&lt;/div&gt;\n                &lt;div class=\&quot;issue-list\&quot;&gt;\n&quot;);&#10;                    foreach (var issue in result.Issues)&#10;                    {&#10;                        sb.AppendLine(&quot;                    &lt;div class=\&quot;issue-item\&quot;&gt;\n                        &lt;span class=\&quot;issue-icon\&quot;&gt;❌&lt;/span&gt;\n                        &lt;span&gt;&quot; + System.Security.SecurityElement.Escape(issue) + &quot;&lt;/span&gt;\n                    &lt;/div&gt;&quot;);&#10;                    }&#10;&#10;                    sb.AppendLine(&quot;                &lt;/div&gt;\n            &lt;/div&gt;&quot;);&#10;                }&#10;&#10;                if (result.Atoms.Count &gt; 0)&#10;                {&#10;                    sb.AppendLine(&quot;            &lt;div class=\&quot;section\&quot;&gt;\n                &lt;div class=\&quot;section-title\&quot;&gt; Structure des Atoms&lt;/div&gt;\n                &lt;table class=\&quot;atom-table\&quot;&gt;\n                    &lt;thead&gt;\n                        &lt;tr&gt;\n                            &lt;th&gt;Type&lt;/th&gt;\n                            &lt;th&gt;Taille&lt;/th&gt;\n                            &lt;th&gt;Offset&lt;/th&gt;\n                            &lt;th&gt;Statut&lt;/th&gt;\n                        &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;&quot;);&#10;                    foreach (var atom in result.Atoms)&#10;                    {&#10;                        string statusClass = atom.IsComplete ? &quot;status-complete&quot; : &quot;status-incomplete&quot;;&#10;                        string statusText = atom.IsComplete ? &quot;✅ Complet&quot; : &quot;❌ Incomplet&quot;;&#10;                        sb.AppendLine(&quot;                        &lt;tr&gt;\n                            &lt;td&gt;&lt;span class=\&quot;atom-type\&quot;&gt;&quot; + System.Security.SecurityElement.Escape(atom.Type) + &quot;&lt;/span&gt;&lt;/td&gt;\n                            &lt;td&gt;&quot; + atom.Size.ToString(&quot;N0&quot;) + &quot; octets&lt;/td&gt;\n                            &lt;td&gt;&quot; + atom.Offset.ToString(&quot;N0&quot;) + &quot;&lt;/td&gt;\n                            &lt;td&gt;&lt;span class=\&quot;status-badge &quot; + statusClass + &quot;\&quot;&gt;&quot; + statusText + &quot;&lt;/span&gt;&lt;/td&gt;\n                        &lt;/tr&gt;&quot;);&#10;                    }&#10;&#10;                    sb.AppendLine(&quot;                    &lt;/tbody&gt;\n                &lt;/table&gt;\n            &lt;/div&gt;&quot;);&#10;                }&#10;&#10;                sb.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;                // Footer&#10;                sb.AppendLine(&quot;        &lt;div class=\&quot;footer\&quot;&gt;\n            Généré automatiquement le &quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd&quot;) + &quot; à &quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;&lt;br&gt;\n            Outil : MovIntegrityChecker (rapport automatique)\n        &lt;/div&gt;&quot;);&#10;&#10;                sb.AppendLine(&quot;    &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;&lt;/body&gt;&quot;);&#10;                sb.AppendLine(&quot;&lt;/html&gt;&quot;);&#10;&#10;                File.WriteAllText(reportPath, sb.ToString(), Encoding.UTF8);&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                WriteWarning($&quot;Impossible d'écrire le rapport d'erreur : {ex.Message}&quot;);&#10;            }&#10;        }&#10;&#10;        private static void WriteWarning(string message)&#10;        {&#10;            var oldColor = Console.ForegroundColor;&#10;            Console.ForegroundColor = ConsoleColor.Yellow;&#10;            Console.WriteLine(message);&#10;            Console.ForegroundColor = oldColor;&#10;        }&#10;&#10;        private static void WriteSuccess(string message)&#10;        {&#10;            var oldColor = Console.ForegroundColor;&#10;            Console.ForegroundColor = ConsoleColor.Green;&#10;            Console.WriteLine(message);&#10;            Console.ForegroundColor = oldColor;&#10;        }&#10;&#10;        private static void WriteError(string message)&#10;        {&#10;            var oldColor = Console.ForegroundColor;&#10;            Console.ForegroundColor = ConsoleColor.Red;&#10;            Console.WriteLine(message);&#10;            Console.ForegroundColor = oldColor;&#10;        }&#10;&#10;        private static void WriteInfo(string message)&#10;        {&#10;            var oldColor = Console.ForegroundColor;&#10;            Console.ForegroundColor = ConsoleColor.Cyan;&#10;            Console.WriteLine(message);&#10;            Console.ForegroundColor = oldColor;&#10;        }&#10;&#10;        private static void DeleteEmptyDirectories(string rootPath, bool recursive)&#10;        {&#10;            try&#10;            {&#10;                var directories = Directory.GetDirectories(&#10;                    rootPath,&#10;                    &quot;*&quot;,&#10;                    recursive ? SearchOption.AllDirectories : SearchOption.TopDirectoryOnly);&#10;&#10;                int deletedCount = 0;&#10;&#10;                // Sort by descending path length to delete deep folders first&#10;                foreach (var dir in directories.OrderByDescending(d =&gt; d.Length))&#10;                {&#10;                    if (!Directory.EnumerateFileSystemEntries(dir).Any())&#10;                    {&#10;                        Directory.Delete(dir);&#10;                        deletedCount++;&#10;                        WriteSuccess($&quot;Deleted empty folder: {dir}&quot;);&#10;                    }&#10;                }&#10;&#10;                // Check root folder itself&#10;                if (!Directory.EnumerateFileSystemEntries(rootPath).Any())&#10;                {&#10;                    Directory.Delete(rootPath);&#10;                    deletedCount++;&#10;                    WriteSuccess($&quot;Deleted empty root folder: {rootPath}&quot;);&#10;                }&#10;&#10;                if (deletedCount &gt; 0)&#10;                    WriteInfo($&quot;\n✅ {deletedCount} empty folder(s) deleted.&quot;);&#10;                else&#10;                    WriteInfo(&quot;\nNo empty folders found.&quot;);&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                WriteError($&quot;Error while deleting empty folders: {ex.Message}&quot;);&#10;            }&#10;        }&#10;&#10;        private static void ShowMainMenu()&#10;        {&#10;            Console.Clear();&#10;            Console.WriteLine(&quot;╔════════════════════════════════════════════════════════════════╗&quot;);&#10;            Console.WriteLine(&quot;║        MOV File Integrity Checker - Analysis Mode             ║&quot;);&#10;            Console.WriteLine(&quot;╚════════════════════════════════════════════════════════════════╝&quot;);&#10;            Console.WriteLine();&#10;            Console.WriteLine(&quot;Please select an analysis mode:&quot;);&#10;            Console.WriteLine();&#10;            Console.WriteLine(&quot;  1. Per-File Analysis     - Analyze individual video files&quot;);&#10;            Console.WriteLine(&quot;  2. Global Analysis       - Generate global report from JSON files&quot;);&#10;            Console.WriteLine(&quot;  3. Both                  - Run per-file analysis then global report&quot;);&#10;            Console.WriteLine(&quot;  4. Exit&quot;);&#10;            Console.WriteLine();&#10;            Console.Write(&quot;Enter your choice (1-4): &quot;);&#10;&#10;            string? choice = Console.ReadLine();&#10;            Console.WriteLine();&#10;&#10;            switch (choice?.Trim())&#10;            {&#10;                case &quot;1&quot;:&#10;                    RunPerFileAnalysisInteractive();&#10;                    break;&#10;                case &quot;2&quot;:&#10;                    RunGlobalAnalysis();&#10;                    break;&#10;                case &quot;3&quot;:&#10;                    RunPerFileAnalysisInteractive();&#10;                    Console.WriteLine(&quot;\n&quot; + new string('=', 80));&#10;                    Console.WriteLine(&quot;Starting Global Analysis...&quot;);&#10;                    Console.WriteLine(new string('=', 80) + &quot;\n&quot;);&#10;                    RunGlobalAnalysis();&#10;                    break;&#10;                case &quot;4&quot;:&#10;                    Console.WriteLine(&quot;Exiting...&quot;);&#10;                    return;&#10;                default:&#10;                    WriteError(&quot;Invalid choice. Please run the program again.&quot;);&#10;                    break;&#10;            }&#10;        }&#10;&#10;        private static void RunPerFileAnalysisInteractive()&#10;        {&#10;            Console.Write(&quot;Enter the path to a file or folder: &quot;);&#10;            string? path = Console.ReadLine()?.Trim().Trim('&quot;');&#10;&#10;            if (string.IsNullOrEmpty(path))&#10;            {&#10;                WriteError(&quot;No path provided.&quot;);&#10;                return;&#10;            }&#10;&#10;            Console.Write(&quot;Recursive search? (y/n, default: n): &quot;);&#10;            bool recursive = Console.ReadLine()?.Trim().ToLower() == &quot;y&quot;;&#10;&#10;            Console.Write(&quot;Delete empty folders? (y/n, default: n): &quot;);&#10;            bool deleteEmpty = Console.ReadLine()?.Trim().ToLower() == &quot;y&quot;;&#10;&#10;            Console.WriteLine();&#10;&#10;            // Run the analysis&#10;            RunPerFileAnalysis(new[] { path }, recursive, summaryOnly: false, deleteEmpty);&#10;        }&#10;&#10;        private static void RunPerFileAnalysis(string[] paths, bool recursive, bool summaryOnly, bool deleteEmpty)&#10;        {&#10;            var results = new List&lt;FileCheckResult&gt;();&#10;&#10;            foreach (var path in paths)&#10;            {&#10;                if (File.Exists(path))&#10;                {&#10;                    // Single file&#10;                    WriteInfo($&quot;\nChecking file: {path}\n&quot;);&#10;                    var result = CheckFileIntegrity(path);&#10;                    results.Add(result);&#10;&#10;                    // Always create JSON report&#10;                    CreateJsonReport(result);&#10;&#10;                    // Create HTML report only for corrupted files&#10;                    if (result.HasIssues)&#10;                    {&#10;                        CreateErrorReport(result);&#10;                    }&#10;&#10;                    if (!summaryOnly)&#10;                        PrintDetailedResult(result);&#10;                }&#10;                else if (Directory.Exists(path))&#10;                {&#10;                    // Directory&#10;                    WriteInfo($&quot;\nChecking folder: {path}&quot;);&#10;                    WriteInfo($&quot;Recursive: {(recursive ? &quot;Yes&quot; : &quot;No&quot;)}\n&quot;);&#10;&#10;                    var searchOption = recursive ? SearchOption.AllDirectories : SearchOption.TopDirectoryOnly;&#10;                    var extensions = new[] { &quot;*.mov&quot;, &quot;*.mp4&quot;, &quot;*.m4v&quot;, &quot;*.m4a&quot; };&#10;&#10;                    var files = extensions&#10;                        .SelectMany(ext =&gt; Directory.GetFiles(path, ext, searchOption))&#10;                        .OrderBy(f =&gt; f)&#10;                        .ToList();&#10;&#10;                    if (files.Count == 0)&#10;                    {&#10;                        WriteWarning($&quot;No MOV/MP4 files found in: {path}&quot;);&#10;                        continue;&#10;                    }&#10;&#10;                    WriteInfo($&quot;Found {files.Count} file(s) to check...\n&quot;);&#10;&#10;                    int current = 0;&#10;                    foreach (var file in files)&#10;                    {&#10;                        current++;&#10;&#10;                        if (summaryOnly)&#10;                            Console.Write($&quot;\rProcessing: {current}/{files.Count} - {Path.GetFileName(file)}&quot;.PadRight(80));&#10;                        else&#10;                            WriteInfo($&quot;[{current}/{files.Count}] Checking: {Path.GetFileName(file)}&quot;);&#10;&#10;                        var result = CheckFileIntegrity(file);&#10;                        results.Add(result);&#10;&#10;                        // Always create JSON report&#10;                        CreateJsonReport(result);&#10;&#10;                        // Create HTML report only for corrupted files&#10;                        if (result.HasIssues)&#10;                        {&#10;                            CreateErrorReport(result);&#10;                        }&#10;&#10;                        if (!summaryOnly)&#10;                            PrintDetailedResult(result);&#10;                    }&#10;&#10;                    if (summaryOnly)&#10;                        Console.WriteLine(&quot;\n&quot;);&#10;&#10;                    // Delete empty folders if requested&#10;                    if (deleteEmpty)&#10;                    {&#10;                        DeleteEmptyDirectories(path, recursive);&#10;                    }&#10;                }&#10;                else&#10;                {&#10;                    WriteError($&quot;Path not found: {path}&quot;);&#10;                    Environment.ExitCode = 1;&#10;                }&#10;            }&#10;&#10;            // Print summary&#10;            PrintSummary(results, summaryOnly);&#10;        }&#10;&#10;        private static void PrintSummary(List&lt;FileCheckResult&gt; results, bool summaryOnly)&#10;        {&#10;            Console.WriteLine($&quot;\n{new string('=', 80)}&quot;);&#10;            Console.WriteLine(&quot;SUMMARY&quot;);&#10;            Console.WriteLine(new string('=', 80));&#10;&#10;            int totalFiles = results.Count;&#10;            int validFiles = results.Count(r =&gt; !r.HasIssues);&#10;            int corruptedFiles = results.Count(r =&gt; r.HasIssues);&#10;            long totalSize = results.Sum(r =&gt; r.FileSize);&#10;&#10;            Console.WriteLine($&quot;\nTotal Files Checked: {totalFiles}&quot;);&#10;            WriteSuccess($&quot;Valid Files: {validFiles} ({(validFiles * 100.0 / Math.Max(1, totalFiles)):F1}%)&quot;);&#10;            WriteError($&quot;Corrupted/Incomplete Files: {corruptedFiles} ({(corruptedFiles * 100.0 / Math.Max(1, totalFiles)):F1}%)&quot;);&#10;            Console.WriteLine($&quot;Total Size: {totalSize:N0} bytes ({totalSize / (1024.0 * 1024.0):F2} MB)&quot;);&#10;&#10;            if (corruptedFiles &gt; 0)&#10;            {&#10;                Console.WriteLine($&quot;\n❌ Corrupted/Incomplete Files:&quot;);&#10;                foreach (var result in results.Where(r =&gt; r.HasIssues))&#10;                {&#10;                    WriteError($&quot;   • {Path.GetFileName(result.FilePath)}&quot;);&#10;                    if (!summaryOnly &amp;&amp; result.Issues.Count &gt; 0)&#10;                    {&#10;                        foreach (var issue in result.Issues.Take(3))&#10;                            Console.WriteLine($&quot;      - {issue}&quot;);&#10;                        if (result.Issues.Count &gt; 3)&#10;                            Console.WriteLine($&quot;      ... and {result.Issues.Count - 3} more issue(s)&quot;);&#10;                    }&#10;                }&#10;            }&#10;&#10;            Environment.ExitCode = corruptedFiles &gt; 0 ? 1 : 0;&#10;        }&#10;&#10;        public static void RunGlobalAnalysis()&#10;        {&#10;            Console.WriteLine(&quot;╔════════════════════════════════════════════════════════════════╗&quot;);&#10;            Console.WriteLine(&quot;║              Global Analysis Mode                              ║&quot;);&#10;            Console.WriteLine(&quot;╚════════════════════════════════════════════════════════════════╝&quot;);&#10;            Console.WriteLine();&#10;&#10;            // Ask for the directory containing JSON reports&#10;            Console.Write(&quot;Enter the directory containing JSON reports\n(default: T:\\SPT\\SP\\Mont\\Projets\\3_PRJ\\9-ALEXANDRE_DEMERS-ROBERGE\\Fichiers Corrompus): &quot;);&#10;            string? jsonDir = Console.ReadLine()?.Trim().Trim('&quot;');&#10;&#10;            if (string.IsNullOrEmpty(jsonDir))&#10;            {&#10;                jsonDir = @&quot;T:\SPT\SP\Mont\Projets\3_PRJ\9-ALEXANDRE_DEMERS-ROBERGE\Fichiers Corrompus&quot;;&#10;            }&#10;&#10;            if (!Directory.Exists(jsonDir))&#10;            {&#10;                WriteError($&quot;Directory not found: {jsonDir}&quot;);&#10;                return;&#10;            }&#10;&#10;            WriteInfo($&quot;\nSearching for JSON reports in: {jsonDir}\n&quot;);&#10;&#10;            // Find all JSON report files&#10;            var jsonFiles = Directory.GetFiles(jsonDir, &quot;*_report.json&quot;, SearchOption.TopDirectoryOnly);&#10;&#10;            if (jsonFiles.Length == 0)&#10;            {&#10;                WriteWarning(&quot;No JSON report files found. Please run per-file analysis first to generate reports.&quot;);&#10;                return;&#10;            }&#10;&#10;            WriteInfo($&quot;Found {jsonFiles.Length} JSON report(s). Loading data...\n&quot;);&#10;&#10;            // Load all reports&#10;            var reports = new List&lt;JsonCorruptionReport&gt;();&#10;            foreach (var jsonFile in jsonFiles)&#10;            {&#10;                try&#10;                {&#10;                    string jsonContent = File.ReadAllText(jsonFile);&#10;                    var report = JsonSerializer.Deserialize&lt;JsonCorruptionReport&gt;(jsonContent);&#10;                    if (report != null)&#10;                    {&#10;                        reports.Add(report);&#10;                    }&#10;                }&#10;                catch (Exception ex)&#10;                {&#10;                    WriteWarning($&quot;Failed to load {Path.GetFileName(jsonFile)}: {ex.Message}&quot;);&#10;                }&#10;            }&#10;&#10;            if (reports.Count == 0)&#10;            {&#10;                WriteError(&quot;No valid reports could be loaded.&quot;);&#10;                return;&#10;            }&#10;&#10;            WriteSuccess($&quot;Loaded {reports.Count} report(s) successfully.\n&quot;);&#10;&#10;            // Generate global report&#10;            GenerateGlobalHtmlReport(reports, jsonDir);&#10;        }&#10;&#10;        public static void GenerateGlobalHtmlReport(List&lt;JsonCorruptionReport&gt; reports, string outputDir)&#10;        {&#10;            WriteInfo(&quot;Analyzing data and generating global report...\n&quot;);&#10;&#10;            // Calculate statistics&#10;            int totalFiles = reports.Count;&#10;            int corruptedFiles = reports.Count(r =&gt; r.Status.IsCorrupted);&#10;            int completeFiles = reports.Count(r =&gt; r.Status.IsComplete);&#10;            int incompleteFiles = totalFiles - completeFiles;&#10;&#10;            long totalBytes = reports.Sum(r =&gt; r.FileMetadata.FileSizeBytes);&#10;            double totalMB = totalBytes / (1024.0 * 1024.0);&#10;            double totalGB = totalBytes / (1024.0 * 1024.0 * 1024.0);&#10;&#10;            // Duration analysis (only for files with duration data)&#10;            var reportsWithDuration = reports.Where(r =&gt; r.VideoDuration != null).ToList();&#10;&#10;            // Hour-based heatmap data (transfer failures by hour)&#10;            var hourlyFailures = new int[24];&#10;            var hourlyTotal = new int[24];&#10;            foreach (var report in reports)&#10;            {&#10;                int hour = report.FileMetadata.LastModifiedTimeUtc.ToLocalTime().Hour;&#10;                hourlyTotal[hour]++;&#10;                if (report.Status.IsCorrupted)&#10;                    hourlyFailures[hour]++;&#10;            }&#10;            &#10;            // Scatter plot data: file size vs playable percentage (all files)&#10;            var scatterDataCorrupted = reportsWithDuration&#10;                .Where(r =&gt; r.Status.IsCorrupted)&#10;                .Select(r =&gt; new {&#10;                    SizeMB = r.FileMetadata.FileSizeMB,&#10;                    PlayablePercent = r.VideoDuration!.PlayablePercentage,&#10;                    FileName = r.FileMetadata.FileName,&#10;                    IsCorrupted = true&#10;                })&#10;                .ToList();&#10;&#10;            var scatterDataValid = reportsWithDuration&#10;                .Where(r =&gt; !r.Status.IsCorrupted)&#10;                .Select(r =&gt; new {&#10;                    SizeMB = r.FileMetadata.FileSizeMB,&#10;                    PlayablePercent = r.VideoDuration!.PlayablePercentage,&#10;                    FileName = r.FileMetadata.FileName,&#10;                    IsCorrupted = false&#10;                })&#10;                .ToList();&#10;&#10;            var scatterData = scatterDataCorrupted.Concat(scatterDataValid).ToList();&#10;&#10;            // Timeline data: creation vs last modified times&#10;            var timelineData = reports&#10;                .Select(r =&gt; new {&#10;                    FileName = r.FileMetadata.FileName,&#10;                    CreationTime = r.FileMetadata.CreationTimeUtc.ToLocalTime(),&#10;                    LastModifiedTime = r.FileMetadata.LastModifiedTimeUtc.ToLocalTime(),&#10;                    IsCorrupted = r.Status.IsCorrupted,&#10;                    DurationHours = (r.FileMetadata.LastModifiedTimeUtc - r.FileMetadata.CreationTimeUtc).TotalHours&#10;                })&#10;                .OrderBy(x =&gt; x.CreationTime)&#10;                .ToList();&#10;&#10;            // Correlation between file size and corruption&#10;            var fileSizeRanges = new Dictionary&lt;string, (int total, int corrupted)&gt;&#10;            {&#10;                [&quot;0-100 MB&quot;] = (0, 0),&#10;                [&quot;100-500 MB&quot;] = (0, 0),&#10;                [&quot;500 MB-1 GB&quot;] = (0, 0),&#10;                [&quot;1-5 GB&quot;] = (0, 0),&#10;                [&quot;5+ GB&quot;] = (0, 0)&#10;            };&#10;&#10;            foreach (var report in reports)&#10;            {&#10;                double sizeMB = report.FileMetadata.FileSizeMB;&#10;                bool isCorrupted = report.Status.IsCorrupted;&#10;&#10;                string range;&#10;                if (sizeMB &lt; 100) range = &quot;0-100 MB&quot;;&#10;                else if (sizeMB &lt; 500) range = &quot;100-500 MB&quot;;&#10;                else if (sizeMB &lt; 1024) range = &quot;500 MB-1 GB&quot;;&#10;                else if (sizeMB &lt; 5120) range = &quot;1-5 GB&quot;;&#10;                else range = &quot;5+ GB&quot;;&#10;&#10;                var (total, corrupted) = fileSizeRanges[range];&#10;                fileSizeRanges[range] = (total + 1, isCorrupted ? corrupted + 1 : corrupted);&#10;            }&#10;&#10;            // Duration correlation&#10;            var durationRanges = new Dictionary&lt;string, (int total, int corrupted)&gt;&#10;            {&#10;                [&quot;0-1 min&quot;] = (0, 0),&#10;                [&quot;1-5 min&quot;] = (0, 0),&#10;                [&quot;5-15 min&quot;] = (0, 0),&#10;                [&quot;15-30 min&quot;] = (0, 0),&#10;                [&quot;30+ min&quot;] = (0, 0)&#10;            };&#10;&#10;            foreach (var report in reportsWithDuration)&#10;            {&#10;                double durationSec = report.VideoDuration!.TotalDurationSeconds;&#10;                bool isCorrupted = report.Status.IsCorrupted;&#10;&#10;                string range;&#10;                if (durationSec &lt; 60) range = &quot;0-1 min&quot;;&#10;                else if (durationSec &lt; 300) range = &quot;1-5 min&quot;;&#10;                else if (durationSec &lt; 900) range = &quot;5-15 min&quot;;&#10;                else if (durationSec &lt; 1800) range = &quot;15-30 min&quot;;&#10;                else range = &quot;30+ min&quot;;&#10;&#10;                var (total, corrupted) = durationRanges[range];&#10;                durationRanges[range] = (total + 1, isCorrupted ? corrupted + 1 : corrupted);&#10;            }&#10;&#10;            // Generate HTML&#10;            var html = new StringBuilder();&#10;            html.AppendLine(&quot;&lt;!DOCTYPE html&gt;&quot;);&#10;            html.AppendLine(&quot;&lt;html lang=\&quot;en\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;&lt;head&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;meta charset=\&quot;UTF-8\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1.0\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;title&gt;Video Transfer Failure Analysis Dashboard&lt;/title&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;script src=\&quot;https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js\&quot;&gt;&lt;/script&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;style&gt;&quot;);&#10;            html.AppendLine(&quot;        * { margin: 0; padding: 0; box-sizing: border-box; }&quot;);&#10;            html.AppendLine(&quot;        body {&quot;);&#10;            html.AppendLine(&quot;            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;&quot;);&#10;            html.AppendLine(&quot;            background: #0f0f1e;&quot;);&#10;            html.AppendLine(&quot;            color: #e0e0e0;&quot;);&#10;            html.AppendLine(&quot;            padding: 20px;&quot;);&#10;            html.AppendLine(&quot;            min-height: 100vh;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .container {&quot;);&#10;            html.AppendLine(&quot;            max-width: 1600px;&quot;);&#10;            html.AppendLine(&quot;            margin: 0 auto;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .header {&quot;);&#10;            html.AppendLine(&quot;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&quot;);&#10;            html.AppendLine(&quot;            padding: 40px;&quot;);&#10;            html.AppendLine(&quot;            border-radius: 16px;&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 30px;&quot;);&#10;            html.AppendLine(&quot;            box-shadow: 0 10px 50px rgba(102, 126, 234, 0.3);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .header h1 {&quot;);&#10;            html.AppendLine(&quot;            font-size: 2.8em;&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 10px;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 700;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .header .subtitle {&quot;);&#10;            html.AppendLine(&quot;            font-size: 1.2em;&quot;);&#10;            html.AppendLine(&quot;            opacity: 0.95;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .stats-grid {&quot;);&#10;            html.AppendLine(&quot;            display: grid;&quot;);&#10;            html.AppendLine(&quot;            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));&quot;);&#10;            html.AppendLine(&quot;            gap: 20px;&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 30px;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .stat-card {&quot;);&#10;            html.AppendLine(&quot;            background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.04) 100%);&quot;);&#10;            html.AppendLine(&quot;            padding: 25px;&quot;);&#10;            html.AppendLine(&quot;            border-radius: 12px;&quot;);&#10;            html.AppendLine(&quot;            border: 1px solid rgba(255,255,255,0.12);&quot;);&#10;            html.AppendLine(&quot;            backdrop-filter: blur(10px);&quot;);&#10;            html.AppendLine(&quot;            transition: transform 0.2s, box-shadow 0.2s;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .stat-card:hover {&quot;);&#10;            html.AppendLine(&quot;            transform: translateY(-3px);&quot;);&#10;            html.AppendLine(&quot;            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .stat-card .label {&quot;);&#10;            html.AppendLine(&quot;            font-size: 0.85em;&quot;);&#10;            html.AppendLine(&quot;            color: #999;&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 8px;&quot;);&#10;            html.AppendLine(&quot;            text-transform: uppercase;&quot;);&#10;            html.AppendLine(&quot;            letter-spacing: 1.2px;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 600;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .stat-card .value {&quot;);&#10;            html.AppendLine(&quot;            font-size: 2.5em;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 700;&quot;);&#10;            html.AppendLine(&quot;            color: #667eea;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .stat-card.success .value { color: #10b981; }&quot;);&#10;            html.AppendLine(&quot;        .stat-card.error .value { color: #ef4444; }&quot;);&#10;            html.AppendLine(&quot;        .stat-card.warning .value { color: #f59e0b; }&quot;);&#10;            html.AppendLine(&quot;        .charts-grid {&quot;);&#10;            html.AppendLine(&quot;            display: grid;&quot;);&#10;            html.AppendLine(&quot;            grid-template-columns: repeat(auto-fit, minmax(550px, 1fr));&quot;);&#10;            html.AppendLine(&quot;            gap: 25px;&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 30px;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .chart-container {&quot;);&#10;            html.AppendLine(&quot;            background: rgba(255,255,255,0.03);&quot;);&#10;            html.AppendLine(&quot;            padding: 30px;&quot;);&#10;            html.AppendLine(&quot;            border-radius: 12px;&quot;);&#10;            html.AppendLine(&quot;            border: 1px solid rgba(255,255,255,0.08);&quot;);&#10;            html.AppendLine(&quot;            box-shadow: 0 4px 15px rgba(0,0,0,0.2);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .chart-container h2 {&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 20px;&quot;);&#10;            html.AppendLine(&quot;            color: #fff;&quot;);&#10;            html.AppendLine(&quot;            font-size: 1.4em;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 600;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .chart-container canvas {&quot;);&#10;            html.AppendLine(&quot;            max-height: 400px;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .full-width {&quot;);&#10;            html.AppendLine(&quot;            grid-column: 1 / -1;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights {&quot;);&#10;            html.AppendLine(&quot;            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%);&quot;);&#10;            html.AppendLine(&quot;            padding: 35px;&quot;);&#10;            html.AppendLine(&quot;            border-radius: 12px;&quot;);&#10;            html.AppendLine(&quot;            border-left: 5px solid #667eea;&quot;);&#10;            html.AppendLine(&quot;            margin-top: 30px;&quot;);&#10;            html.AppendLine(&quot;            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.2);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights h2 {&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 20px;&quot;);&#10;            html.AppendLine(&quot;            color: #667eea;&quot;);&#10;            html.AppendLine(&quot;            font-size: 1.8em;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights ul {&quot;);&#10;            html.AppendLine(&quot;            list-style: none;&quot;);&#10;            html.AppendLine(&quot;            padding-left: 0;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights li {&quot;);&#10;            html.AppendLine(&quot;            padding: 12px 0;&quot;);&#10;            html.AppendLine(&quot;            border-bottom: 1px solid rgba(255,255,255,0.1);&quot;);&#10;            html.AppendLine(&quot;            font-size: 1.05em;&quot;);&#10;            html.AppendLine(&quot;            line-height: 1.6;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights li:last-child {&quot;);&#10;            html.AppendLine(&quot;            border-bottom: none;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights li:before {&quot;);&#10;            html.AppendLine(&quot;            content: '▸ ';&quot;);&#10;            html.AppendLine(&quot;            color: #667eea;&quot;);&#10;            html.AppendLine(&quot;            font-weight: bold;&quot;);&#10;            html.AppendLine(&quot;            margin-right: 10px;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights .conclusion {&quot;);&#10;            html.AppendLine(&quot;            margin-top: 20px;&quot;);&#10;            html.AppendLine(&quot;            padding: 20px;&quot;);&#10;            html.AppendLine(&quot;            background: rgba(239, 68, 68, 0.15);&quot;);&#10;            html.AppendLine(&quot;            border-left: 4px solid #ef4444;&quot;);&#10;            html.AppendLine(&quot;            border-radius: 8px;&quot;);&#10;            html.AppendLine(&quot;            font-size: 1.1em;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 600;&quot;);&#10;            html.AppendLine(&quot;            color: #fca5a5;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .data-table {&quot;);&#10;            html.AppendLine(&quot;            width: 100%;&quot;);&#10;            html.AppendLine(&quot;            border-collapse: collapse;&quot;);&#10;            html.AppendLine(&quot;            margin-top: 20px;&quot;);&#10;            html.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .data-table th {&quot;);&#10;            html.AppendLine(&quot;            background: rgba(102, 126, 234, 0.2);&quot;);&#10;            html.AppendLine(&quot;            padding: 12px;&quot;);&#10;            html.AppendLine(&quot;            text-align: left;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 600;&quot;);&#10;            html.AppendLine(&quot;            color: #667eea;&quot;);&#10;            html.AppendLine(&quot;            border-bottom: 2px solid rgba(102, 126, 234, 0.5);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .data-table td {&quot;);&#10;            html.AppendLine(&quot;            padding: 10px 12px;&quot;);&#10;            html.AppendLine(&quot;            border-bottom: 1px solid rgba(255,255,255,0.05);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .data-table tr:hover {&quot;);&#10;            html.AppendLine(&quot;            background: rgba(255,255,255,0.03);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .corrupted-row {&quot;);&#10;            html.AppendLine(&quot;            color: #fca5a5;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .valid-row {&quot;);&#10;            html.AppendLine(&quot;            color: #86efac;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .status-badge {&quot;);&#10;            html.AppendLine(&quot;            padding: 4px 8px;&quot;);&#10;            html.AppendLine(&quot;            border-radius: 4px;&quot;);&#10;            html.AppendLine(&quot;            font-size: 0.85em;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 600;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .footer {&quot;);&#10;            html.AppendLine(&quot;            text-align: center;&quot;);&#10;            html.AppendLine(&quot;            margin-top: 50px;&quot;);&#10;            html.AppendLine(&quot;            padding: 20px;&quot;);&#10;            html.AppendLine(&quot;            color: #666;&quot;);&#10;            html.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;    &lt;/style&gt;&quot;);&#10;            html.AppendLine(&quot;&lt;/head&gt;&quot;);&#10;            html.AppendLine(&quot;&lt;body&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;div class=\&quot;container\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;        &lt;div class=\&quot;header\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;h1&gt; Video Transfer Failure Analysis Dashboard&lt;/h1&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;div class=\&quot;subtitle\&quot;&gt;Generated on {DateTime.Now:yyyy-MM-dd HH:mm:ss} | Analyzing {totalFiles} video files | MovFileIntegrityChecker v1.0&lt;/div&gt;&quot;);&#10;            html.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;            // Stats cards&#10;            html.AppendLine(&quot;        &lt;div class=\&quot;stats-grid\&quot;&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;div class=\&quot;stat-card\&quot;&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;label\&quot;&gt;Total Files&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;value\&quot;&gt;{totalFiles}&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;div class=\&quot;stat-card success\&quot;&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;label\&quot;&gt;Complete Files&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;value\&quot;&gt;{completeFiles}&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;div class=\&quot;stat-card error\&quot;&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;label\&quot;&gt;Corrupted Files&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;value\&quot;&gt;{corruptedFiles}&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;div class=\&quot;stat-card warning\&quot;&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;label\&quot;&gt;Total Size&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;value\&quot;&gt;{(totalGB &gt;= 1 ? $&quot;{totalGB:F2} GB&quot; : $&quot;{totalMB:F2} MB&quot;)}&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;/div&gt;&quot;);&#10;            html.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;            // Charts&#10;            html.AppendLine(&quot;        &lt;div class=\&quot;charts-grid\&quot;&gt;&quot;);&#10;            &#10;            // Complete vs Incomplete pie chart&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;chart-container\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;h2&gt;File Completeness Status&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;canvas id=\&quot;completenessChart\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;            // Corrupted vs Non-corrupted pie chart&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;chart-container\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;h2&gt;File Corruption Status&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;canvas id=\&quot;corruptionChart\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;            // File size vs corruption bar chart&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;chart-container full-width\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;h2&gt;Corruption Rate by File Size&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;canvas id=\&quot;fileSizeChart\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;            // Duration vs corruption bar chart (if data available)&#10;            if (reportsWithDuration.Count &gt; 0)&#10;            {&#10;                html.AppendLine(&quot;            &lt;div class=\&quot;chart-container full-width\&quot;&gt;&quot;);&#10;                html.AppendLine(&quot;                &lt;h2&gt;Corruption Rate by Video Duration&lt;/h2&gt;&quot;);&#10;                html.AppendLine(&quot;                &lt;canvas id=\&quot;durationChart\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;                html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;            }&#10;&#10;            // Heatmap: Transfer failure by hour&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;chart-container full-width\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;h2&gt; Transfer Failure Frequency by Hour (Local Time)&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;canvas id=\&quot;hourlyHeatmap\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;            // Scatter plot: File size vs Playable percentage&#10;            if (scatterData.Count &gt; 0)&#10;            {&#10;                html.AppendLine(&quot;            &lt;div class=\&quot;chart-container\&quot;&gt;&quot;);&#10;                html.AppendLine(&quot;                &lt;h2&gt; File Size vs Playable %&lt;/h2&gt;&quot;);&#10;                html.AppendLine(&quot;                &lt;canvas id=\&quot;scatterSizePlayable\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;                html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;            }&#10;&#10;            // Scatter plot: Last modified hour vs Corruption&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;chart-container\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;h2&gt;⏰ Last Modified Hour vs Corruption Rate&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;canvas id=\&quot;scatterHourCorruption\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;            // Timeline: Creation vs Last Modified&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;chart-container full-width\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;h2&gt; File Creation vs Last Modification Timeline&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;canvas id=\&quot;timelineChart\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;            html.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;            // Data table - show all files sorted by corruption percentage (corrupted first)&#10;            html.AppendLine(&quot;        &lt;div class=\&quot;chart-container\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;h2&gt; Detailed File Analysis&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;table class=\&quot;data-table\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;thead&gt;&quot;);&#10;            html.AppendLine(&quot;                    &lt;tr&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;File Name&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;Size (MB)&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;Duration&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;Playable %&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;Corruption %&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;Last Modified Hour&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;Status&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                    &lt;/tr&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;/thead&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;tbody&gt;&quot;);&#10;            &#10;            // Add all files to the table, sorted by corruption (corrupted files first, then by corruption %)&#10;            var allFilesForTable = reports&#10;                .OrderByDescending(r =&gt; r.Status.IsCorrupted)&#10;                .ThenByDescending(r =&gt; r.VideoDuration?.CorruptedPercentage ?? 0)&#10;                .ToList();&#10;&#10;            foreach (var report in allFilesForTable)&#10;            {&#10;                var duration = report.VideoDuration?.TotalDurationFormatted ?? &quot;N/A&quot;;&#10;                var playable = report.VideoDuration?.PlayablePercentage.ToString(&quot;F1&quot;) ?? &quot;N/A&quot;;&#10;                var corruption = report.VideoDuration?.CorruptedPercentage.ToString(&quot;F1&quot;) ?? &quot;N/A&quot;;&#10;                var hour = report.FileMetadata.LastModifiedTimeUtc.ToLocalTime().Hour;&#10;                var rowClass = report.Status.IsCorrupted ? &quot;corrupted-row&quot; : &quot;valid-row&quot;;&#10;                var statusBadge = report.Status.IsCorrupted ? &quot;❌ Corrupted&quot; : &quot;✅ Valid&quot;;&#10;                &#10;                html.AppendLine($&quot;                    &lt;tr class=\&quot;{rowClass}\&quot;&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;{System.Security.SecurityElement.Escape(report.FileMetadata.FileName)}&lt;/td&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;{report.FileMetadata.FileSizeMB:F2}&lt;/td&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;{duration}&lt;/td&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;{playable}%&lt;/td&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;{corruption}%&lt;/td&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;{hour:D2}:00&lt;/td&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;&lt;span class=\&quot;status-badge\&quot;&gt;{statusBadge}&lt;/span&gt;&lt;/td&gt;&quot;);&#10;                html.AppendLine(&quot;                    &lt;/tr&gt;&quot;);&#10;            }&#10;&#10;            html.AppendLine(&quot;                &lt;/tbody&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/table&gt;&quot;);&#10;            html.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;            // Insights section&#10;            html.AppendLine(&quot;        &lt;div class=\&quot;insights\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;h2&gt; Key Insights &amp; Correlations&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;ul&gt;&quot;);&#10;&#10;            // Generate insights&#10;            double corruptionRate = (double)corruptedFiles / totalFiles * 100;&#10;            html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;Overall corruption rate:&lt;/strong&gt; {corruptionRate:F1}% ({corruptedFiles} out of {totalFiles} files are corrupted or incomplete)&lt;/li&gt;&quot;);&#10;&#10;            // Hourly analysis - find peak failure times&#10;            var peakHours = hourlyFailures&#10;                .Select((count, hour) =&gt; new { Hour = hour, Count = count, Total = hourlyTotal[hour] })&#10;                .Where(x =&gt; x.Total &gt; 0)&#10;                .OrderByDescending(x =&gt; (double)x.Count / x.Total)&#10;                .Take(3)&#10;                .ToList();&#10;&#10;            if (peakHours.Any())&#10;            {&#10;                var top = peakHours[0];&#10;                double peakRate = (double)top.Count / top.Total * 100;&#10;                if (peakRate &gt; corruptionRate * 1.2) // At least 20% higher than average&#10;                {&#10;                    var timeRanges = peakHours&#10;                        .Where(x =&gt; (double)x.Count / x.Total * 100 &gt; corruptionRate * 1.1)&#10;                        .Select(x =&gt; $&quot;{x.Hour:D2}:00-{(x.Hour + 1) % 24:D2}:00&quot;)&#10;                        .ToList();&#10;                    &#10;                    html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;⚠️ High-risk time window:&lt;/strong&gt; {peakRate:F1}% of files modified at {top.Hour:D2}:00-{(top.Hour + 1) % 24:D2}:00 are corrupted (peak failure time)&lt;/li&gt;&quot;);&#10;                    &#10;                    if (timeRanges.Count &gt; 1)&#10;                    {&#10;                        html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;Additional risk windows:&lt;/strong&gt; {string.Join(&quot;, &quot;, timeRanges.Skip(1))}&lt;/li&gt;&quot;);&#10;                    }&#10;                }&#10;            }&#10;&#10;            // Find highest risk file size range&#10;            var highestRiskSize = fileSizeRanges&#10;                .Where(kvp =&gt; kvp.Value.total &gt; 0)&#10;                .OrderByDescending(kvp =&gt; (double)kvp.Value.corrupted / kvp.Value.total)&#10;                .FirstOrDefault();&#10;            &#10;            if (highestRiskSize.Key != null)&#10;            {&#10;                double riskRate = (double)highestRiskSize.Value.corrupted / highestRiskSize.Value.total * 100;&#10;                html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;File size correlation:&lt;/strong&gt; {highestRiskSize.Key} range shows highest corruption risk at {riskRate:F1}%&lt;/li&gt;&quot;);&#10;            }&#10;&#10;            // Find highest risk duration range&#10;            if (reportsWithDuration.Count &gt; 0)&#10;            {&#10;                var highestRiskDuration = durationRanges&#10;                    .Where(kvp =&gt; kvp.Value.total &gt; 0)&#10;                    .OrderByDescending(kvp =&gt; (double)kvp.Value.corrupted / kvp.Value.total)&#10;                    .FirstOrDefault();&#10;                &#10;                if (highestRiskDuration.Key != null)&#10;                {&#10;                    double riskRate = (double)highestRiskDuration.Value.corrupted / highestRiskDuration.Value.total * 100;&#10;                    html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;Duration correlation:&lt;/strong&gt; {highestRiskDuration.Key} videos have {riskRate:F1}% corruption rate&lt;/li&gt;&quot;);&#10;                }&#10;            }&#10;&#10;            // Average playable percentage for corrupted files&#10;            var corruptedWithDuration = reportsWithDuration.Where(r =&gt; r.Status.IsCorrupted).ToList();&#10;            if (corruptedWithDuration.Count &gt; 0)&#10;            {&#10;                double avgPlayable = corruptedWithDuration.Average(r =&gt; r.VideoDuration!.PlayablePercentage);&#10;                html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;Data recovery potential:&lt;/strong&gt; Corrupted files retain {avgPlayable:F1}% playable content on average&lt;/li&gt;&quot;);&#10;            }&#10;&#10;            // Transfer interruption patterns&#10;            var abruptStops = timelineData&#10;                .Where(x =&gt; x.IsCorrupted &amp;&amp; x.DurationHours &lt; 1)&#10;                .Count();&#10;            &#10;            if (abruptStops &gt; 0)&#10;            {&#10;                double abruptRate = (double)abruptStops / corruptedFiles * 100;&#10;                html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;Transfer interruption pattern:&lt;/strong&gt; {abruptRate:F1}% of corrupted files show signs of abrupt transfer termination (modified within 1 hour of creation)&lt;/li&gt;&quot;);&#10;            }&#10;&#10;            // Most common issues&#10;            var allIssues = reports&#10;                .SelectMany(r =&gt; r.IntegrityAnalysis.Issues)&#10;                .Where(i =&gt; !string.IsNullOrEmpty(i))&#10;                .GroupBy(i =&gt; i.Contains(&quot;Incomplete atom&quot;) ? &quot;Incomplete atom&quot; : &#10;                              i.Contains(&quot;Missing&quot;) ? &quot;Missing atom&quot; : &#10;                              i.Contains(&quot;Gap&quot;) ? &quot;Gap after last atom&quot; : i)&#10;                .OrderByDescending(g =&gt; g.Count())&#10;                .Take(3)&#10;                .ToList();&#10;&#10;            if (allIssues.Count &gt; 0)&#10;            {&#10;                html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;Most common structural issue:&lt;/strong&gt; \&quot;{allIssues[0].Key}\&quot; detected in {allIssues[0].Count()} files ({(double)allIssues[0].Count() / totalFiles * 100:F1}%)&lt;/li&gt;&quot;);&#10;            }&#10;&#10;            html.AppendLine(&quot;            &lt;/ul&gt;&quot;);&#10;&#10;            // Root cause conclusion&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;conclusion\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;strong&gt; Likely Root Cause:&lt;/strong&gt; &quot;);&#10;            &#10;            // Determine likely cause based on patterns&#10;            if (peakHours.Any() &amp;&amp; (double)peakHours[0].Count / peakHours[0].Total * 100 &gt; corruptionRate * 1.5)&#10;            {&#10;                var topHour = peakHours[0].Hour;&#10;                if (topHour &gt;= 2 &amp;&amp; topHour &lt;= 5)&#10;                {&#10;                    html.AppendLine(&quot;                Scheduled server maintenance or automatic shutdown during nightly hours (03:00-05:00) is likely interrupting ongoing file transfers.&quot;);&#10;                }&#10;                else if (topHour &gt;= 12 &amp;&amp; topHour &lt;= 14)&#10;                {&#10;                    html.AppendLine(&quot;                Network congestion or server load during peak hours (12:00-14:00) may be causing transfer timeouts and incomplete file writes.&quot;);&#10;                }&#10;                else&#10;                {&#10;                    html.AppendLine($&quot;                Systematic failures occur predominantly at {topHour:D2}:00-{(topHour + 1) % 24:D2}:00, suggesting scheduled operations or resource constraints during this time window.&quot;);&#10;                }&#10;            }&#10;            else if (highestRiskSize.Key != null &amp;&amp; highestRiskSize.Key.Contains(&quot;GB&quot;))&#10;            {&#10;                html.AppendLine(&quot;                Larger files are disproportionately affected, indicating network timeout issues or insufficient buffer sizes for large file transfers.&quot;);&#10;            }&#10;            else&#10;            {&#10;                html.AppendLine(&quot;                File transfers are being interrupted before completion, likely due to network instability, storage issues, or application crashes during write operations.&quot;);&#10;            }&#10;            &#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;            html.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;            // Footer&#10;            html.AppendLine(&quot;        &lt;div class=\&quot;footer\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;p&gt;Generated by MovFileIntegrityChecker v1.0&lt;/p&gt;&quot;);&#10;            html.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;/div&gt;&quot;);&#10;&#10;            // Chart.js scripts&#10;            html.AppendLine(&quot;    &lt;script&gt;&quot;);&#10;            html.AppendLine(&quot;        Chart.defaults.color = '#ffffff';&quot;);&#10;            html.AppendLine(&quot;        Chart.defaults.borderColor = 'rgba(255,255,255,0.1)';&quot;);&#10;&#10;            // Completeness chart&#10;            html.AppendLine(&quot;        new Chart(document.getElementById('completenessChart'), {&quot;);&#10;            html.AppendLine(&quot;            type: 'pie',&quot;);&#10;            html.AppendLine(&quot;            data: {&quot;);&#10;            html.AppendLine($&quot;                labels: ['Complete ({completeFiles})', 'Incomplete ({incompleteFiles})'],&quot;);&#10;            html.AppendLine(&quot;                datasets: [{&quot;);&#10;            html.AppendLine($&quot;                    data: [{completeFiles}, {incompleteFiles}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: ['#10b981', '#ef4444'],&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 2,&quot;);&#10;            html.AppendLine(&quot;                    borderColor: '#1a1a2e'&quot;);&#10;            html.AppendLine(&quot;                }]&quot;);&#10;            html.AppendLine(&quot;            },&quot;);&#10;            html.AppendLine(&quot;            options: {&quot;);&#10;            html.AppendLine(&quot;                responsive: true,&quot;);&#10;            html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;            html.AppendLine(&quot;                plugins: {&quot;);&#10;            html.AppendLine(&quot;                    legend: { position: 'bottom' }&quot;);&#10;            html.AppendLine(&quot;                }&quot;);&#10;            html.AppendLine(&quot;            }&quot;);&#10;            html.AppendLine(&quot;        });&quot;);&#10;&#10;            // Corruption chart&#10;            int nonCorrupted = totalFiles - corruptedFiles;&#10;            html.AppendLine(&quot;        new Chart(document.getElementById('corruptionChart'), {&quot;);&#10;            html.AppendLine(&quot;            type: 'pie',&quot;);&#10;            html.AppendLine(&quot;            data: {&quot;);&#10;            html.AppendLine($&quot;                labels: ['Valid ({nonCorrupted})', 'Corrupted ({corruptedFiles})'],&quot;);&#10;            html.AppendLine(&quot;                datasets: [{&quot;);&#10;            html.AppendLine($&quot;                    data: [{nonCorrupted}, {corruptedFiles}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: ['#10b981', '#ef4444'],&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 2,&quot;);&#10;            html.AppendLine(&quot;                    borderColor: '#1a1a2e'&quot;);&#10;            html.AppendLine(&quot;                }]&quot;);&#10;            html.AppendLine(&quot;            },&quot;);&#10;            html.AppendLine(&quot;            options: {&quot;);&#10;            html.AppendLine(&quot;                responsive: true,&quot;);&#10;            html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;            html.AppendLine(&quot;                plugins: {&quot;);&#10;            html.AppendLine(&quot;                    legend: { position: 'bottom' }&quot;);&#10;            html.AppendLine(&quot;                }&quot;);&#10;            html.AppendLine(&quot;            }&quot;);&#10;            html.AppendLine(&quot;        });&quot;);&#10;&#10;            // File size chart&#10;            var sizeLabels = string.Join(&quot;, &quot;, fileSizeRanges.Keys.Select(k =&gt; $&quot;'{k}'&quot;));&#10;            var sizeTotals = string.Join(&quot;, &quot;, fileSizeRanges.Values.Select(v =&gt; v.total));&#10;            var sizeCorrupted = string.Join(&quot;, &quot;, fileSizeRanges.Values.Select(v =&gt; v.corrupted));&#10;            var sizePercentages = string.Join(&quot;, &quot;, fileSizeRanges.Values.Select(v =&gt; &#10;                v.total &gt; 0 ? ((double)v.corrupted / v.total * 100).ToString(&quot;F1&quot;) : &quot;0&quot;));&#10;&#10;            html.AppendLine(&quot;        new Chart(document.getElementById('fileSizeChart'), {&quot;);&#10;            html.AppendLine(&quot;            type: 'bar',&quot;);&#10;            html.AppendLine(&quot;            data: {&quot;);&#10;            html.AppendLine($&quot;                labels: [{sizeLabels}],&quot;);&#10;            html.AppendLine(&quot;                datasets: [{&quot;);&#10;            html.AppendLine(&quot;                    label: 'Total Files',&quot;);&#10;            html.AppendLine($&quot;                    data: [{sizeTotals}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(102, 126, 234, 0.6)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(102, 126, 234, 1)',&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;            html.AppendLine(&quot;                }, {&quot;);&#10;            html.AppendLine(&quot;                    label: 'Corrupted Files',&quot;);&#10;            html.AppendLine($&quot;                    data: [{sizeCorrupted}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(239, 68, 68, 0.6)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(239, 68, 68, 1)',&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;            html.AppendLine(&quot;                }]&quot;);&#10;            html.AppendLine(&quot;            },&quot;);&#10;            html.AppendLine(&quot;            options: {&quot;);&#10;            html.AppendLine(&quot;                responsive: true,&quot;);&#10;            html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;            html.AppendLine(&quot;                scales: {&quot;);&#10;            html.AppendLine(&quot;                    y: { beginAtZero: true }&quot;);&#10;            html.AppendLine(&quot;                },&quot;);&#10;            html.AppendLine(&quot;                plugins: {&quot;);&#10;            html.AppendLine(&quot;                    legend: { position: 'top' },&quot;);&#10;            html.AppendLine(&quot;                    tooltip: {&quot;);&#10;            html.AppendLine(&quot;                        callbacks: {&quot;);&#10;            html.AppendLine(&quot;                            afterLabel: function(context) {&quot;);&#10;            html.AppendLine($&quot;                                const percentages = [{sizePercentages}];&quot;);&#10;            html.AppendLine(&quot;                                if (context.datasetIndex === 1) {&quot;);&#10;            html.AppendLine(&quot;                                    return 'Corruption Rate: ' + percentages[context.dataIndex] + '%';&quot;);&#10;            html.AppendLine(&quot;                                }&quot;);&#10;            html.AppendLine(&quot;                            }&quot;);&#10;            html.AppendLine(&quot;                        }&quot;);&#10;            html.AppendLine(&quot;                    }&quot;);&#10;            html.AppendLine(&quot;                }&quot;);&#10;            html.AppendLine(&quot;            }&quot;);&#10;            html.AppendLine(&quot;        });&quot;);&#10;&#10;            // Duration chart (if data available)&#10;            if (reportsWithDuration.Count &gt; 0)&#10;            {&#10;                var durationLabels = string.Join(&quot;, &quot;, durationRanges.Keys.Select(k =&gt; $&quot;'{k}'&quot;));&#10;                var durationTotals = string.Join(&quot;, &quot;, durationRanges.Values.Select(v =&gt; v.total));&#10;                var durationCorrupted = string.Join(&quot;, &quot;, durationRanges.Values.Select(v =&gt; v.corrupted));&#10;                var durationPercentages = string.Join(&quot;, &quot;, durationRanges.Values.Select(v =&gt; &#10;                    v.total &gt; 0 ? ((double)v.corrupted / v.total * 100).ToString(&quot;F1&quot;) : &quot;0&quot;));&#10;&#10;                html.AppendLine(&quot;        new Chart(document.getElementById('durationChart'), {&quot;);&#10;                html.AppendLine(&quot;            type: 'bar',&quot;);&#10;                html.AppendLine(&quot;            data: {&quot;);&#10;                html.AppendLine($&quot;                labels: [{durationLabels}],&quot;);&#10;                html.AppendLine(&quot;                datasets: [{&quot;);&#10;                html.AppendLine(&quot;                    label: 'Total Files',&quot;);&#10;                html.AppendLine($&quot;                    data: [{durationTotals}],&quot;);&#10;                html.AppendLine(&quot;                    backgroundColor: 'rgba(102, 126, 234, 0.6)',&quot;);&#10;                html.AppendLine(&quot;                    borderColor: 'rgba(102, 126, 234, 1)',&quot;);&#10;                html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;                html.AppendLine(&quot;                }, {&quot;);&#10;                html.AppendLine(&quot;                    label: 'Corrupted Files',&quot;);&#10;                html.AppendLine($&quot;                    data: [{durationCorrupted}],&quot;);&#10;                html.AppendLine(&quot;                    backgroundColor: 'rgba(239, 68, 68, 0.6)',&quot;);&#10;                html.AppendLine(&quot;                    borderColor: 'rgba(239, 68, 68, 1)',&quot;);&#10;                html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;                html.AppendLine(&quot;                }]&quot;);&#10;                html.AppendLine(&quot;            },&quot;);&#10;                html.AppendLine(&quot;            options: {&quot;);&#10;                html.AppendLine(&quot;                responsive: true,&quot;);&#10;                html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;                html.AppendLine(&quot;                scales: {&quot;);&#10;                html.AppendLine(&quot;                    y: { beginAtZero: true }&quot;);&#10;                html.AppendLine(&quot;                },&quot;);&#10;                html.AppendLine(&quot;                plugins: {&quot;);&#10;                html.AppendLine(&quot;                    legend: { position: 'top' },&quot;);&#10;                html.AppendLine(&quot;                    tooltip: {&quot;);&#10;                html.AppendLine(&quot;                        callbacks: {&quot;);&#10;                html.AppendLine(&quot;                            afterLabel: function(context) {&quot;);&#10;                html.AppendLine($&quot;                                const percentages = [{durationPercentages}];&quot;);&#10;                html.AppendLine(&quot;                                if (context.datasetIndex === 1) {&quot;);&#10;                html.AppendLine(&quot;                                    return 'Corruption Rate: ' + percentages[context.dataIndex] + '%';&quot;);&#10;                html.AppendLine(&quot;                                }&quot;);&#10;                html.AppendLine(&quot;                            }&quot;);&#10;                html.AppendLine(&quot;                        }&quot;);&#10;                html.AppendLine(&quot;                    }&quot;);&#10;                html.AppendLine(&quot;                }&quot;);&#10;                html.AppendLine(&quot;            }&quot;);&#10;                html.AppendLine(&quot;        });&quot;);&#10;            }&#10;&#10;            // Hourly heatmap&#10;            var hourLabels = string.Join(&quot;, &quot;, Enumerable.Range(0, 24).Select(h =&gt; $&quot;'{h:D2}:00'&quot;));&#10;            var hourFailureData = string.Join(&quot;, &quot;, hourlyFailures);&#10;            var hourTotalData = string.Join(&quot;, &quot;, hourlyTotal);&#10;            var hourPercentages = string.Join(&quot;, &quot;, hourlyTotal.Select((total, i) =&gt; &#10;                total &gt; 0 ? ((double)hourlyFailures[i] / total * 100).ToString(&quot;F1&quot;) : &quot;0&quot;));&#10;&#10;            html.AppendLine(&quot;        new Chart(document.getElementById('hourlyHeatmap'), {&quot;);&#10;            html.AppendLine(&quot;            type: 'bar',&quot;);&#10;            html.AppendLine(&quot;            data: {&quot;);&#10;            html.AppendLine($&quot;                labels: [{hourLabels}],&quot;);&#10;            html.AppendLine(&quot;                datasets: [{&quot;);&#10;            html.AppendLine(&quot;                    label: 'Total Files Modified',&quot;);&#10;            html.AppendLine($&quot;                    data: [{hourTotalData}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(102, 126, 234, 0.5)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(102, 126, 234, 1)',&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;            html.AppendLine(&quot;                }, {&quot;);&#10;            html.AppendLine(&quot;                    label: 'Failed/Corrupted Files',&quot;);&#10;            html.AppendLine($&quot;                    data: [{hourFailureData}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(239, 68, 68, 0.7)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(239, 68, 68, 1)',&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;            html.AppendLine(&quot;                }]&quot;);&#10;            html.AppendLine(&quot;            },&quot;);&#10;            html.AppendLine(&quot;            options: {&quot;);&#10;            html.AppendLine(&quot;                responsive: true,&quot;);&#10;            html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;            html.AppendLine(&quot;                scales: {&quot;);&#10;            html.AppendLine(&quot;                    y: { beginAtZero: true, title: { display: true, text: 'Number of Files' } },&quot;);&#10;            html.AppendLine(&quot;                    x: { title: { display: true, text: 'Hour of Day (Local Time)' } }&quot;);&#10;            html.AppendLine(&quot;                },&quot;);&#10;            html.AppendLine(&quot;                plugins: {&quot;);&#10;            html.AppendLine(&quot;                    legend: { position: 'top' },&quot;);&#10;            html.AppendLine(&quot;                    tooltip: {&quot;);&#10;            html.AppendLine(&quot;                        callbacks: {&quot;);&#10;            html.AppendLine(&quot;                            afterLabel: function(context) {&quot;);&#10;            html.AppendLine($&quot;                                const percentages = [{hourPercentages}];&quot;);&#10;            html.AppendLine(&quot;                                if (context.datasetIndex === 1) {&quot;);&#10;            html.AppendLine(&quot;                                    return 'Failure Rate: ' + percentages[context.dataIndex] + '%';&quot;);&#10;            html.AppendLine(&quot;                                }&quot;);&#10;            html.AppendLine(&quot;                            }&quot;);&#10;            html.AppendLine(&quot;                        }&quot;);&#10;            html.AppendLine(&quot;                    }&quot;);&#10;            html.AppendLine(&quot;                }&quot;);&#10;            html.AppendLine(&quot;            }&quot;);&#10;            html.AppendLine(&quot;        });&quot;);&#10;&#10;            // Scatter plot: File Size vs Playable %&#10;            if (scatterData.Count &gt; 0)&#10;            {&#10;                var scatterPointsCorrupted = string.Join(&quot;, &quot;, scatterDataCorrupted.Select(d =&gt; &#10;                    $&quot;{{x: {d.SizeMB.ToString(&quot;F2&quot;, CultureInfo.InvariantCulture)}, y: {d.PlayablePercent.ToString(&quot;F2&quot;, CultureInfo.InvariantCulture)}, label: '{System.Security.SecurityElement.Escape(d.FileName)}'}}&quot;));&#10;                &#10;                var scatterPointsValid = string.Join(&quot;, &quot;, scatterDataValid.Select(d =&gt; &#10;                    $&quot;{{x: {d.SizeMB.ToString(&quot;F2&quot;, CultureInfo.InvariantCulture)}, y: {d.PlayablePercent.ToString(&quot;F2&quot;, CultureInfo.InvariantCulture)}, label: '{System.Security.SecurityElement.Escape(d.FileName)}'}}&quot;));&#10;&#10;                html.AppendLine(&quot;        new Chart(document.getElementById('scatterSizePlayable'), {&quot;);&#10;                html.AppendLine(&quot;            type: 'scatter',&quot;);&#10;                html.AppendLine(&quot;            data: {&quot;);&#10;                html.AppendLine(&quot;                datasets: [{&quot;);&#10;                html.AppendLine(&quot;                    label: 'Valid Files (100% Playable)',&quot;);&#10;                html.AppendLine($&quot;                    data: [{scatterPointsValid}],&quot;);&#10;                html.AppendLine(&quot;                    backgroundColor: 'rgba(16, 185, 129, 0.6)',&quot;);&#10;                html.AppendLine(&quot;                    borderColor: 'rgba(16, 185, 129, 1)',&quot;);&#10;                html.AppendLine(&quot;                    borderWidth: 1,&quot;);&#10;                html.AppendLine(&quot;                    pointRadius: 6,&quot;);&#10;                html.AppendLine(&quot;                    pointHoverRadius: 8&quot;);&#10;                html.AppendLine(&quot;                }, {&quot;);&#10;                html.AppendLine(&quot;                    label: 'Corrupted Files',&quot;);&#10;                html.AppendLine($&quot;                    data: [{scatterPointsCorrupted}],&quot;);&#10;                html.AppendLine(&quot;                    backgroundColor: 'rgba(239, 68, 68, 0.6)',&quot;);&#10;                html.AppendLine(&quot;                    borderColor: 'rgba(239, 68, 68, 1)',&quot;);&#10;                html.AppendLine(&quot;                    borderWidth: 1,&quot;);&#10;                html.AppendLine(&quot;                    pointRadius: 6,&quot;);&#10;                html.AppendLine(&quot;                    pointHoverRadius: 8&quot;);&#10;                html.AppendLine(&quot;                }]&quot;);&#10;                html.AppendLine(&quot;            },&quot;);&#10;                html.AppendLine(&quot;            options: {&quot;);&#10;                html.AppendLine(&quot;                responsive: true,&quot;);&#10;                html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;                html.AppendLine(&quot;                scales: {&quot;);&#10;                html.AppendLine(&quot;                    x: { title: { display: true, text: 'File Size (MB)' }, beginAtZero: true },&quot;);&#10;                html.AppendLine(&quot;                    y: { title: { display: true, text: 'Playable Percentage (%)' }, beginAtZero: true, max: 100 }&quot;);&#10;                html.AppendLine(&quot;                },&quot;);&#10;                html.AppendLine(&quot;                plugins: {&quot;);&#10;                html.AppendLine(&quot;                    legend: { display: true, position: 'top' },&quot;);&#10;                html.AppendLine(&quot;                    tooltip: {&quot;);&#10;                html.AppendLine(&quot;                        callbacks: {&quot;);&#10;                html.AppendLine(&quot;                            label: function(context) {&quot;);&#10;                html.AppendLine(&quot;                                return context.raw.label + ': ' + context.parsed.y.toFixed(1) + '% playable';&quot;);&#10;                html.AppendLine(&quot;                            }&quot;);&#10;                html.AppendLine(&quot;                        }&quot;);&#10;                html.AppendLine(&quot;                    }&quot;);&#10;                html.AppendLine(&quot;                }&quot;);&#10;                html.AppendLine(&quot;            }&quot;);&#10;                html.AppendLine(&quot;        });&quot;);&#10;            }&#10;&#10;            // Scatter plot: Last Modified Hour vs Corruption&#10;            var hourCorruptionData = reports&#10;                .GroupBy(r =&gt; r.FileMetadata.LastModifiedTimeUtc.ToLocalTime().Hour)&#10;                .Select(g =&gt; new {&#10;                    Hour = g.Key,&#10;                    Total = g.Count(),&#10;                    Corrupted = g.Count(r =&gt; r.Status.IsCorrupted),&#10;                    Rate = g.Count() &gt; 0 ? (double)g.Count(r =&gt; r.Status.IsCorrupted) / g.Count() * 100 : 0&#10;                })&#10;                .ToList();&#10;&#10;            var hourScatterPoints = string.Join(&quot;, &quot;, hourCorruptionData.Select(d =&gt; &#10;                $&quot;{{x: {d.Hour}, y: {d.Rate.ToString(&quot;F2&quot;, CultureInfo.InvariantCulture)}, r: {Math.Max(5, d.Total * 2)}}}&quot;));&#10;&#10;            html.AppendLine(&quot;        new Chart(document.getElementById('scatterHourCorruption'), {&quot;);&#10;            html.AppendLine(&quot;            type: 'bubble',&quot;);&#10;            html.AppendLine(&quot;            data: {&quot;);&#10;            html.AppendLine($&quot;                datasets: [{{&quot;);&#10;            html.AppendLine(&quot;                    label: 'Corruption Rate by Hour',&quot;);&#10;            html.AppendLine($&quot;                    data: [{hourScatterPoints}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(245, 158, 11, 0.5)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(245, 158, 11, 1)',&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;            html.AppendLine(&quot;                }]&quot;);&#10;            html.AppendLine(&quot;            },&quot;);&#10;            html.AppendLine(&quot;            options: {&quot;);&#10;            html.AppendLine(&quot;                responsive: true,&quot;);&#10;            html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;            html.AppendLine(&quot;                scales: {&quot;);&#10;            html.AppendLine(&quot;                    x: { title: { display: true, text: 'Hour of Day (0-23)' }, min: 0, max: 23, ticks: { stepSize: 1 } },&quot;);&#10;            html.AppendLine(&quot;                    y: { title: { display: true, text: 'Corruption Rate (%)' }, beginAtZero: true, max: 100 }&quot;);&#10;            html.AppendLine(&quot;                },&quot;);&#10;            html.AppendLine(&quot;                plugins: {&quot;);&#10;            html.AppendLine(&quot;                    legend: { display: false },&quot;);&#10;            html.AppendLine(&quot;                    tooltip: {&quot;);&#10;            html.AppendLine(&quot;                        callbacks: {&quot;);&#10;            html.AppendLine(&quot;                            label: function(context) {&quot;);&#10;            html.AppendLine(&quot;                                return 'Hour ' + context.parsed.x + ':00 - ' + context.parsed.y.toFixed(1) + '% corruption rate';&quot;);&#10;            html.AppendLine(&quot;                            }&quot;);&#10;            html.AppendLine(&quot;                        }&quot;);&#10;            html.AppendLine(&quot;                    }&quot;);&#10;            html.AppendLine(&quot;                }&quot;);&#10;            html.AppendLine(&quot;            }&quot;);&#10;            html.AppendLine(&quot;        });&quot;);&#10;&#10;            // Timeline chart: Creation vs Last Modified&#10;            var timelineCreationData = string.Join(&quot;, &quot;, timelineData.Select(t =&gt; &#10;                $&quot;{{x: '{t.CreationTime:yyyy-MM-dd HH:mm}', y: 1}}&quot;));&#10;            var timelineModifiedData = string.Join(&quot;, &quot;, timelineData.Where(t =&gt; t.IsCorrupted).Select(t =&gt; &#10;                $&quot;{{x: '{t.LastModifiedTime:yyyy-MM-dd HH:mm}', y: 2}}&quot;));&#10;&#10;            html.AppendLine(&quot;        new Chart(document.getElementById('timelineChart'), {&quot;);&#10;            html.AppendLine(&quot;            type: 'scatter',&quot;);&#10;            html.AppendLine(&quot;            data: {&quot;);&#10;            html.AppendLine(&quot;                datasets: [{&quot;);&#10;            html.AppendLine(&quot;                    label: 'File Creation Time',&quot;);&#10;            html.AppendLine($&quot;                    data: [{timelineCreationData}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(16, 185, 129, 0.6)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(16, 185, 129, 1)',&quot;);&#10;            html.AppendLine(&quot;                    pointRadius: 4,&quot;);&#10;            html.AppendLine(&quot;                    showLine: false&quot;);&#10;            html.AppendLine(&quot;                }, {&quot;);&#10;            html.AppendLine(&quot;                    label: 'Last Modified (Corrupted Files)',&quot;);&#10;            html.AppendLine($&quot;                    data: [{timelineModifiedData}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(239, 68, 68, 0.6)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(239, 68, 68, 1)',&quot;);&#10;            html.AppendLine(&quot;                    pointRadius: 4,&quot;);&#10;            html.AppendLine(&quot;                    showLine: false&quot;);&#10;            html.AppendLine(&quot;                }]&quot;);&#10;            html.AppendLine(&quot;            },&quot;);&#10;            html.AppendLine(&quot;            options: {&quot;);&#10;            html.AppendLine(&quot;                responsive: true,&quot;);&#10;            html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;            html.AppendLine(&quot;                scales: {&quot;);&#10;            html.AppendLine(&quot;                    x: { type: 'time', time: { unit: 'day' }, title: { display: true, text: 'Date &amp; Time' } },&quot;);&#10;            html.AppendLine(&quot;                    y: { display: false, min: 0, max: 3 }&quot;);&#10;            html.AppendLine(&quot;                },&quot;);&#10;            html.AppendLine(&quot;                plugins: {&quot;);&#10;            html.AppendLine(&quot;                    legend: { position: 'top' },&quot;);&#10;            html.AppendLine(&quot;                    tooltip: {&quot;);&#10;            html.AppendLine(&quot;                        callbacks: {&quot;);&#10;            html.AppendLine(&quot;                            label: function(context) {&quot;);&#10;            html.AppendLine(&quot;                                return context.dataset.label + ': ' + context.parsed.x;&quot;);&#10;            html.AppendLine(&quot;                            }&quot;);&#10;            html.AppendLine(&quot;                        }&quot;);&#10;            html.AppendLine(&quot;                    }&quot;);&#10;            html.AppendLine(&quot;                }&quot;);&#10;            html.AppendLine(&quot;            }&quot;);&#10;            html.AppendLine(&quot;        });&quot;);&#10;&#10;            html.AppendLine(&quot;    &lt;/script&gt;&quot;);&#10;            html.AppendLine(&quot;&lt;/body&gt;&quot;);&#10;            html.AppendLine(&quot;&lt;/html&gt;&quot;);&#10;&#10;            // Save the report&#10;            string reportPath = Path.Combine(outputDir, $&quot;global-report-{DateTime.Now:yyyyMMdd-HHmmss}.html&quot;);&#10;            File.WriteAllText(reportPath, html.ToString(), Encoding.UTF8);&#10;&#10;            WriteSuccess($&quot;\n✅ Global analysis report generated successfully!&quot;);&#10;            WriteSuccess($&quot; Report location: {reportPath}\n&quot;);&#10;&#10;            // Try to open the report in the default browser&#10;            try&#10;            {&#10;                Process.Start(new ProcessStartInfo&#10;                {&#10;                    FileName = reportPath,&#10;                    UseShellExecute = true&#10;                });&#10;                WriteInfo(&quot;Opening report in your default browser...\n&quot;);&#10;            }&#10;            catch&#10;            {&#10;                WriteWarning(&quot;Could not open report automatically. Please open it manually.\n&quot;);&#10;            }&#10;        }&#10;&#10;        public static void Main(string[] args)&#10;        {&#10;            Console.WriteLine(&quot;=== MOV File Integrity Checker ===\n&quot;);&#10;&#10;            // Example for debugging — remove these lines when using real command-line args&#10;            /*&#10;            args = new string[]&#10;            {&#10;                &quot;T:\\SPT\\SP\\Mont\\Prod1\\2_COU\\_DL&quot;,&#10;                // &quot;T:\\SPT\\SP\\Mont\\Prod2\\2_COU\\_DL&quot;,&#10;                // &quot;T:\\SPT\\SP\\Mont\\Backup\\2_COU\\_DL&quot;,&#10;                &quot;-r&quot;,&#10;                &quot;--delete-empty&quot;&#10;            };&#10;            */&#10;&#10;            // Check for global analysis flag&#10;            if (args.Any(a =&gt; a == &quot;--global-analysis&quot; || a == &quot;-g&quot;))&#10;            {&#10;                RunGlobalAnalysis();&#10;                return;&#10;            }&#10;&#10;            if (args.Length == 0)&#10;            {&#10;                // Interactive mode - show menu&#10;                ShowMainMenu();&#10;                return;&#10;            }&#10;&#10;            // Extract flags&#10;            bool recursive = args.Any(a =&gt; a == &quot;-r&quot; || a == &quot;--recursive&quot;);&#10;            bool summaryOnly = args.Any(a =&gt; a == &quot;-s&quot; || a == &quot;--summary&quot;);&#10;            bool deleteEmpty = args.Any(a =&gt; a == &quot;-d&quot; || a == &quot;--delete-empty&quot;);&#10;&#10;            // Extract paths (everything that is not a flag)&#10;            var paths = args.Where(a =&gt; !a.StartsWith(&quot;-&quot;)).ToArray();&#10;&#10;            if (paths.Length == 0)&#10;            {&#10;                WriteError(&quot;No folder or file paths specified.&quot;);&#10;                return;&#10;            }&#10;&#10;            // Run per-file analysis&#10;            RunPerFileAnalysis(paths, recursive, summaryOnly, deleteEmpty);&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="using System.Text;&#10;using System.Diagnostics;&#10;using System.Globalization;&#10;using System.Text.Json;&#10;using System.Text.Json.Serialization;&#10;using MovFileIntegrityChecker.Models;&#10;using MovFileIntegrityChecker.Services;&#10;using MovFileIntegrityChecker.Utilities;&#10;&#10;namespace MovFileIntegrityChecker&#10;{&#10;    public static class MovIntegrityChecker&#10;    {&#10;        // Common MOV/MP4 atom types&#10;        private static readonly HashSet&lt;string&gt; ValidAtomTypes = new()&#10;        {&#10;            &quot;ftyp&quot;, &quot;moov&quot;, &quot;mdat&quot;, &quot;free&quot;, &quot;skip&quot;, &quot;wide&quot;, &quot;pnot&quot;,&#10;            &quot;mvhd&quot;, &quot;trak&quot;, &quot;tkhd&quot;, &quot;mdia&quot;, &quot;mdhd&quot;, &quot;hdlr&quot;, &quot;minf&quot;,&#10;            &quot;vmhd&quot;, &quot;smhd&quot;, &quot;dinf&quot;, &quot;stbl&quot;, &quot;stsd&quot;, &quot;stts&quot;, &quot;stsc&quot;,&#10;            &quot;stsz&quot;, &quot;stco&quot;, &quot;co64&quot;, &quot;edts&quot;, &quot;elst&quot;, &quot;udta&quot;, &quot;meta&quot;&#10;        };&#10;&#10;        public class AtomInfo&#10;        {&#10;            public string Type       { get; set; } = string.Empty;&#10;            public long   Size       { get; set; }&#10;            public long   Offset     { get; set; }&#10;            public bool   IsComplete { get; set; }&#10;        }&#10;&#10;        // JSON Report Classes&#10;        public class JsonFileMetadata&#10;        {&#10;            [JsonPropertyName(&quot;fileName&quot;)]&#10;            public string FileName { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;fullPath&quot;)]&#10;            public string FullPath { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;fileSizeBytes&quot;)]&#10;            public long FileSizeBytes { get; set; }&#10;&#10;            [JsonPropertyName(&quot;fileSizeMB&quot;)]&#10;            public double FileSizeMB { get; set; }&#10;&#10;            [JsonPropertyName(&quot;creationTimeUtc&quot;)]&#10;            public DateTime CreationTimeUtc { get; set; }&#10;&#10;            [JsonPropertyName(&quot;lastModifiedTimeUtc&quot;)]&#10;            public DateTime LastModifiedTimeUtc { get; set; }&#10;&#10;            [JsonPropertyName(&quot;lastAccessTimeUtc&quot;)]&#10;            public DateTime LastAccessTimeUtc { get; set; }&#10;&#10;            [JsonPropertyName(&quot;fileExtension&quot;)]&#10;            public string FileExtension { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;isReadOnly&quot;)]&#10;            public bool IsReadOnly { get; set; }&#10;&#10;            [JsonPropertyName(&quot;attributes&quot;)]&#10;            public string Attributes { get; set; } = string.Empty;&#10;        }&#10;&#10;        public class JsonVideoDuration&#10;        {&#10;            [JsonPropertyName(&quot;totalDurationSeconds&quot;)]&#10;            public double TotalDurationSeconds { get; set; }&#10;&#10;            [JsonPropertyName(&quot;totalDurationFormatted&quot;)]&#10;            public string TotalDurationFormatted { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;playableDurationSeconds&quot;)]&#10;            public double PlayableDurationSeconds { get; set; }&#10;&#10;            [JsonPropertyName(&quot;playableDurationFormatted&quot;)]&#10;            public string PlayableDurationFormatted { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;missingDurationSeconds&quot;)]&#10;            public double MissingDurationSeconds { get; set; }&#10;&#10;            [JsonPropertyName(&quot;missingDurationFormatted&quot;)]&#10;            public string MissingDurationFormatted { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;playablePercentage&quot;)]&#10;            public double PlayablePercentage { get; set; }&#10;&#10;            [JsonPropertyName(&quot;corruptedPercentage&quot;)]&#10;            public double CorruptedPercentage { get; set; }&#10;        }&#10;&#10;        public class JsonAtomInfo&#10;        {&#10;            [JsonPropertyName(&quot;type&quot;)]&#10;            public string Type { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;sizeBytes&quot;)]&#10;            public long SizeBytes { get; set; }&#10;&#10;            [JsonPropertyName(&quot;offsetBytes&quot;)]&#10;            public long OffsetBytes { get; set; }&#10;&#10;            [JsonPropertyName(&quot;isComplete&quot;)]&#10;            public bool IsComplete { get; set; }&#10;&#10;            [JsonPropertyName(&quot;isKnownType&quot;)]&#10;            public bool IsKnownType { get; set; }&#10;        }&#10;&#10;        public class JsonIntegrityAnalysis&#10;        {&#10;            [JsonPropertyName(&quot;bytesValidated&quot;)]&#10;            public long BytesValidated { get; set; }&#10;&#10;            [JsonPropertyName(&quot;validationPercentage&quot;)]&#10;            public double ValidationPercentage { get; set; }&#10;&#10;            [JsonPropertyName(&quot;atomsFound&quot;)]&#10;            public int AtomsFound { get; set; }&#10;&#10;            [JsonPropertyName(&quot;hasStructuralIssues&quot;)]&#10;            public bool HasStructuralIssues { get; set; }&#10;&#10;            [JsonPropertyName(&quot;issues&quot;)]&#10;            public List&lt;string&gt; Issues { get; set; } = new();&#10;&#10;            [JsonPropertyName(&quot;atoms&quot;)]&#10;            public List&lt;JsonAtomInfo&gt; Atoms { get; set; } = new();&#10;&#10;            [JsonPropertyName(&quot;hasRequiredAtoms&quot;)]&#10;            public JsonRequiredAtoms HasRequiredAtoms { get; set; } = new();&#10;        }&#10;&#10;        public class JsonRequiredAtoms&#10;        {&#10;            [JsonPropertyName(&quot;ftyp&quot;)]&#10;            public bool Ftyp { get; set; }&#10;&#10;            [JsonPropertyName(&quot;moov&quot;)]&#10;            public bool Moov { get; set; }&#10;&#10;            [JsonPropertyName(&quot;mdat&quot;)]&#10;            public bool Mdat { get; set; }&#10;        }&#10;&#10;        public class JsonCorruptionReport&#10;        {&#10;            [JsonPropertyName(&quot;reportVersion&quot;)]&#10;            public string ReportVersion { get; set; } = &quot;1.0&quot;;&#10;&#10;            [JsonPropertyName(&quot;generatedByTool&quot;)]&#10;            public string GeneratedByTool { get; set; } = &quot;MovFileIntegrityChecker&quot;;&#10;&#10;            [JsonPropertyName(&quot;evaluationTimeUtc&quot;)]&#10;            public DateTime EvaluationTimeUtc { get; set; }&#10;&#10;            [JsonPropertyName(&quot;evaluationTimeLocal&quot;)]&#10;            public DateTime EvaluationTimeLocal { get; set; }&#10;&#10;            [JsonPropertyName(&quot;fileMetadata&quot;)]&#10;            public JsonFileMetadata FileMetadata { get; set; } = new();&#10;&#10;            [JsonPropertyName(&quot;videoDuration&quot;)]&#10;            public JsonVideoDuration? VideoDuration { get; set; }&#10;&#10;            [JsonPropertyName(&quot;integrityAnalysis&quot;)]&#10;            public JsonIntegrityAnalysis IntegrityAnalysis { get; set; } = new();&#10;&#10;            [JsonPropertyName(&quot;status&quot;)]&#10;            public JsonFileStatus Status { get; set; } = new();&#10;        }&#10;&#10;        public class JsonFileStatus&#10;        {&#10;            [JsonPropertyName(&quot;isCorrupted&quot;)]&#10;            public bool IsCorrupted { get; set; }&#10;&#10;            [JsonPropertyName(&quot;isComplete&quot;)]&#10;            public bool IsComplete { get; set; }&#10;&#10;            [JsonPropertyName(&quot;severity&quot;)]&#10;            public string Severity { get; set; } = string.Empty;&#10;&#10;            [JsonPropertyName(&quot;recommendation&quot;)]&#10;            public string Recommendation { get; set; } = string.Empty;&#10;        }&#10;&#10;        public class FileCheckResult&#10;        {&#10;            public string         FilePath         { get; set; } = string.Empty;&#10;            public bool           HasIssues        =&gt; Issues.Count &gt; 0;&#10;            public List&lt;string&gt;   Issues           { get; set; } = new();&#10;            public List&lt;AtomInfo&gt; Atoms            { get; set; } = new();&#10;            public long           FileSize         { get; set; }&#10;            public long           BytesValidated   { get; set; }&#10;            public double         TotalDuration    { get; set; }&#10;            public double         PlayableDuration { get; set; }&#10;        }&#10;&#10;        private static FileCheckResult CheckFileIntegrity(string filePath)&#10;        {&#10;            var result = new FileCheckResult&#10;            {&#10;                FilePath = filePath,&#10;            };&#10;&#10;            if (!File.Exists(filePath))&#10;            {&#10;                result.Issues.Add(&quot;File does not exist&quot;);&#10;                return result;&#10;            }&#10;&#10;            try&#10;            {&#10;                using var fs = new FileStream(filePath, FileMode.Open, FileAccess.Read);&#10;                long fileLength = fs.Length;&#10;                result.FileSize = fileLength;&#10;&#10;                if (fileLength &lt; 8)&#10;                {&#10;                    result.Issues.Add(&quot;File too small to be a valid MOV (&lt; 8 bytes)&quot;);&#10;                    return result;&#10;                }&#10;&#10;                // Parse all atoms in the file&#10;                bool hasStructuralErrors = false;&#10;                bool hasIncompleteAtoms = false;&#10;                long position = 0;&#10;&#10;                while (position &lt; fileLength)&#10;                {&#10;                    fs.Position = position;&#10;&#10;                    // Read atom size (4 bytes, big-endian)&#10;                    byte[] sizeBytes = new byte[4];&#10;                    int bytesRead = fs.Read(sizeBytes, 0, 4);&#10;                    if (bytesRead &lt; 4)&#10;                    {&#10;                        result.Issues.Add($&quot;Incomplete atom header at offset {position:N0}&quot;);&#10;                        hasIncompleteAtoms = true;&#10;                        break;&#10;                    }&#10;&#10;                    long atomSize = ReadBigEndianUInt32(sizeBytes);&#10;&#10;                    // Read atom type (4 bytes)&#10;                    byte[] typeBytes = new byte[4];&#10;                    bytesRead = fs.Read(typeBytes, 0, 4);&#10;                    if (bytesRead &lt; 4)&#10;                    {&#10;                        result.Issues.Add($&quot;Incomplete atom type at offset {position:N0}&quot;);&#10;                        hasIncompleteAtoms = true;&#10;                        break;&#10;                    }&#10;&#10;                    string atomType = Encoding.ASCII.GetString(typeBytes);&#10;&#10;                    // Handle extended size (size == 1)&#10;                    long headerSize = 8;&#10;                    if (atomSize == 1)&#10;                    {&#10;                        byte[] extSizeBytes = new byte[8];&#10;                        bytesRead = fs.Read(extSizeBytes, 0, 8);&#10;                        if (bytesRead &lt; 8)&#10;                        {&#10;                            result.Issues.Add($&quot;Incomplete extended size for atom '{atomType}' at offset {position:N0}&quot;);&#10;                            hasIncompleteAtoms = true;&#10;                            break;&#10;                        }&#10;&#10;                        atomSize = ReadBigEndianUInt64(extSizeBytes);&#10;                        headerSize = 16;&#10;                    }&#10;                    // Handle size == 0 (atom extends to end of file)&#10;                    else if (atomSize == 0)&#10;                    {&#10;                        atomSize = fileLength - position;&#10;                    }&#10;&#10;                    // Validate atom size&#10;                    if (atomSize &lt; headerSize)&#10;                    {&#10;                        result.Issues.Add($&quot;Invalid atom size ({atomSize}) at offset {position:N0} for type '{atomType}'&quot;);&#10;                        hasStructuralErrors = true;&#10;                        break;&#10;                    }&#10;&#10;                    // Check if atom extends beyond file&#10;                    bool isComplete = (position + atomSize) &lt;= fileLength;&#10;&#10;                    var atom = new AtomInfo&#10;                    {&#10;                        Type = atomType,&#10;                        Size = atomSize,&#10;                        Offset = position,&#10;                        IsComplete = isComplete&#10;                    };&#10;                    result.Atoms.Add(atom);&#10;&#10;                    if (!isComplete)&#10;                    {&#10;                        long available = fileLength - position;&#10;                        long missing = atomSize - available;&#10;                        result.Issues.Add($&quot;Incomplete atom '{atomType}' at offset {position:N0}: Expected {atomSize:N0} bytes, available {available:N0} bytes, missing {missing:N0} bytes ({(missing * 100.0 / atomSize):F1}%)&quot;);&#10;                        hasIncompleteAtoms = true;&#10;                        break;&#10;                    }&#10;&#10;                    // Warn about unknown atom types&#10;                    if (!ValidAtomTypes.Contains(atomType) &amp;&amp; !IsAsciiPrintable(atomType))&#10;                    {&#10;                        result.Issues.Add($&quot;Unknown/invalid atom type '{atomType}' at offset {position:N0}&quot;);&#10;                    }&#10;&#10;                    position += atomSize;&#10;                }&#10;&#10;                result.BytesValidated = position;&#10;&#10;                // Check for required atoms&#10;                bool hasFtyp = result.Atoms.Any(a =&gt; a.Type == &quot;ftyp&quot;);&#10;                bool hasMoov = result.Atoms.Any(a =&gt; a.Type == &quot;moov&quot;);&#10;                bool hasMdat = result.Atoms.Any(a =&gt; a.Type == &quot;mdat&quot;);&#10;&#10;                if (!hasFtyp &amp;&amp; result.Atoms.Count &gt; 0)&#10;                {&#10;                    result.Issues.Add(&quot;Missing 'ftyp' atom (file type header)&quot;);&#10;                }&#10;&#10;                if (!hasMoov &amp;&amp; result.Atoms.Count &gt; 0)&#10;                {&#10;                    result.Issues.Add(&quot;Missing 'moov' atom (metadata)&quot;);&#10;                }&#10;&#10;                if (!hasMdat &amp;&amp; result.Atoms.Count &gt; 0)&#10;                {&#10;                    result.Issues.Add(&quot;Missing 'mdat' atom (media data)&quot;);&#10;                }&#10;&#10;                // Validate ftyp is first (if present)&#10;                if (hasFtyp &amp;&amp; result.Atoms.Count &gt; 0 &amp;&amp; result.Atoms[0].Type != &quot;ftyp&quot;)&#10;                {&#10;                    result.Issues.Add($&quot;'ftyp' atom should be first, but found at offset {result.Atoms.First(a =&gt; a.Type == &quot;ftyp&quot;).Offset:N0}&quot;);&#10;                }&#10;&#10;                // Check last atom alignment&#10;                if (result.Atoms.Count &gt; 0)&#10;                {&#10;                    var lastAtom = result.Atoms.Last();&#10;                    long declaredEnd = lastAtom.Offset + lastAtom.Size;&#10;&#10;                    if (lastAtom.IsComplete &amp;&amp; declaredEnd != fileLength)&#10;                    {&#10;                        long gap = fileLength - declaredEnd;&#10;                        result.Issues.Add($&quot;Gap of {gap:N0} bytes after last atom '{lastAtom.Type}' at offset {declaredEnd:N0}&quot;);&#10;                    }&#10;                }&#10;&#10;                // Final verdict&#10;                if (hasStructuralErrors || hasIncompleteAtoms || result.Atoms.Count == 0)&#10;                {&#10;                    result.Issues.Add(&quot;File structure is invalid or incomplete&quot;);&#10;                }&#10;&#10;                // Get video duration using ffprobe&#10;                result.TotalDuration = GetVideoDuration(filePath);&#10;&#10;                // Estimate playable duration based on bytes validated&#10;                if (result.TotalDuration &gt; 0 &amp;&amp; result.FileSize &gt; 0)&#10;                {&#10;                    double completionRatio = (double)result.BytesValidated / result.FileSize;&#10;                    result.PlayableDuration = result.TotalDuration * completionRatio;&#10;                }&#10;                else&#10;                {&#10;                    result.PlayableDuration = 0;&#10;                }&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                result.Issues.Add($&quot;Error reading file: {ex.Message}&quot;);&#10;            }&#10;&#10;            return result;&#10;        }&#10;&#10;        private static void PrintDetailedResult(FileCheckResult result)&#10;        {&#10;            Console.WriteLine($&quot;\n{'='}{new string('=', 80)}&quot;);&#10;            Console.WriteLine($&quot;File: {Path.GetFileName(result.FilePath)}&quot;);&#10;            Console.WriteLine(new string('=', 80));&#10;&#10;            Console.WriteLine($&quot;\n Analysis Summary:&quot;);&#10;            Console.WriteLine($&quot;   File Size: {result.FileSize:N0} bytes&quot;);&#10;            Console.WriteLine($&quot;   Atoms Found: {result.Atoms.Count}&quot;);&#10;            Console.WriteLine($&quot;   Bytes Validated: {result.BytesValidated:N0} / {result.FileSize:N0} ({(result.BytesValidated * 100.0 / Math.Max(1, result.FileSize)):F1}%)&quot;);&#10;&#10;            // Display duration timeline if available&#10;            if (result.TotalDuration &gt; 0)&#10;            {&#10;                Console.WriteLine($&quot;\n⏱️  Duration Timeline:&quot;);&#10;                Console.WriteLine($&quot;   Total Duration: {FormatDuration(result.TotalDuration)}&quot;);&#10;&#10;                if (result.HasIssues &amp;&amp; result.PlayableDuration &lt; result.TotalDuration)&#10;                {&#10;                    Console.WriteLine($&quot;   Playable Duration: {FormatDuration(result.PlayableDuration)}&quot;);&#10;                    double playablePercent = (result.PlayableDuration / result.TotalDuration) * 100.0;&#10;&#10;                    // Create visual timeline bar (50 chars wide)&#10;                    int barWidth = 50;&#10;                    int greenWidth = (int)(barWidth * playablePercent / 100.0);&#10;                    int redWidth = barWidth - greenWidth;&#10;&#10;                    string greenBar = new string('█', greenWidth);&#10;                    string redBar = new string('█', redWidth);&#10;&#10;                    Console.Write($&quot;   &quot;);&#10;                    WriteSuccess($&quot;{greenBar}&quot;);&#10;                    Console.Write($&quot;&quot;);&#10;                    WriteError($&quot;{redBar}\n&quot;);&#10;                    Console.WriteLine($&quot;   |&quot;);&#10;                    Console.WriteLine($&quot;   {FormatDuration(0)}          {FormatDuration(result.PlayableDuration)} (break)          {FormatDuration(result.TotalDuration)}&quot;);&#10;                    Console.WriteLine($&quot;   Start           Missing: {FormatDuration(result.TotalDuration - result.PlayableDuration)}           End&quot;);&#10;                }&#10;                else&#10;                {&#10;                    Console.WriteLine($&quot;   Status: Complete playback expected&quot;);&#10;                    int barWidth = 50;&#10;                    string greenBar = new string('█', barWidth);&#10;                    Console.Write($&quot;   &quot;);&#10;                    WriteSuccess($&quot;{greenBar}\n&quot;);&#10;                    Console.WriteLine($&quot;   |&quot;);&#10;                    Console.WriteLine($&quot;   {FormatDuration(0)}                                      {FormatDuration(result.TotalDuration)}&quot;);&#10;                    Console.WriteLine($&quot;   Start                                   End&quot;);&#10;                }&#10;            }&#10;&#10;            if (result.Atoms.Count &gt; 0)&#10;            {&#10;                Console.WriteLine($&quot;\n Atom Structure:&quot;);&#10;                foreach (var atom in result.Atoms)&#10;                {&#10;                    string status = atom.IsComplete ? &quot;✅&quot; : &quot;❌&quot;;&#10;                    string knownType = ValidAtomTypes.Contains(atom.Type) ? &quot;&quot; : &quot; (unknown)&quot;;&#10;                    Console.WriteLine($&quot;   {status} [{atom.Type}]{knownType} - Size: {atom.Size:N0} bytes, Offset: {atom.Offset:N0}&quot;);&#10;                }&#10;&#10;                // Check for required atoms&#10;                bool hasFtyp = result.Atoms.Any(a =&gt; a.Type == &quot;ftyp&quot;);&#10;                bool hasMoov = result.Atoms.Any(a =&gt; a.Type == &quot;moov&quot;);&#10;                bool hasMdat = result.Atoms.Any(a =&gt; a.Type == &quot;mdat&quot;);&#10;&#10;                Console.WriteLine($&quot;\n Key Atoms:&quot;);&#10;                Console.WriteLine($&quot;   ftyp (file type): {(hasFtyp ? &quot;✅ Found&quot; : &quot;❌ Missing&quot;)}&quot;);&#10;                Console.WriteLine($&quot;   moov (metadata): {(hasMoov ? &quot;✅ Found&quot; : &quot;❌ Missing&quot;)}&quot;);&#10;                Console.WriteLine($&quot;   mdat (media data): {(hasMdat ? &quot;✅ Found&quot; : &quot;❌ Missing&quot;)}&quot;);&#10;            }&#10;&#10;            if (result.Issues.Count &gt; 0)&#10;            {&#10;                Console.WriteLine($&quot;\n⚠️  Issues Found ({result.Issues.Count}):&quot;);&#10;                foreach (var issue in result.Issues)&#10;                {&#10;                    WriteWarning($&quot;   • {issue}&quot;);&#10;                }&#10;            }&#10;&#10;            if (result.HasIssues)&#10;            {&#10;                WriteError(&quot;\n❌ File Status: CORRUPTED or INCOMPLETE&quot;);&#10;            }&#10;            else&#10;            {&#10;                WriteSuccess(&quot;\n✅ File Status: VALID and COMPLETE&quot;);&#10;            }&#10;        }&#10;&#10;        private static uint ReadBigEndianUInt32(byte[] data)&#10;        {&#10;            return ((uint)data[0] &lt;&lt; 24) | ((uint)data[1] &lt;&lt; 16) | ((uint)data[2] &lt;&lt; 8) | data[3];&#10;        }&#10;&#10;        private static long ReadBigEndianUInt64(byte[] data)&#10;        {&#10;            return ((long)data[0] &lt;&lt; 56) | ((long)data[1] &lt;&lt; 48) | ((long)data[2] &lt;&lt; 40) | ((long)data[3] &lt;&lt; 32) |&#10;                   ((long)data[4] &lt;&lt; 24) | ((long)data[5] &lt;&lt; 16) | ((long)data[6] &lt;&lt; 8) | data[7];&#10;        }&#10;&#10;        private static bool IsAsciiPrintable(string str)&#10;        {&#10;            return str.All(c =&gt; c &gt;= 32 &amp;&amp; c &lt;= 126);&#10;        }&#10;&#10;        private static string FormatDuration(double seconds)&#10;        {&#10;            if (seconds &lt;= 0) return &quot;00:00:00&quot;;&#10;&#10;            int hours = (int)(seconds / 3600);&#10;            int minutes = (int)((seconds % 3600) / 60);&#10;            int secs = (int)(seconds % 60);&#10;&#10;            return $&quot;{hours:D2}:{minutes:D2}:{secs:D2}&quot;;&#10;        }&#10;&#10;        // --- Added helpers for extracting a random frame using ffprobe/ffmpeg ---&#10;        private static double GetVideoDuration(string filePath)&#10;        {&#10;            try&#10;            {&#10;                var psi = new ProcessStartInfo&#10;                {&#10;                    FileName = &quot;ffprobe&quot;,&#10;                    Arguments = $&quot;-v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 \&quot;{filePath}\&quot;&quot;,&#10;                    RedirectStandardOutput = true,&#10;                    RedirectStandardError = true,&#10;                    UseShellExecute = false,&#10;                    CreateNoWindow = true&#10;                };&#10;&#10;                using var p = Process.Start(psi);&#10;                if (p == null) return 0;&#10;&#10;                // Wait a bit for ffprobe to produce output&#10;                string output = p.StandardOutput.ReadToEnd();&#10;                string stderr = p.StandardError.ReadToEnd();&#10;                p.WaitForExit(3000);&#10;&#10;                if (!string.IsNullOrWhiteSpace(output) &amp;&amp; double.TryParse(output.Trim(), NumberStyles.Any, CultureInfo.InvariantCulture, out var duration))&#10;                    return duration;&#10;&#10;                // If ffprobe failed, try to parse duration from stderr as a fallback (sometimes ffprobe prints to stderr)&#10;                if (!string.IsNullOrWhiteSpace(stderr))&#10;                {&#10;                    var digits = new string(stderr.Where(c =&gt; char.IsDigit(c) || c == '.' || c == ',').ToArray());&#10;                    if (double.TryParse(digits.Replace(',', '.'), NumberStyles.Any, CultureInfo.InvariantCulture, out var dur2))&#10;                        return dur2;&#10;                }&#10;            }&#10;            catch&#10;            {&#10;                // ignore and return 0&#10;            }&#10;&#10;            return 0;&#10;        }&#10;&#10;        // Tries multiple extraction strategies and timestamps to increase the chance of success&#10;        public static string? GetRandomFrameBase64(string filePath)&#10;        {&#10;            try&#10;            {&#10;                double duration = GetVideoDuration(filePath);&#10;                var rnd = new Random();&#10;&#10;                // Candidate timestamps (seconds)&#10;                var timestamps = new List&lt;double&gt; { 0 };&#10;                if (duration &gt; 0)&#10;                {&#10;                    timestamps.Add(Math.Min(Math.Max(0.1, duration / 2.0), Math.Max(0.1, duration - 0.5)));&#10;                    if (duration &gt; 2.0) timestamps.Add(Math.Max(0.5, duration - 1.0));&#10;                }&#10;&#10;                // Add a random timestamp if duration is known&#10;                if (duration &gt; 0.5)&#10;                {&#10;                    double max = Math.Max(0.1, duration - 0.5);&#10;                    timestamps.Add(rnd.NextDouble() * max);&#10;                }&#10;&#10;                // Ensure unique and reasonable timestamps&#10;                timestamps = timestamps.Distinct().Select(t =&gt; Math.Max(0, t)).Take(5).ToList();&#10;&#10;                // Try extraction strategies for each timestamp&#10;                foreach (var ts in timestamps)&#10;                {&#10;                    // Strategy 1: write to a temp file using fast seek (-ss before -i)&#10;                    var tmp = Path.Combine(Path.GetTempPath(), Path.GetFileNameWithoutExtension(Path.GetRandomFileName()) + &quot;.png&quot;);&#10;                    try&#10;                    {&#10;                        var psi = new ProcessStartInfo&#10;                        {&#10;                            FileName = &quot;ffmpeg&quot;,&#10;                            Arguments = $&quot;-ss {ts.ToString(CultureInfo.InvariantCulture)} -i \&quot;{filePath}\&quot; -frames:v 1 -vf scale=640:-1 -y -hide_banner -loglevel error \&quot;{tmp}\&quot;&quot;,&#10;                            RedirectStandardError = true,&#10;                            UseShellExecute = false,&#10;                            CreateNoWindow = true&#10;                        };&#10;&#10;                        using var p = Process.Start(psi);&#10;                        if (p != null)&#10;                        {&#10;                            // wait longer for more complex files&#10;                            if (!p.WaitForExit(10000))&#10;                            {&#10;                                try&#10;                                {&#10;                                    p.Kill(true);&#10;                                }&#10;                                catch&#10;                                {&#10;                                }&#10;                            }&#10;                        }&#10;&#10;                        if (File.Exists(tmp))&#10;                        {&#10;                            var fi = new FileInfo(tmp);&#10;                            if (fi.Length &gt; 100) // small sanity size&#10;                            {&#10;                                byte[] data = File.ReadAllBytes(tmp);&#10;                                try&#10;                                {&#10;                                    File.Delete(tmp);&#10;                                }&#10;                                catch&#10;                                {&#10;                                }&#10;&#10;                                return Convert.ToBase64String(data);&#10;                            }&#10;&#10;                            try&#10;                            {&#10;                                File.Delete(tmp);&#10;                            }&#10;                            catch&#10;                            {&#10;                            }&#10;                        }&#10;                    }&#10;                    catch&#10;                    {&#10;                        try&#10;                        {&#10;                            if (File.Exists(tmp)) File.Delete(tmp);&#10;                        }&#10;                        catch&#10;                        {&#10;                        }&#10;                    }&#10;&#10;                    // Strategy 2: accurate seek (position after -i)&#10;                    try&#10;                    {&#10;                        var tmp2 = Path.Combine(Path.GetTempPath(), Path.GetFileNameWithoutExtension(Path.GetRandomFileName()) + &quot;.png&quot;);&#10;                        var psi2 = new ProcessStartInfo&#10;                        {&#10;                            FileName = &quot;ffmpeg&quot;,&#10;                            Arguments = $&quot;-i \&quot;{filePath}\&quot; -ss {ts.ToString(CultureInfo.InvariantCulture)} -frames:v 1 -vf scale=640:-1 -y -hide_banner -loglevel error \&quot;{tmp2}\&quot;&quot;,&#10;                            RedirectStandardError = true,&#10;                            UseShellExecute = false,&#10;                            CreateNoWindow = true&#10;                        };&#10;&#10;                        using var p2 = Process.Start(psi2);&#10;                        if (p2 != null)&#10;                        {&#10;                            if (!p2.WaitForExit(12000))&#10;                            {&#10;                                try&#10;                                {&#10;                                    p2.Kill(true);&#10;                                }&#10;                                catch&#10;                                {&#10;                                }&#10;                            }&#10;                        }&#10;&#10;                        if (File.Exists(tmp2))&#10;                        {&#10;                            var fi2 = new FileInfo(tmp2);&#10;                            if (fi2.Length &gt; 100)&#10;                            {&#10;                                byte[] data = File.ReadAllBytes(tmp2);&#10;                                try&#10;                                {&#10;                                    File.Delete(tmp2);&#10;                                }&#10;                                catch&#10;                                {&#10;                                }&#10;&#10;                                return Convert.ToBase64String(data);&#10;                            }&#10;&#10;                            try&#10;                            {&#10;                                File.Delete(tmp2);&#10;                            }&#10;                            catch&#10;                            {&#10;                            }&#10;                        }&#10;                    }&#10;                    catch&#10;                    {&#10;                        // ignore and continue&#10;                    }&#10;&#10;                    // Strategy 3: try piping to stdout (older approach) as a last resort&#10;                    try&#10;                    {&#10;                        var psi3 = new ProcessStartInfo&#10;                        {&#10;                            FileName = &quot;ffmpeg&quot;,&#10;                            Arguments = $&quot;-ss {ts.ToString(CultureInfo.InvariantCulture)} -i \&quot;{filePath}\&quot; -frames:v 1 -vf scale=640:-1 -f image2 -vcodec png pipe:1 -hide_banner -loglevel error&quot;,&#10;                            RedirectStandardOutput = true,&#10;                            RedirectStandardError = true,&#10;                            UseShellExecute = false,&#10;                            CreateNoWindow = true&#10;                        };&#10;&#10;                        using var proc = Process.Start(psi3);&#10;                        if (proc != null)&#10;                        {&#10;                            using var ms = new MemoryStream();&#10;                            // copy but with a timeout guard&#10;                            var copyTask = proc.StandardOutput.BaseStream.CopyToAsync(ms);&#10;                            if (!copyTask.Wait(7000))&#10;                            {&#10;                                try&#10;                                {&#10;                                    proc.Kill(true);&#10;                                }&#10;                                catch&#10;                                {&#10;                                }&#10;                            }&#10;                            else&#10;                            {&#10;                                proc.WaitForExit(2000);&#10;                            }&#10;&#10;                            if (ms.Length &gt; 100)&#10;                                return Convert.ToBase64String(ms.ToArray());&#10;                        }&#10;                    }&#10;                    catch&#10;                    {&#10;                        // ignore&#10;                    }&#10;                }&#10;&#10;                // All attempts failed&#10;                return null;&#10;            }&#10;            catch&#10;            {&#10;                return null;&#10;            }&#10;        }&#10;&#10;        private static void CreateJsonReport(FileCheckResult result)&#10;        {&#10;            try&#10;            {&#10;                string filePath = result.FilePath;&#10;                FileInfo fileInfo = new FileInfo(filePath);&#10;&#10;                // Create JSON report directory if it doesn't exist&#10;                string jsonReportDir = @&quot;T:\SPT\SP\Mont\Projets\3_PRJ\9-ALEXANDRE_DEMERS-ROBERGE\Fichiers Corrompus&quot;;&#10;&#10;                if (!Directory.Exists(jsonReportDir))&#10;                {&#10;                    Directory.CreateDirectory(jsonReportDir);&#10;                }&#10;&#10;                string baseName = Path.GetFileNameWithoutExtension(filePath);&#10;                string jsonFileName = $&quot;{baseName}_report.json&quot;;&#10;                string jsonReportPath = Path.Combine(jsonReportDir, jsonFileName);&#10;&#10;                DateTime evaluationTime = DateTime.UtcNow;&#10;&#10;                // Build the comprehensive JSON report&#10;                var jsonReport = new JsonCorruptionReport&#10;                {&#10;                    ReportVersion = &quot;1.0&quot;,&#10;                    GeneratedByTool = &quot;MovFileIntegrityChecker v1.0&quot;,&#10;                    EvaluationTimeUtc = evaluationTime,&#10;                    EvaluationTimeLocal = evaluationTime.ToLocalTime(),&#10;&#10;                    FileMetadata = new JsonFileMetadata&#10;                    {&#10;                        FileName = fileInfo.Name,&#10;                        FullPath = fileInfo.FullName,&#10;                        FileSizeBytes = fileInfo.Length,&#10;                        FileSizeMB = fileInfo.Length / (1024.0 * 1024.0),&#10;                        CreationTimeUtc = fileInfo.CreationTimeUtc,&#10;                        LastModifiedTimeUtc = fileInfo.LastWriteTimeUtc,&#10;                        LastAccessTimeUtc = fileInfo.LastAccessTimeUtc,&#10;                        FileExtension = fileInfo.Extension,&#10;                        IsReadOnly = fileInfo.IsReadOnly,&#10;                        Attributes = fileInfo.Attributes.ToString()&#10;                    },&#10;&#10;                    IntegrityAnalysis = new JsonIntegrityAnalysis&#10;                    {&#10;                        BytesValidated = result.BytesValidated,&#10;                        ValidationPercentage = result.FileSize &gt; 0 ? (result.BytesValidated * 100.0 / result.FileSize) : 0,&#10;                        AtomsFound = result.Atoms.Count,&#10;                        HasStructuralIssues = result.HasIssues,&#10;                        Issues = new List&lt;string&gt;(result.Issues),&#10;                        Atoms = result.Atoms.Select(a =&gt; new JsonAtomInfo&#10;                        {&#10;                            Type = a.Type,&#10;                            SizeBytes = a.Size,&#10;                            OffsetBytes = a.Offset,&#10;                            IsComplete = a.IsComplete,&#10;                            IsKnownType = ValidAtomTypes.Contains(a.Type)&#10;                        }).ToList(),&#10;                        HasRequiredAtoms = new JsonRequiredAtoms&#10;                        {&#10;                            Ftyp = result.Atoms.Any(a =&gt; a.Type == &quot;ftyp&quot;),&#10;                            Moov = result.Atoms.Any(a =&gt; a.Type == &quot;moov&quot;),&#10;                            Mdat = result.Atoms.Any(a =&gt; a.Type == &quot;mdat&quot;)&#10;                        }&#10;                    },&#10;&#10;                    Status = new JsonFileStatus&#10;                    {&#10;                        IsCorrupted = result.HasIssues,&#10;                        IsComplete = !result.HasIssues,&#10;                        Severity = result.HasIssues ? &quot;ERROR&quot; : &quot;OK&quot;,&#10;                        Recommendation = result.HasIssues&#10;                            ? &quot;File appears to be corrupted or incomplete. Review in VLC to verify playback.&quot;&#10;                            : &quot;File structure appears valid and complete.&quot;&#10;                    }&#10;                };&#10;&#10;                // Add video duration if available&#10;                if (result.TotalDuration &gt; 0)&#10;                {&#10;                    double missingDuration = result.TotalDuration - result.PlayableDuration;&#10;                    double playablePercent = (result.PlayableDuration / result.TotalDuration) * 100.0;&#10;                    double corruptedPercent = 100.0 - playablePercent;&#10;&#10;                    jsonReport.VideoDuration = new JsonVideoDuration&#10;                    {&#10;                        TotalDurationSeconds = result.TotalDuration,&#10;                        TotalDurationFormatted = FormatDuration(result.TotalDuration),&#10;                        PlayableDurationSeconds = result.PlayableDuration,&#10;                        PlayableDurationFormatted = FormatDuration(result.PlayableDuration),&#10;                        MissingDurationSeconds = missingDuration,&#10;                        MissingDurationFormatted = FormatDuration(missingDuration),&#10;                        PlayablePercentage = playablePercent,&#10;                        CorruptedPercentage = corruptedPercent&#10;                    };&#10;                }&#10;&#10;                // Serialize to JSON with pretty formatting&#10;                var options = new JsonSerializerOptions&#10;                {&#10;                    WriteIndented = true,&#10;                    PropertyNamingPolicy = JsonNamingPolicy.CamelCase,&#10;                    DefaultIgnoreCondition = JsonIgnoreCondition.Never,&#10;                    Encoder = System.Text.Encodings.Web.JavaScriptEncoder.UnsafeRelaxedJsonEscaping&#10;                };&#10;&#10;                string jsonContent = JsonSerializer.Serialize(jsonReport, options);&#10;                File.WriteAllText(jsonReportPath, jsonContent, Encoding.UTF8);&#10;&#10;                WriteSuccess($&quot;✅ JSON report saved: {jsonReportPath}&quot;);&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                WriteWarning($&quot;⚠️ Unable to create JSON report: {ex.Message}&quot;);&#10;            }&#10;        }&#10;&#10;        public static void CreateErrorReport(FileCheckResult result)&#10;        {&#10;            try&#10;            {&#10;                string filePath = result.FilePath;&#10;                string folder = Path.GetDirectoryName(filePath)!;&#10;                string baseName = Path.GetFileNameWithoutExtension(filePath);&#10;                string reportPath = Path.Combine(folder, $&quot;{baseName}-Incomplet.html&quot;);&#10;&#10;                var sb = new StringBuilder();&#10;&#10;                // Try to get a random frame as base64 (may return null)&#10;                string? frameBase64 = GetRandomFrameBase64(filePath);&#10;&#10;                // HTML Header with embedded CSS&#10;                sb.AppendLine(&quot;&lt;!DOCTYPE html&gt;&quot;);&#10;                sb.AppendLine(&quot;&lt;html lang=\&quot;fr\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;&lt;head&gt;&quot;);&#10;                sb.AppendLine(&quot;    &lt;meta charset=\&quot;UTF-8\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1.0\&quot;&gt;&quot;);&#10;                sb.AppendLine($&quot;    &lt;title&gt;Rapport d'Intégrité - {Path.GetFileName(filePath)}&lt;/title&gt;&quot;);&#10;                sb.AppendLine(&quot;    &lt;style&gt;&quot;);&#10;                sb.AppendLine(&quot;        * { margin: 0; padding: 0; box-sizing: border-box; }&quot;);&#10;                sb.AppendLine(&quot;        body {&quot;);&#10;                sb.AppendLine(&quot;            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;&quot;);&#10;                sb.AppendLine(&quot;            background: #000000;&quot;);&#10;                sb.AppendLine(&quot;            min-height: 100vh;&quot;);&#10;                sb.AppendLine(&quot;            padding: 40px 20px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .container {&quot;);&#10;                sb.AppendLine(&quot;            max-width: 1000px;&quot;);&#10;                sb.AppendLine(&quot;            margin: 0 auto;&quot;);&#10;                sb.AppendLine(&quot;            background: #1a1a1a;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 16px;&quot;);&#10;                sb.AppendLine(&quot;            box-shadow: 0 20px 60px rgba(0,0,0,0.5);&quot;);&#10;                sb.AppendLine(&quot;            overflow: hidden;&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .header {&quot;);&#10;                sb.AppendLine(&quot;            background: #111111;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            padding: 30px 40px;&quot;);&#10;                sb.AppendLine(&quot;            text-align: center;&quot;);&#10;                sb.AppendLine(&quot;            border-bottom: 2px solid #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .header h1 {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1.8em;&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 15px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .header .subtitle {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1em;&quot;);&#10;                sb.AppendLine(&quot;            color: #ccc;&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 15px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .header .warning {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.95em;&quot;);&#10;                sb.AppendLine(&quot;            color: #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;            line-height: 1.5;&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 15px;&quot;);&#10;                sb.AppendLine(&quot;            padding-top: 15px;&quot;);&#10;                sb.AppendLine(&quot;            border-top: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .header .warning strong {&quot;);&#10;                sb.AppendLine(&quot;            display: block;&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 8px;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .content {&quot;);&#10;                sb.AppendLine(&quot;            padding: 40px;&quot;);&#10;                sb.AppendLine(&quot;            background: #1a1a1a;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .section {&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 30px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .section-title {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1.5em;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 15px;&quot;);&#10;                sb.AppendLine(&quot;            padding-bottom: 10px;&quot;);&#10;                sb.AppendLine(&quot;            border-bottom: 2px solid #333;&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            align-items: center;&quot;);&#10;                sb.AppendLine(&quot;            gap: 10px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .info-grid {&quot;);&#10;                sb.AppendLine(&quot;            display: grid;&quot;);&#10;                sb.AppendLine(&quot;            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));&quot;);&#10;                sb.AppendLine(&quot;            gap: 20px;&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 20px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .info-card {&quot;);&#10;                sb.AppendLine(&quot;            background: #222222;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            padding: 20px;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 12px;&quot;);&#10;                sb.AppendLine(&quot;            box-shadow: 0 4px 15px rgba(0,0,0,0.5);&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;            border-left: 3px solid #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .info-card .label {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;                sb.AppendLine(&quot;            color: #999;&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 5px;&quot;);&#10;                sb.AppendLine(&quot;            text-transform: uppercase;&quot;);&#10;                sb.AppendLine(&quot;            letter-spacing: 0.5px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .info-card .value {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1.5em;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .issue-list {&quot;);&#10;                sb.AppendLine(&quot;            background: #2a1a1a;&quot;);&#10;                sb.AppendLine(&quot;            border-left: 4px solid #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;            padding: 20px;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 8px;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .issue-item {&quot;);&#10;                sb.AppendLine(&quot;            padding: 10px 0;&quot;);&#10;                sb.AppendLine(&quot;            border-bottom: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            align-items: start;&quot;);&#10;                sb.AppendLine(&quot;            gap: 10px;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .issue-item:last-child {&quot;);&#10;                sb.AppendLine(&quot;            border-bottom: none;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .issue-icon {&quot;);&#10;                sb.AppendLine(&quot;            color: #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            flex-shrink: 0;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-table {&quot;);&#10;                sb.AppendLine(&quot;            width: 100%;&quot;);&#10;                sb.AppendLine(&quot;            border-collapse: collapse;&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 20px;&quot;);&#10;                sb.AppendLine(&quot;            box-shadow: 0 2px 10px rgba(0,0,0,0.5);&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 8px;&quot;);&#10;                sb.AppendLine(&quot;            overflow: hidden;&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-table thead {&quot;);&#10;                sb.AppendLine(&quot;            background: #111111;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            border-bottom: 2px solid #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-table th {&quot;);&#10;                sb.AppendLine(&quot;            padding: 15px;&quot;);&#10;                sb.AppendLine(&quot;            text-align: left;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: 600;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-table td {&quot;);&#10;                sb.AppendLine(&quot;            padding: 12px 15px;&quot;);&#10;                sb.AppendLine(&quot;            border-bottom: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-table tbody tr {&quot;);&#10;                sb.AppendLine(&quot;            background: #1a1a1a;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-table tbody tr:hover {&quot;);&#10;                sb.AppendLine(&quot;            background: #252525;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .status-badge {&quot;);&#10;                sb.AppendLine(&quot;            display: inline-block;&quot;);&#10;                sb.AppendLine(&quot;            padding: 5px 12px;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 20px;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.85em;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: 600;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .status-complete {&quot;);&#10;                sb.AppendLine(&quot;            background: #1a3a1a;&quot;);&#10;                sb.AppendLine(&quot;            color: #90ee90;&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #90ee90;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .status-incomplete {&quot;);&#10;                sb.AppendLine(&quot;            background: #3a1a1a;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .atom-type {&quot;);&#10;                sb.AppendLine(&quot;            font-family: 'Courier New', monospace;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1.1em;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .footer {&quot;);&#10;                sb.AppendLine(&quot;            background: #111111;&quot;);&#10;                sb.AppendLine(&quot;            padding: 20px 40px;&quot;);&#10;                sb.AppendLine(&quot;            text-align: center;&quot;);&#10;                sb.AppendLine(&quot;            color: #888;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;                sb.AppendLine(&quot;            border-top: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .progress-bar {&quot;);&#10;                sb.AppendLine(&quot;            width: 100%;&quot;);&#10;                sb.AppendLine(&quot;            height: 30px;&quot;);&#10;                sb.AppendLine(&quot;            background: #2a2a2a;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 15px;&quot;);&#10;                sb.AppendLine(&quot;            overflow: hidden;&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 10px;&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #444;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .progress-fill {&quot;);&#10;                sb.AppendLine(&quot;            height: 100%;&quot;);&#10;                sb.AppendLine(&quot;            background: linear-gradient(90deg, #ff8c00 0%, #ffa500 100%);&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            align-items: center;&quot;);&#10;                sb.AppendLine(&quot;            justify-content: center;&quot;);&#10;                sb.AppendLine(&quot;            color: #000000;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.85em;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-container {&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 30px;&quot;);&#10;                sb.AppendLine(&quot;            padding: 20px;&quot;);&#10;                sb.AppendLine(&quot;            background: #222222;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 12px;&quot;);&#10;                sb.AppendLine(&quot;            border: 1px solid #333;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-title {&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1.2em;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            margin-bottom: 15px;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: 600;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-bar {&quot;);&#10;                sb.AppendLine(&quot;            width: 100%;&quot;);&#10;                sb.AppendLine(&quot;            height: 40px;&quot;);&#10;                sb.AppendLine(&quot;            background: #2a2a2a;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 8px;&quot;);&#10;                sb.AppendLine(&quot;            overflow: hidden;&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            border: 2px solid #444;&quot;);&#10;                sb.AppendLine(&quot;            margin: 15px 0;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-good {&quot;);&#10;                sb.AppendLine(&quot;            background: linear-gradient(90deg, #00aa00 0%, #00cc00 100%);&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            align-items: center;&quot;);&#10;                sb.AppendLine(&quot;            justify-content: center;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-bad {&quot;);&#10;                sb.AppendLine(&quot;            background: linear-gradient(90deg, #cc0000 0%, #aa0000 100%);&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            align-items: center;&quot;);&#10;                sb.AppendLine(&quot;            justify-content: center;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-labels {&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            justify-content: space-between;&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 10px;&quot;);&#10;                sb.AppendLine(&quot;            color: #ccc;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-label {&quot;);&#10;                sb.AppendLine(&quot;            display: flex;&quot;);&#10;                sb.AppendLine(&quot;            flex-direction: column;&quot;);&#10;                sb.AppendLine(&quot;            align-items: center;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-label.start { align-items: flex-start; }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-label.end { align-items: flex-end; }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-label .time {&quot;);&#10;                sb.AppendLine(&quot;            font-weight: bold;&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;            font-size: 1.1em;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-info {&quot;);&#10;                sb.AppendLine(&quot;            margin-top: 15px;&quot;);&#10;                sb.AppendLine(&quot;            padding: 15px;&quot;);&#10;                sb.AppendLine(&quot;            background: #1a1a1a;&quot;);&#10;                sb.AppendLine(&quot;            border-radius: 8px;&quot;);&#10;                sb.AppendLine(&quot;            border-left: 3px solid #ff8c00;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-info div {&quot;);&#10;                sb.AppendLine(&quot;            color: #ccc;&quot;);&#10;                sb.AppendLine(&quot;            margin: 5px 0;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .timeline-info strong {&quot;);&#10;                sb.AppendLine(&quot;            color: #ffffff;&quot;);&#10;                sb.AppendLine(&quot;        }&quot;);&#10;                sb.AppendLine(&quot;        .preview img { max-width: 100%; border-radius: 8px; display: block; margin: 15px auto; }&quot;);&#10;                sb.AppendLine(&quot;    &lt;/style&gt;&quot;);&#10;                sb.AppendLine(&quot;&lt;/head&gt;&quot;);&#10;                sb.AppendLine(&quot;&lt;body&gt;&quot;);&#10;                sb.AppendLine(&quot;    &lt;div class=\&quot;container\&quot;&gt;&quot;);&#10;&#10;                // Header&#10;                sb.AppendLine(&quot;        &lt;div class=\&quot;header\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;            &lt;h1&gt;⚠️ Rapport d'Intégrité Fichier&lt;/h1&gt;&quot;);&#10;                sb.AppendLine($&quot;            &lt;div class=\&quot;subtitle\&quot;&gt;{System.Security.SecurityElement.Escape(Path.GetFileName(filePath))}&lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;            &lt;div class=\&quot;warning\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                &lt;strong&gt;Avertissement - Fichier potentiellement incomplet&lt;/strong&gt;&quot;);&#10;                sb.AppendLine(&quot;                Ce fichier a été automatiquement détecté comme étant potentiellement incomplet. &quot;);&#10;                sb.AppendLine(&quot;                Veuillez le visionner jusqu'à la fin dans VLC pour vérifier s'il se lit correctement.&quot;);&#10;                sb.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;                // Content&#10;                sb.AppendLine(&quot;        &lt;div class=\&quot;content\&quot;&gt;&quot;);&#10;&#10;                // Embed preview if available&#10;                if (!string.IsNullOrEmpty(frameBase64))&#10;                {&#10;                    sb.AppendLine(&quot;            &lt;div class=\&quot;section\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;div class=\&quot;section-title\&quot;&gt;Preview&lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;div class=\&quot;preview\&quot;&gt;&quot;);&#10;                    sb.AppendLine($&quot;                    &lt;img src=\&quot;data:image/png;base64,{frameBase64}\&quot; alt=\&quot;Preview\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;                }&#10;                else&#10;                {&#10;                    sb.AppendLine(&quot;            &lt;div class=\&quot;section\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;div class=\&quot;section-title\&quot;&gt;Preview&lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;div class=\&quot;issue-list\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                    &lt;div class=\&quot;issue-item\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                        &lt;span class=\&quot;issue-icon\&quot;&gt;ℹ️&lt;/span&gt;&quot;);&#10;                    sb.AppendLine(&quot;                        &lt;span&gt;Preview not available (ffmpeg/ffprobe not found or frame extraction failed).&lt;/span&gt;&quot;);&#10;                    sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;                }&#10;&#10;                sb.AppendLine(&quot;            &lt;div class=\&quot;section\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                &lt;div class=\&quot;section-title\&quot;&gt; Résumé Technique&lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                &lt;div class=\&quot;info-grid\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;div class=\&quot;info-card\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                        &lt;div class=\&quot;label\&quot;&gt;Nom du fichier&lt;/div&gt;&quot;);&#10;                sb.AppendLine($&quot;                        &lt;div class=\&quot;value\&quot;&gt;{System.Security.SecurityElement.Escape(Path.GetFileName(filePath))}&lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;div class=\&quot;info-card\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                        &lt;div class=\&quot;label\&quot;&gt;Taille du fichier&lt;/div&gt;&quot;);&#10;                sb.AppendLine($&quot;                        &lt;div class=\&quot;value\&quot;&gt;{result.FileSize:N0} octets&lt;/div&gt;&quot;);&#10;                sb.AppendLine($&quot;                        &lt;div class=\&quot;label\&quot;&gt;({result.FileSize / (1024.0 * 1024.0):F2} MB)&lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;div class=\&quot;info-card\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                        &lt;div class=\&quot;label\&quot;&gt;Octets validés&lt;/div&gt;&quot;);&#10;                sb.AppendLine($&quot;                        &lt;div class=\&quot;value\&quot;&gt;{result.BytesValidated:N0}&lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;div class=\&quot;info-card\&quot;&gt;&quot;);&#10;                sb.AppendLine(&quot;                        &lt;div class=\&quot;label\&quot;&gt;Atoms détectés&lt;/div&gt;&quot;);&#10;                sb.AppendLine($&quot;                        &lt;div class=\&quot;value\&quot;&gt;{result.Atoms.Count}&lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                &lt;/div&gt;&quot;);&#10;&#10;                double validationPercent = result.FileSize &gt; 0 ? (result.BytesValidated * 100.0 / result.FileSize) : 0;&#10;                sb.AppendLine(&quot;                &lt;div class=\&quot;progress-bar\&quot;&gt;&quot;);&#10;                sb.AppendLine($&quot;                    &lt;div class=\&quot;progress-fill\&quot; style=\&quot;width: {validationPercent.ToString(&quot;F1&quot;, CultureInfo.InvariantCulture)}%\&quot;&gt;\n                        {validationPercent:F1}% validé\n                    &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;                &lt;/div&gt;&quot;);&#10;&#10;                // Add duration timeline if available&#10;                if (result.TotalDuration &gt; 0)&#10;                {&#10;                    sb.AppendLine(&quot;                &lt;div class=\&quot;timeline-container\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                    &lt;div class=\&quot;timeline-title\&quot;&gt;⏱️ Chronologie de la Vidéo&lt;/div&gt;&quot;);&#10;&#10;                    double playablePercent = result.TotalDuration &gt; 0 ? (result.PlayableDuration / result.TotalDuration) * 100.0 : 0;&#10;                    double brokenPercent = 100.0 - playablePercent;&#10;&#10;                    sb.AppendLine(&quot;                    &lt;div class=\&quot;timeline-bar\&quot;&gt;&quot;);&#10;                    if (playablePercent &gt; 0)&#10;                    {&#10;                        sb.AppendLine($&quot;                        &lt;div class=\&quot;timeline-good\&quot; style=\&quot;width: {playablePercent.ToString(&quot;F1&quot;, CultureInfo.InvariantCulture)}%\&quot;&gt;&quot;);&#10;                        sb.AppendLine($&quot;                            ✓ Lecture OK&quot;);&#10;                        sb.AppendLine(&quot;                        &lt;/div&gt;&quot;);&#10;                    }&#10;&#10;                    if (brokenPercent &gt; 0)&#10;                    {&#10;                        sb.AppendLine($&quot;                        &lt;div class=\&quot;timeline-bad\&quot; style=\&quot;width: {brokenPercent.ToString(&quot;F1&quot;, CultureInfo.InvariantCulture)}%\&quot;&gt;&quot;);&#10;                        sb.AppendLine($&quot;                            ✗ Corrompu&quot;);&#10;                        sb.AppendLine(&quot;                        &lt;/div&gt;&quot;);&#10;                    }&#10;&#10;                    sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;&#10;                    sb.AppendLine(&quot;                    &lt;div class=\&quot;timeline-labels\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                        &lt;div class=\&quot;timeline-label start\&quot;&gt;&quot;);&#10;                    sb.AppendLine(&quot;                            &lt;div class=\&quot;time\&quot;&gt;00:00:00&lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                            &lt;div&gt;Début&lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                        &lt;/div&gt;&quot;);&#10;&#10;                    if (result.HasIssues &amp;&amp; result.PlayableDuration &lt; result.TotalDuration)&#10;                    {&#10;                        sb.AppendLine(&quot;                        &lt;div class=\&quot;timeline-label\&quot;&gt;&quot;);&#10;                        sb.AppendLine($&quot;                            &lt;div class=\&quot;time\&quot;&gt;{System.Security.SecurityElement.Escape(FormatDuration(result.PlayableDuration))}&lt;/div&gt;&quot;);&#10;                        sb.AppendLine(&quot;                            &lt;div style=\&quot;color: #ff8c00;\&quot;&gt;⚠️ Point de rupture&lt;/div&gt;&quot;);&#10;                        sb.AppendLine(&quot;                        &lt;/div&gt;&quot;);&#10;                    }&#10;&#10;                    sb.AppendLine(&quot;                        &lt;div class=\&quot;timeline-label end\&quot;&gt;&quot;);&#10;                    sb.AppendLine($&quot;                            &lt;div class=\&quot;time\&quot;&gt;{System.Security.SecurityElement.Escape(FormatDuration(result.TotalDuration))}&lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                            &lt;div&gt;Fin&lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                        &lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;&#10;                    sb.AppendLine(&quot;                    &lt;div class=\&quot;timeline-info\&quot;&gt;&quot;);&#10;                    sb.AppendLine($&quot;                        &lt;div&gt;&lt;strong&gt;Durée totale:&lt;/strong&gt; {System.Security.SecurityElement.Escape(FormatDuration(result.TotalDuration))}&lt;/div&gt;&quot;);&#10;                    sb.AppendLine($&quot;                        &lt;div&gt;&lt;strong&gt;Durée lisible:&lt;/strong&gt; {System.Security.SecurityElement.Escape(FormatDuration(result.PlayableDuration))} ({playablePercent:F1}%)&lt;/div&gt;&quot;);&#10;                    if (result.HasIssues &amp;&amp; result.PlayableDuration &lt; result.TotalDuration)&#10;                    {&#10;                        double missingDuration = result.TotalDuration - result.PlayableDuration;&#10;                        sb.AppendLine($&quot;                        &lt;div style=\&quot;color: #ff8c00;\&quot;&gt;&lt;strong&gt;Durée manquante:&lt;/strong&gt; {System.Security.SecurityElement.Escape(FormatDuration(missingDuration))} ({brokenPercent:F1}%)&lt;/div&gt;&quot;);&#10;                    }&#10;&#10;                    sb.AppendLine(&quot;                    &lt;/div&gt;&quot;);&#10;                    sb.AppendLine(&quot;                &lt;/div&gt;&quot;);&#10;                }&#10;&#10;                sb.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;                if (result.Issues.Count &gt; 0)&#10;                {&#10;                    sb.AppendLine(&quot;            &lt;div class=\&quot;section\&quot;&gt;\n                &lt;div class=\&quot;section-title\&quot;&gt;❌ Problèmes Détectés&lt;/div&gt;\n                &lt;div class=\&quot;issue-list\&quot;&gt;\n&quot;);&#10;                    foreach (var issue in result.Issues)&#10;                    {&#10;                        sb.AppendLine(&quot;                    &lt;div class=\&quot;issue-item\&quot;&gt;\n                        &lt;span class=\&quot;issue-icon\&quot;&gt;❌&lt;/span&gt;\n                        &lt;span&gt;&quot; + System.Security.SecurityElement.Escape(issue) + &quot;&lt;/span&gt;\n                    &lt;/div&gt;&quot;);&#10;                    }&#10;&#10;                    sb.AppendLine(&quot;                &lt;/div&gt;\n            &lt;/div&gt;&quot;);&#10;                }&#10;&#10;                if (result.Atoms.Count &gt; 0)&#10;                {&#10;                    sb.AppendLine(&quot;            &lt;div class=\&quot;section\&quot;&gt;\n                &lt;div class=\&quot;section-title\&quot;&gt; Structure des Atoms&lt;/div&gt;\n                &lt;table class=\&quot;atom-table\&quot;&gt;\n                    &lt;thead&gt;\n                        &lt;tr&gt;\n                            &lt;th&gt;Type&lt;/th&gt;\n                            &lt;th&gt;Taille&lt;/th&gt;\n                            &lt;th&gt;Offset&lt;/th&gt;\n                            &lt;th&gt;Statut&lt;/th&gt;\n                        &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;&quot;);&#10;                    foreach (var atom in result.Atoms)&#10;                    {&#10;                        string statusClass = atom.IsComplete ? &quot;status-complete&quot; : &quot;status-incomplete&quot;;&#10;                        string statusText = atom.IsComplete ? &quot;✅ Complet&quot; : &quot;❌ Incomplet&quot;;&#10;                        sb.AppendLine(&quot;                        &lt;tr&gt;\n                            &lt;td&gt;&lt;span class=\&quot;atom-type\&quot;&gt;&quot; + System.Security.SecurityElement.Escape(atom.Type) + &quot;&lt;/span&gt;&lt;/td&gt;\n                            &lt;td&gt;&quot; + atom.Size.ToString(&quot;N0&quot;) + &quot; octets&lt;/td&gt;\n                            &lt;td&gt;&quot; + atom.Offset.ToString(&quot;N0&quot;) + &quot;&lt;/td&gt;\n                            &lt;td&gt;&lt;span class=\&quot;status-badge &quot; + statusClass + &quot;\&quot;&gt;&quot; + statusText + &quot;&lt;/span&gt;&lt;/td&gt;\n                        &lt;/tr&gt;&quot;);&#10;                    }&#10;&#10;                    sb.AppendLine(&quot;                    &lt;/tbody&gt;\n                &lt;/table&gt;\n            &lt;/div&gt;&quot;);&#10;                }&#10;&#10;                sb.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;                // Footer&#10;                sb.AppendLine(&quot;        &lt;div class=\&quot;footer\&quot;&gt;\n            Généré automatiquement le &quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd&quot;) + &quot; à &quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;&lt;br&gt;\n            Outil : MovIntegrityChecker (rapport automatique)\n        &lt;/div&gt;&quot;);&#10;&#10;                sb.AppendLine(&quot;    &lt;/div&gt;&quot;);&#10;                sb.AppendLine(&quot;&lt;/body&gt;&quot;);&#10;                sb.AppendLine(&quot;&lt;/html&gt;&quot;);&#10;&#10;                File.WriteAllText(reportPath, sb.ToString(), Encoding.UTF8);&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                WriteWarning($&quot;Impossible d'écrire le rapport d'erreur : {ex.Message}&quot;);&#10;            }&#10;        }&#10;&#10;        private static void WriteWarning(string message)&#10;        {&#10;            var oldColor = Console.ForegroundColor;&#10;            Console.ForegroundColor = ConsoleColor.Yellow;&#10;            Console.WriteLine(message);&#10;            Console.ForegroundColor = oldColor;&#10;        }&#10;&#10;        private static void WriteSuccess(string message)&#10;        {&#10;            var oldColor = Console.ForegroundColor;&#10;            Console.ForegroundColor = ConsoleColor.Green;&#10;            Console.WriteLine(message);&#10;            Console.ForegroundColor = oldColor;&#10;        }&#10;&#10;        private static void WriteError(string message)&#10;        {&#10;            var oldColor = Console.ForegroundColor;&#10;            Console.ForegroundColor = ConsoleColor.Red;&#10;            Console.WriteLine(message);&#10;            Console.ForegroundColor = oldColor;&#10;        }&#10;&#10;        private static void WriteInfo(string message)&#10;        {&#10;            var oldColor = Console.ForegroundColor;&#10;            Console.ForegroundColor = ConsoleColor.Cyan;&#10;            Console.WriteLine(message);&#10;            Console.ForegroundColor = oldColor;&#10;        }&#10;&#10;        private static void DeleteEmptyDirectories(string rootPath, bool recursive)&#10;        {&#10;            try&#10;            {&#10;                var directories = Directory.GetDirectories(&#10;                    rootPath,&#10;                    &quot;*&quot;,&#10;                    recursive ? SearchOption.AllDirectories : SearchOption.TopDirectoryOnly);&#10;&#10;                int deletedCount = 0;&#10;&#10;                // Sort by descending path length to delete deep folders first&#10;                foreach (var dir in directories.OrderByDescending(d =&gt; d.Length))&#10;                {&#10;                    if (!Directory.EnumerateFileSystemEntries(dir).Any())&#10;                    {&#10;                        Directory.Delete(dir);&#10;                        deletedCount++;&#10;                        WriteSuccess($&quot;Deleted empty folder: {dir}&quot;);&#10;                    }&#10;                }&#10;&#10;                // Check root folder itself&#10;                if (!Directory.EnumerateFileSystemEntries(rootPath).Any())&#10;                {&#10;                    Directory.Delete(rootPath);&#10;                    deletedCount++;&#10;                    WriteSuccess($&quot;Deleted empty root folder: {rootPath}&quot;);&#10;                }&#10;&#10;                if (deletedCount &gt; 0)&#10;                    WriteInfo($&quot;\n✅ {deletedCount} empty folder(s) deleted.&quot;);&#10;                else&#10;                    WriteInfo(&quot;\nNo empty folders found.&quot;);&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                WriteError($&quot;Error while deleting empty folders: {ex.Message}&quot;);&#10;            }&#10;        }&#10;&#10;        private static void ShowMainMenu()&#10;        {&#10;            Console.Clear();&#10;            Console.WriteLine(&quot;╔════════════════════════════════════════════════════════════════╗&quot;);&#10;            Console.WriteLine(&quot;║        MOV File Integrity Checker - Analysis Mode             ║&quot;);&#10;            Console.WriteLine(&quot;╚════════════════════════════════════════════════════════════════╝&quot;);&#10;            Console.WriteLine();&#10;            Console.WriteLine(&quot;Please select an analysis mode:&quot;);&#10;            Console.WriteLine();&#10;            Console.WriteLine(&quot;  1. Per-File Analysis     - Analyze individual video files&quot;);&#10;            Console.WriteLine(&quot;  2. Global Analysis       - Generate global report from JSON files&quot;);&#10;            Console.WriteLine(&quot;  3. Both                  - Run per-file analysis then global report&quot;);&#10;            Console.WriteLine(&quot;  4. Exit&quot;);&#10;            Console.WriteLine();&#10;            Console.Write(&quot;Enter your choice (1-4): &quot;);&#10;&#10;            string? choice = Console.ReadLine();&#10;            Console.WriteLine();&#10;&#10;            switch (choice?.Trim())&#10;            {&#10;                case &quot;1&quot;:&#10;                    RunPerFileAnalysisInteractive();&#10;                    break;&#10;                case &quot;2&quot;:&#10;                    RunGlobalAnalysis();&#10;                    break;&#10;                case &quot;3&quot;:&#10;                    RunPerFileAnalysisInteractive();&#10;                    Console.WriteLine(&quot;\n&quot; + new string('=', 80));&#10;                    Console.WriteLine(&quot;Starting Global Analysis...&quot;);&#10;                    Console.WriteLine(new string('=', 80) + &quot;\n&quot;);&#10;                    RunGlobalAnalysis();&#10;                    break;&#10;                case &quot;4&quot;:&#10;                    Console.WriteLine(&quot;Exiting...&quot;);&#10;                    return;&#10;                default:&#10;                    WriteError(&quot;Invalid choice. Please run the program again.&quot;);&#10;                    break;&#10;            }&#10;        }&#10;&#10;        private static void RunPerFileAnalysisInteractive()&#10;        {&#10;            Console.Write(&quot;Enter the path to a file or folder: &quot;);&#10;            string? path = Console.ReadLine()?.Trim().Trim('&quot;');&#10;&#10;            if (string.IsNullOrEmpty(path))&#10;            {&#10;                WriteError(&quot;No path provided.&quot;);&#10;                return;&#10;            }&#10;&#10;            Console.Write(&quot;Recursive search? (y/n, default: n): &quot;);&#10;            bool recursive = Console.ReadLine()?.Trim().ToLower() == &quot;y&quot;;&#10;&#10;            Console.Write(&quot;Delete empty folders? (y/n, default: n): &quot;);&#10;            bool deleteEmpty = Console.ReadLine()?.Trim().ToLower() == &quot;y&quot;;&#10;&#10;            Console.WriteLine();&#10;&#10;            // Run the analysis&#10;            RunPerFileAnalysis(new[] { path }, recursive, summaryOnly: false, deleteEmpty);&#10;        }&#10;&#10;        private static void RunPerFileAnalysis(string[] paths, bool recursive, bool summaryOnly, bool deleteEmpty)&#10;        {&#10;            var results = new List&lt;FileCheckResult&gt;();&#10;&#10;            foreach (var path in paths)&#10;            {&#10;                if (File.Exists(path))&#10;                {&#10;                    // Single file&#10;                    WriteInfo($&quot;\nChecking file: {path}\n&quot;);&#10;                    var result = CheckFileIntegrity(path);&#10;                    results.Add(result);&#10;&#10;                    // Always create JSON report&#10;                    CreateJsonReport(result);&#10;&#10;                    // Create HTML report only for corrupted files&#10;                    if (result.HasIssues)&#10;                    {&#10;                        CreateErrorReport(result);&#10;                    }&#10;&#10;                    if (!summaryOnly)&#10;                        PrintDetailedResult(result);&#10;                }&#10;                else if (Directory.Exists(path))&#10;                {&#10;                    // Directory&#10;                    WriteInfo($&quot;\nChecking folder: {path}&quot;);&#10;                    WriteInfo($&quot;Recursive: {(recursive ? &quot;Yes&quot; : &quot;No&quot;)}\n&quot;);&#10;&#10;                    var searchOption = recursive ? SearchOption.AllDirectories : SearchOption.TopDirectoryOnly;&#10;                    var extensions = new[] { &quot;*.mov&quot;, &quot;*.mp4&quot;, &quot;*.m4v&quot;, &quot;*.m4a&quot; };&#10;&#10;                    var files = extensions&#10;                        .SelectMany(ext =&gt; Directory.GetFiles(path, ext, searchOption))&#10;                        .OrderBy(f =&gt; f)&#10;                        .ToList();&#10;&#10;                    if (files.Count == 0)&#10;                    {&#10;                        WriteWarning($&quot;No MOV/MP4 files found in: {path}&quot;);&#10;                        continue;&#10;                    }&#10;&#10;                    WriteInfo($&quot;Found {files.Count} file(s) to check...\n&quot;);&#10;&#10;                    int current = 0;&#10;                    foreach (var file in files)&#10;                    {&#10;                        current++;&#10;&#10;                        if (summaryOnly)&#10;                            Console.Write($&quot;\rProcessing: {current}/{files.Count} - {Path.GetFileName(file)}&quot;.PadRight(80));&#10;                        else&#10;                            WriteInfo($&quot;[{current}/{files.Count}] Checking: {Path.GetFileName(file)}&quot;);&#10;&#10;                        var result = CheckFileIntegrity(file);&#10;                        results.Add(result);&#10;&#10;                        // Always create JSON report&#10;                        CreateJsonReport(result);&#10;&#10;                        // Create HTML report only for corrupted files&#10;                        if (result.HasIssues)&#10;                        {&#10;                            CreateErrorReport(result);&#10;                        }&#10;&#10;                        if (!summaryOnly)&#10;                            PrintDetailedResult(result);&#10;                    }&#10;&#10;                    if (summaryOnly)&#10;                        Console.WriteLine(&quot;\n&quot;);&#10;&#10;                    // Delete empty folders if requested&#10;                    if (deleteEmpty)&#10;                    {&#10;                        DeleteEmptyDirectories(path, recursive);&#10;                    }&#10;                }&#10;                else&#10;                {&#10;                    WriteError($&quot;Path not found: {path}&quot;);&#10;                    Environment.ExitCode = 1;&#10;                }&#10;            }&#10;&#10;            // Print summary&#10;            PrintSummary(results, summaryOnly);&#10;        }&#10;&#10;        private static void PrintSummary(List&lt;FileCheckResult&gt; results, bool summaryOnly)&#10;        {&#10;            Console.WriteLine($&quot;\n{new string('=', 80)}&quot;);&#10;            Console.WriteLine(&quot;SUMMARY&quot;);&#10;            Console.WriteLine(new string('=', 80));&#10;&#10;            int totalFiles = results.Count;&#10;            int validFiles = results.Count(r =&gt; !r.HasIssues);&#10;            int corruptedFiles = results.Count(r =&gt; r.HasIssues);&#10;            long totalSize = results.Sum(r =&gt; r.FileSize);&#10;&#10;            Console.WriteLine($&quot;\nTotal Files Checked: {totalFiles}&quot;);&#10;            WriteSuccess($&quot;Valid Files: {validFiles} ({(validFiles * 100.0 / Math.Max(1, totalFiles)):F1}%)&quot;);&#10;            WriteError($&quot;Corrupted/Incomplete Files: {corruptedFiles} ({(corruptedFiles * 100.0 / Math.Max(1, totalFiles)):F1}%)&quot;);&#10;            Console.WriteLine($&quot;Total Size: {totalSize:N0} bytes ({totalSize / (1024.0 * 1024.0):F2} MB)&quot;);&#10;&#10;            if (corruptedFiles &gt; 0)&#10;            {&#10;                Console.WriteLine($&quot;\n❌ Corrupted/Incomplete Files:&quot;);&#10;                foreach (var result in results.Where(r =&gt; r.HasIssues))&#10;                {&#10;                    WriteError($&quot;   • {Path.GetFileName(result.FilePath)}&quot;);&#10;                    if (!summaryOnly &amp;&amp; result.Issues.Count &gt; 0)&#10;                    {&#10;                        foreach (var issue in result.Issues.Take(3))&#10;                            Console.WriteLine($&quot;      - {issue}&quot;);&#10;                        if (result.Issues.Count &gt; 3)&#10;                            Console.WriteLine($&quot;      ... and {result.Issues.Count - 3} more issue(s)&quot;);&#10;                    }&#10;                }&#10;            }&#10;&#10;            Environment.ExitCode = corruptedFiles &gt; 0 ? 1 : 0;&#10;        }&#10;&#10;        public static void RunGlobalAnalysis()&#10;        {&#10;            Console.WriteLine(&quot;╔════════════════════════════════════════════════════════════════╗&quot;);&#10;            Console.WriteLine(&quot;║              Global Analysis Mode                              ║&quot;);&#10;            Console.WriteLine(&quot;╚════════════════════════════════════════════════════════════════╝&quot;);&#10;            Console.WriteLine();&#10;&#10;            // Ask for the directory containing JSON reports&#10;            Console.Write(&quot;Enter the directory containing JSON reports\n(default: T:\\SPT\\SP\\Mont\\Projets\\3_PRJ\\9-ALEXANDRE_DEMERS-ROBERGE\\Fichiers Corrompus): &quot;);&#10;            string? jsonDir = Console.ReadLine()?.Trim().Trim('&quot;');&#10;&#10;            if (string.IsNullOrEmpty(jsonDir))&#10;            {&#10;                jsonDir = @&quot;T:\SPT\SP\Mont\Projets\3_PRJ\9-ALEXANDRE_DEMERS-ROBERGE\Fichiers Corrompus&quot;;&#10;            }&#10;&#10;            if (!Directory.Exists(jsonDir))&#10;            {&#10;                WriteError($&quot;Directory not found: {jsonDir}&quot;);&#10;                return;&#10;            }&#10;&#10;            WriteInfo($&quot;\nSearching for JSON reports in: {jsonDir}\n&quot;);&#10;&#10;            // Find all JSON report files&#10;            var jsonFiles = Directory.GetFiles(jsonDir, &quot;*_report.json&quot;, SearchOption.TopDirectoryOnly);&#10;&#10;            if (jsonFiles.Length == 0)&#10;            {&#10;                WriteWarning(&quot;No JSON report files found. Please run per-file analysis first to generate reports.&quot;);&#10;                return;&#10;            }&#10;&#10;            WriteInfo($&quot;Found {jsonFiles.Length} JSON report(s). Loading data...\n&quot;);&#10;&#10;            // Load all reports&#10;            var reports = new List&lt;JsonCorruptionReport&gt;();&#10;            foreach (var jsonFile in jsonFiles)&#10;            {&#10;                try&#10;                {&#10;                    string jsonContent = File.ReadAllText(jsonFile);&#10;                    var report = JsonSerializer.Deserialize&lt;JsonCorruptionReport&gt;(jsonContent);&#10;                    if (report != null)&#10;                    {&#10;                        reports.Add(report);&#10;                    }&#10;                }&#10;                catch (Exception ex)&#10;                {&#10;                    WriteWarning($&quot;Failed to load {Path.GetFileName(jsonFile)}: {ex.Message}&quot;);&#10;                }&#10;            }&#10;&#10;            if (reports.Count == 0)&#10;            {&#10;                WriteError(&quot;No valid reports could be loaded.&quot;);&#10;                return;&#10;            }&#10;&#10;            WriteSuccess($&quot;Loaded {reports.Count} report(s) successfully.\n&quot;);&#10;&#10;            // Generate global report&#10;            GenerateGlobalHtmlReport(reports, jsonDir);&#10;        }&#10;&#10;        public static void GenerateGlobalHtmlReport(List&lt;JsonCorruptionReport&gt; reports, string outputDir)&#10;        {&#10;            WriteInfo(&quot;Analyzing data and generating global report...\n&quot;);&#10;&#10;            // Calculate statistics&#10;            int totalFiles = reports.Count;&#10;            int corruptedFiles = reports.Count(r =&gt; r.Status.IsCorrupted);&#10;            int completeFiles = reports.Count(r =&gt; r.Status.IsComplete);&#10;            int incompleteFiles = totalFiles - completeFiles;&#10;&#10;            long totalBytes = reports.Sum(r =&gt; r.FileMetadata.FileSizeBytes);&#10;            double totalMB = totalBytes / (1024.0 * 1024.0);&#10;            double totalGB = totalBytes / (1024.0 * 1024.0 * 1024.0);&#10;&#10;            // Duration analysis (only for files with duration data)&#10;            var reportsWithDuration = reports.Where(r =&gt; r.VideoDuration != null).ToList();&#10;&#10;            // Hour-based heatmap data (transfer failures by hour)&#10;            var hourlyFailures = new int[24];&#10;            var hourlyTotal = new int[24];&#10;            foreach (var report in reports)&#10;            {&#10;                int hour = report.FileMetadata.LastModifiedTimeUtc.ToLocalTime().Hour;&#10;                hourlyTotal[hour]++;&#10;                if (report.Status.IsCorrupted)&#10;                    hourlyFailures[hour]++;&#10;            }&#10;            &#10;            // Scatter plot data: file size vs playable percentage (all files)&#10;            var scatterDataCorrupted = reportsWithDuration&#10;                .Where(r =&gt; r.Status.IsCorrupted)&#10;                .Select(r =&gt; new {&#10;                    SizeMB = r.FileMetadata.FileSizeMB,&#10;                    PlayablePercent = r.VideoDuration!.PlayablePercentage,&#10;                    FileName = r.FileMetadata.FileName,&#10;                    IsCorrupted = true&#10;                })&#10;                .ToList();&#10;&#10;            var scatterDataValid = reportsWithDuration&#10;                .Where(r =&gt; !r.Status.IsCorrupted)&#10;                .Select(r =&gt; new {&#10;                    SizeMB = r.FileMetadata.FileSizeMB,&#10;                    PlayablePercent = r.VideoDuration!.PlayablePercentage,&#10;                    FileName = r.FileMetadata.FileName,&#10;                    IsCorrupted = false&#10;                })&#10;                .ToList();&#10;&#10;            var scatterData = scatterDataCorrupted.Concat(scatterDataValid).ToList();&#10;&#10;            // Timeline data: creation vs last modified times&#10;            var timelineData = reports&#10;                .Select(r =&gt; new {&#10;                    FileName = r.FileMetadata.FileName,&#10;                    CreationTime = r.FileMetadata.CreationTimeUtc.ToLocalTime(),&#10;                    LastModifiedTime = r.FileMetadata.LastModifiedTimeUtc.ToLocalTime(),&#10;                    IsCorrupted = r.Status.IsCorrupted,&#10;                    DurationHours = (r.FileMetadata.LastModifiedTimeUtc - r.FileMetadata.CreationTimeUtc).TotalHours&#10;                })&#10;                .OrderBy(x =&gt; x.CreationTime)&#10;                .ToList();&#10;&#10;            // Correlation between file size and corruption&#10;            var fileSizeRanges = new Dictionary&lt;string, (int total, int corrupted)&gt;&#10;            {&#10;                [&quot;0-100 MB&quot;] = (0, 0),&#10;                [&quot;100-500 MB&quot;] = (0, 0),&#10;                [&quot;500 MB-1 GB&quot;] = (0, 0),&#10;                [&quot;1-5 GB&quot;] = (0, 0),&#10;                [&quot;5+ GB&quot;] = (0, 0)&#10;            };&#10;&#10;            foreach (var report in reports)&#10;            {&#10;                double sizeMB = report.FileMetadata.FileSizeMB;&#10;                bool isCorrupted = report.Status.IsCorrupted;&#10;&#10;                string range;&#10;                if (sizeMB &lt; 100) range = &quot;0-100 MB&quot;;&#10;                else if (sizeMB &lt; 500) range = &quot;100-500 MB&quot;;&#10;                else if (sizeMB &lt; 1024) range = &quot;500 MB-1 GB&quot;;&#10;                else if (sizeMB &lt; 5120) range = &quot;1-5 GB&quot;;&#10;                else range = &quot;5+ GB&quot;;&#10;&#10;                var (total, corrupted) = fileSizeRanges[range];&#10;                fileSizeRanges[range] = (total + 1, isCorrupted ? corrupted + 1 : corrupted);&#10;            }&#10;&#10;            // Duration correlation&#10;            var durationRanges = new Dictionary&lt;string, (int total, int corrupted)&gt;&#10;            {&#10;                [&quot;0-1 min&quot;] = (0, 0),&#10;                [&quot;1-5 min&quot;] = (0, 0),&#10;                [&quot;5-15 min&quot;] = (0, 0),&#10;                [&quot;15-30 min&quot;] = (0, 0),&#10;                [&quot;30+ min&quot;] = (0, 0)&#10;            };&#10;&#10;            foreach (var report in reportsWithDuration)&#10;            {&#10;                double durationSec = report.VideoDuration!.TotalDurationSeconds;&#10;                bool isCorrupted = report.Status.IsCorrupted;&#10;&#10;                string range;&#10;                if (durationSec &lt; 60) range = &quot;0-1 min&quot;;&#10;                else if (durationSec &lt; 300) range = &quot;1-5 min&quot;;&#10;                else if (durationSec &lt; 900) range = &quot;5-15 min&quot;;&#10;                else if (durationSec &lt; 1800) range = &quot;15-30 min&quot;;&#10;                else range = &quot;30+ min&quot;;&#10;&#10;                var (total, corrupted) = durationRanges[range];&#10;                durationRanges[range] = (total + 1, isCorrupted ? corrupted + 1 : corrupted);&#10;            }&#10;&#10;            // Generate HTML&#10;            var html = new StringBuilder();&#10;            html.AppendLine(&quot;&lt;!DOCTYPE html&gt;&quot;);&#10;            html.AppendLine(&quot;&lt;html lang=\&quot;en\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;&lt;head&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;meta charset=\&quot;UTF-8\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1.0\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;title&gt;Video Transfer Failure Analysis Dashboard&lt;/title&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;script src=\&quot;https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js\&quot;&gt;&lt;/script&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;style&gt;&quot;);&#10;            html.AppendLine(&quot;        * { margin: 0; padding: 0; box-sizing: border-box; }&quot;);&#10;            html.AppendLine(&quot;        body {&quot;);&#10;            html.AppendLine(&quot;            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;&quot;);&#10;            html.AppendLine(&quot;            background: #0f0f1e;&quot;);&#10;            html.AppendLine(&quot;            color: #e0e0e0;&quot;);&#10;            html.AppendLine(&quot;            padding: 20px;&quot;);&#10;            html.AppendLine(&quot;            min-height: 100vh;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .container {&quot;);&#10;            html.AppendLine(&quot;            max-width: 1600px;&quot;);&#10;            html.AppendLine(&quot;            margin: 0 auto;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .header {&quot;);&#10;            html.AppendLine(&quot;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&quot;);&#10;            html.AppendLine(&quot;            padding: 40px;&quot;);&#10;            html.AppendLine(&quot;            border-radius: 16px;&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 30px;&quot;);&#10;            html.AppendLine(&quot;            box-shadow: 0 10px 50px rgba(102, 126, 234, 0.3);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .header h1 {&quot;);&#10;            html.AppendLine(&quot;            font-size: 2.8em;&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 10px;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 700;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .header .subtitle {&quot;);&#10;            html.AppendLine(&quot;            font-size: 1.2em;&quot;);&#10;            html.AppendLine(&quot;            opacity: 0.95;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .stats-grid {&quot;);&#10;            html.AppendLine(&quot;            display: grid;&quot;);&#10;            html.AppendLine(&quot;            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));&quot;);&#10;            html.AppendLine(&quot;            gap: 20px;&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 30px;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .stat-card {&quot;);&#10;            html.AppendLine(&quot;            background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.04) 100%);&quot;);&#10;            html.AppendLine(&quot;            padding: 25px;&quot;);&#10;            html.AppendLine(&quot;            border-radius: 12px;&quot;);&#10;            html.AppendLine(&quot;            border: 1px solid rgba(255,255,255,0.12);&quot;);&#10;            html.AppendLine(&quot;            backdrop-filter: blur(10px);&quot;);&#10;            html.AppendLine(&quot;            transition: transform 0.2s, box-shadow 0.2s;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .stat-card:hover {&quot;);&#10;            html.AppendLine(&quot;            transform: translateY(-3px);&quot;);&#10;            html.AppendLine(&quot;            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .stat-card .label {&quot;);&#10;            html.AppendLine(&quot;            font-size: 0.85em;&quot;);&#10;            html.AppendLine(&quot;            color: #999;&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 8px;&quot;);&#10;            html.AppendLine(&quot;            text-transform: uppercase;&quot;);&#10;            html.AppendLine(&quot;            letter-spacing: 1.2px;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 600;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .stat-card .value {&quot;);&#10;            html.AppendLine(&quot;            font-size: 2.5em;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 700;&quot;);&#10;            html.AppendLine(&quot;            color: #667eea;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .stat-card.success .value { color: #10b981; }&quot;);&#10;            html.AppendLine(&quot;        .stat-card.error .value { color: #ef4444; }&quot;);&#10;            html.AppendLine(&quot;        .stat-card.warning .value { color: #f59e0b; }&quot;);&#10;            html.AppendLine(&quot;        .charts-grid {&quot;);&#10;            html.AppendLine(&quot;            display: grid;&quot;);&#10;            html.AppendLine(&quot;            grid-template-columns: repeat(auto-fit, minmax(550px, 1fr));&quot;);&#10;            html.AppendLine(&quot;            gap: 25px;&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 30px;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .chart-container {&quot;);&#10;            html.AppendLine(&quot;            background: rgba(255,255,255,0.03);&quot;);&#10;            html.AppendLine(&quot;            padding: 30px;&quot;);&#10;            html.AppendLine(&quot;            border-radius: 12px;&quot;);&#10;            html.AppendLine(&quot;            border: 1px solid rgba(255,255,255,0.08);&quot;);&#10;            html.AppendLine(&quot;            box-shadow: 0 4px 15px rgba(0,0,0,0.2);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .chart-container h2 {&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 20px;&quot;);&#10;            html.AppendLine(&quot;            color: #fff;&quot;);&#10;            html.AppendLine(&quot;            font-size: 1.4em;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 600;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .chart-container canvas {&quot;);&#10;            html.AppendLine(&quot;            max-height: 400px;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .full-width {&quot;);&#10;            html.AppendLine(&quot;            grid-column: 1 / -1;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights {&quot;);&#10;            html.AppendLine(&quot;            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%);&quot;);&#10;            html.AppendLine(&quot;            padding: 35px;&quot;);&#10;            html.AppendLine(&quot;            border-radius: 12px;&quot;);&#10;            html.AppendLine(&quot;            border-left: 5px solid #667eea;&quot;);&#10;            html.AppendLine(&quot;            margin-top: 30px;&quot;);&#10;            html.AppendLine(&quot;            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.2);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights h2 {&quot;);&#10;            html.AppendLine(&quot;            margin-bottom: 20px;&quot;);&#10;            html.AppendLine(&quot;            color: #667eea;&quot;);&#10;            html.AppendLine(&quot;            font-size: 1.8em;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights ul {&quot;);&#10;            html.AppendLine(&quot;            list-style: none;&quot;);&#10;            html.AppendLine(&quot;            padding-left: 0;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights li {&quot;);&#10;            html.AppendLine(&quot;            padding: 12px 0;&quot;);&#10;            html.AppendLine(&quot;            border-bottom: 1px solid rgba(255,255,255,0.1);&quot;);&#10;            html.AppendLine(&quot;            font-size: 1.05em;&quot;);&#10;            html.AppendLine(&quot;            line-height: 1.6;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights li:last-child {&quot;);&#10;            html.AppendLine(&quot;            border-bottom: none;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights li:before {&quot;);&#10;            html.AppendLine(&quot;            content: '▸ ';&quot;);&#10;            html.AppendLine(&quot;            color: #667eea;&quot;);&#10;            html.AppendLine(&quot;            font-weight: bold;&quot;);&#10;            html.AppendLine(&quot;            margin-right: 10px;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .insights .conclusion {&quot;);&#10;            html.AppendLine(&quot;            margin-top: 20px;&quot;);&#10;            html.AppendLine(&quot;            padding: 20px;&quot;);&#10;            html.AppendLine(&quot;            background: rgba(239, 68, 68, 0.15);&quot;);&#10;            html.AppendLine(&quot;            border-left: 4px solid #ef4444;&quot;);&#10;            html.AppendLine(&quot;            border-radius: 8px;&quot;);&#10;            html.AppendLine(&quot;            font-size: 1.1em;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 600;&quot;);&#10;            html.AppendLine(&quot;            color: #fca5a5;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .data-table {&quot;);&#10;            html.AppendLine(&quot;            width: 100%;&quot;);&#10;            html.AppendLine(&quot;            border-collapse: collapse;&quot;);&#10;            html.AppendLine(&quot;            margin-top: 20px;&quot;);&#10;            html.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .data-table th {&quot;);&#10;            html.AppendLine(&quot;            background: rgba(102, 126, 234, 0.2);&quot;);&#10;            html.AppendLine(&quot;            padding: 12px;&quot;);&#10;            html.AppendLine(&quot;            text-align: left;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 600;&quot;);&#10;            html.AppendLine(&quot;            color: #667eea;&quot;);&#10;            html.AppendLine(&quot;            border-bottom: 2px solid rgba(102, 126, 234, 0.5);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .data-table td {&quot;);&#10;            html.AppendLine(&quot;            padding: 10px 12px;&quot;);&#10;            html.AppendLine(&quot;            border-bottom: 1px solid rgba(255,255,255,0.05);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .data-table tr:hover {&quot;);&#10;            html.AppendLine(&quot;            background: rgba(255,255,255,0.03);&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .corrupted-row {&quot;);&#10;            html.AppendLine(&quot;            color: #fca5a5;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .valid-row {&quot;);&#10;            html.AppendLine(&quot;            color: #86efac;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .status-badge {&quot;);&#10;            html.AppendLine(&quot;            padding: 4px 8px;&quot;);&#10;            html.AppendLine(&quot;            border-radius: 4px;&quot;);&#10;            html.AppendLine(&quot;            font-size: 0.85em;&quot;);&#10;            html.AppendLine(&quot;            font-weight: 600;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;        .footer {&quot;);&#10;            html.AppendLine(&quot;            text-align: center;&quot;);&#10;            html.AppendLine(&quot;            margin-top: 50px;&quot;);&#10;            html.AppendLine(&quot;            padding: 20px;&quot;);&#10;            html.AppendLine(&quot;            color: #666;&quot;);&#10;            html.AppendLine(&quot;            font-size: 0.9em;&quot;);&#10;            html.AppendLine(&quot;        }&quot;);&#10;            html.AppendLine(&quot;    &lt;/style&gt;&quot;);&#10;            html.AppendLine(&quot;&lt;/head&gt;&quot;);&#10;            html.AppendLine(&quot;&lt;body&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;div class=\&quot;container\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;        &lt;div class=\&quot;header\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;h1&gt; Video Transfer Failure Analysis Dashboard&lt;/h1&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;div class=\&quot;subtitle\&quot;&gt;Generated on {DateTime.Now:yyyy-MM-dd HH:mm:ss} | Analyzing {totalFiles} video files | MovFileIntegrityChecker v1.0&lt;/div&gt;&quot;);&#10;            html.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;            // Stats cards&#10;            html.AppendLine(&quot;        &lt;div class=\&quot;stats-grid\&quot;&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;div class=\&quot;stat-card\&quot;&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;label\&quot;&gt;Total Files&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;value\&quot;&gt;{totalFiles}&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;div class=\&quot;stat-card success\&quot;&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;label\&quot;&gt;Complete Files&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;value\&quot;&gt;{completeFiles}&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;div class=\&quot;stat-card error\&quot;&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;label\&quot;&gt;Corrupted Files&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;value\&quot;&gt;{corruptedFiles}&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;div class=\&quot;stat-card warning\&quot;&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;label\&quot;&gt;Total Size&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;                &lt;div class=\&quot;value\&quot;&gt;{(totalGB &gt;= 1 ? $&quot;{totalGB:F2} GB&quot; : $&quot;{totalMB:F2} MB&quot;)}&lt;/div&gt;&quot;);&#10;            html.AppendLine($&quot;            &lt;/div&gt;&quot;);&#10;            html.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;            // Charts&#10;            html.AppendLine(&quot;        &lt;div class=\&quot;charts-grid\&quot;&gt;&quot;);&#10;            &#10;            // Complete vs Incomplete pie chart&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;chart-container\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;h2&gt;File Completeness Status&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;canvas id=\&quot;completenessChart\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;            // Corrupted vs Non-corrupted pie chart&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;chart-container\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;h2&gt;File Corruption Status&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;canvas id=\&quot;corruptionChart\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;            // File size vs corruption bar chart&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;chart-container full-width\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;h2&gt;Corruption Rate by File Size&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;canvas id=\&quot;fileSizeChart\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;            // Duration vs corruption bar chart (if data available)&#10;            if (reportsWithDuration.Count &gt; 0)&#10;            {&#10;                html.AppendLine(&quot;            &lt;div class=\&quot;chart-container full-width\&quot;&gt;&quot;);&#10;                html.AppendLine(&quot;                &lt;h2&gt;Corruption Rate by Video Duration&lt;/h2&gt;&quot;);&#10;                html.AppendLine(&quot;                &lt;canvas id=\&quot;durationChart\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;                html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;            }&#10;&#10;            // Heatmap: Transfer failure by hour&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;chart-container full-width\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;h2&gt; Transfer Failure Frequency by Hour (Local Time)&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;canvas id=\&quot;hourlyHeatmap\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;            // Scatter plot: File size vs Playable percentage&#10;            if (scatterData.Count &gt; 0)&#10;            {&#10;                html.AppendLine(&quot;            &lt;div class=\&quot;chart-container\&quot;&gt;&quot;);&#10;                html.AppendLine(&quot;                &lt;h2&gt; File Size vs Playable %&lt;/h2&gt;&quot;);&#10;                html.AppendLine(&quot;                &lt;canvas id=\&quot;scatterSizePlayable\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;                html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;            }&#10;&#10;            // Scatter plot: Last modified hour vs Corruption&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;chart-container\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;h2&gt;⏰ Last Modified Hour vs Corruption Rate&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;canvas id=\&quot;scatterHourCorruption\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;            // Timeline: Creation vs Last Modified&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;chart-container full-width\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;h2&gt; File Creation vs Last Modification Timeline&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;canvas id=\&quot;timelineChart\&quot;&gt;&lt;/canvas&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;&#10;            html.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;            // Data table - show all files sorted by corruption percentage (corrupted first)&#10;            html.AppendLine(&quot;        &lt;div class=\&quot;chart-container\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;h2&gt; Detailed File Analysis&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;table class=\&quot;data-table\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;thead&gt;&quot;);&#10;            html.AppendLine(&quot;                    &lt;tr&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;File Name&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;Size (MB)&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;Duration&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;Playable %&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;Corruption %&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;Last Modified Hour&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                        &lt;th&gt;Status&lt;/th&gt;&quot;);&#10;            html.AppendLine(&quot;                    &lt;/tr&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;/thead&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;tbody&gt;&quot;);&#10;            &#10;            // Add all files to the table, sorted by corruption (corrupted files first, then by corruption %)&#10;            var allFilesForTable = reports&#10;                .OrderByDescending(r =&gt; r.Status.IsCorrupted)&#10;                .ThenByDescending(r =&gt; r.VideoDuration?.CorruptedPercentage ?? 0)&#10;                .ToList();&#10;&#10;            foreach (var report in allFilesForTable)&#10;            {&#10;                var duration = report.VideoDuration?.TotalDurationFormatted ?? &quot;N/A&quot;;&#10;                var playable = report.VideoDuration?.PlayablePercentage.ToString(&quot;F1&quot;) ?? &quot;N/A&quot;;&#10;                var corruption = report.VideoDuration?.CorruptedPercentage.ToString(&quot;F1&quot;) ?? &quot;N/A&quot;;&#10;                var hour = report.FileMetadata.LastModifiedTimeUtc.ToLocalTime().Hour;&#10;                var rowClass = report.Status.IsCorrupted ? &quot;corrupted-row&quot; : &quot;valid-row&quot;;&#10;                var statusBadge = report.Status.IsCorrupted ? &quot;❌ Corrupted&quot; : &quot;✅ Valid&quot;;&#10;                &#10;                html.AppendLine($&quot;                    &lt;tr class=\&quot;{rowClass}\&quot;&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;{System.Security.SecurityElement.Escape(report.FileMetadata.FileName)}&lt;/td&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;{report.FileMetadata.FileSizeMB:F2}&lt;/td&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;{duration}&lt;/td&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;{playable}%&lt;/td&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;{corruption}%&lt;/td&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;{hour:D2}:00&lt;/td&gt;&quot;);&#10;                html.AppendLine($&quot;                        &lt;td&gt;&lt;span class=\&quot;status-badge\&quot;&gt;{statusBadge}&lt;/span&gt;&lt;/td&gt;&quot;);&#10;                html.AppendLine(&quot;                    &lt;/tr&gt;&quot;);&#10;            }&#10;&#10;            html.AppendLine(&quot;                &lt;/tbody&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;/table&gt;&quot;);&#10;            html.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;            // Insights section&#10;            html.AppendLine(&quot;        &lt;div class=\&quot;insights\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;h2&gt; Key Insights &amp; Correlations&lt;/h2&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;ul&gt;&quot;);&#10;&#10;            // Generate insights&#10;            double corruptionRate = (double)corruptedFiles / totalFiles * 100;&#10;            html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;Overall corruption rate:&lt;/strong&gt; {corruptionRate:F1}% ({corruptedFiles} out of {totalFiles} files are corrupted or incomplete)&lt;/li&gt;&quot;);&#10;&#10;            // Hourly analysis - find peak failure times&#10;            var peakHours = hourlyFailures&#10;                .Select((count, hour) =&gt; new { Hour = hour, Count = count, Total = hourlyTotal[hour] })&#10;                .Where(x =&gt; x.Total &gt; 0)&#10;                .OrderByDescending(x =&gt; (double)x.Count / x.Total)&#10;                .Take(3)&#10;                .ToList();&#10;&#10;            if (peakHours.Any())&#10;            {&#10;                var top = peakHours[0];&#10;                double peakRate = (double)top.Count / top.Total * 100;&#10;                if (peakRate &gt; corruptionRate * 1.2) // At least 20% higher than average&#10;                {&#10;                    var timeRanges = peakHours&#10;                        .Where(x =&gt; (double)x.Count / x.Total * 100 &gt; corruptionRate * 1.1)&#10;                        .Select(x =&gt; $&quot;{x.Hour:D2}:00-{(x.Hour + 1) % 24:D2}:00&quot;)&#10;                        .ToList();&#10;                    &#10;                    html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;⚠️ High-risk time window:&lt;/strong&gt; {peakRate:F1}% of files modified at {top.Hour:D2}:00-{(top.Hour + 1) % 24:D2}:00 are corrupted (peak failure time)&lt;/li&gt;&quot;);&#10;                    &#10;                    if (timeRanges.Count &gt; 1)&#10;                    {&#10;                        html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;Additional risk windows:&lt;/strong&gt; {string.Join(&quot;, &quot;, timeRanges.Skip(1))}&lt;/li&gt;&quot;);&#10;                    }&#10;                }&#10;            }&#10;&#10;            // Find highest risk file size range&#10;            var highestRiskSize = fileSizeRanges&#10;                .Where(kvp =&gt; kvp.Value.total &gt; 0)&#10;                .OrderByDescending(kvp =&gt; (double)kvp.Value.corrupted / kvp.Value.total)&#10;                .FirstOrDefault();&#10;            &#10;            if (highestRiskSize.Key != null)&#10;            {&#10;                double riskRate = (double)highestRiskSize.Value.corrupted / highestRiskSize.Value.total * 100;&#10;                html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;File size correlation:&lt;/strong&gt; {highestRiskSize.Key} range shows highest corruption risk at {riskRate:F1}%&lt;/li&gt;&quot;);&#10;            }&#10;&#10;            // Find highest risk duration range&#10;            if (reportsWithDuration.Count &gt; 0)&#10;            {&#10;                var highestRiskDuration = durationRanges&#10;                    .Where(kvp =&gt; kvp.Value.total &gt; 0)&#10;                    .OrderByDescending(kvp =&gt; (double)kvp.Value.corrupted / kvp.Value.total)&#10;                    .FirstOrDefault();&#10;                &#10;                if (highestRiskDuration.Key != null)&#10;                {&#10;                    double riskRate = (double)highestRiskDuration.Value.corrupted / highestRiskDuration.Value.total * 100;&#10;                    html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;Duration correlation:&lt;/strong&gt; {highestRiskDuration.Key} videos have {riskRate:F1}% corruption rate&lt;/li&gt;&quot;);&#10;                }&#10;            }&#10;&#10;            // Average playable percentage for corrupted files&#10;            var corruptedWithDuration = reportsWithDuration.Where(r =&gt; r.Status.IsCorrupted).ToList();&#10;            if (corruptedWithDuration.Count &gt; 0)&#10;            {&#10;                double avgPlayable = corruptedWithDuration.Average(r =&gt; r.VideoDuration!.PlayablePercentage);&#10;                html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;Data recovery potential:&lt;/strong&gt; Corrupted files retain {avgPlayable:F1}% playable content on average&lt;/li&gt;&quot;);&#10;            }&#10;&#10;            // Transfer interruption patterns&#10;            var abruptStops = timelineData&#10;                .Where(x =&gt; x.IsCorrupted &amp;&amp; x.DurationHours &lt; 1)&#10;                .Count();&#10;            &#10;            if (abruptStops &gt; 0)&#10;            {&#10;                double abruptRate = (double)abruptStops / corruptedFiles * 100;&#10;                html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;Transfer interruption pattern:&lt;/strong&gt; {abruptRate:F1}% of corrupted files show signs of abrupt transfer termination (modified within 1 hour of creation)&lt;/li&gt;&quot;);&#10;            }&#10;&#10;            // Most common issues&#10;            var allIssues = reports&#10;                .SelectMany(r =&gt; r.IntegrityAnalysis.Issues)&#10;                .Where(i =&gt; !string.IsNullOrEmpty(i))&#10;                .GroupBy(i =&gt; i.Contains(&quot;Incomplete atom&quot;) ? &quot;Incomplete atom&quot; : &#10;                              i.Contains(&quot;Missing&quot;) ? &quot;Missing atom&quot; : &#10;                              i.Contains(&quot;Gap&quot;) ? &quot;Gap after last atom&quot; : i)&#10;                .OrderByDescending(g =&gt; g.Count())&#10;                .Take(3)&#10;                .ToList();&#10;&#10;            if (allIssues.Count &gt; 0)&#10;            {&#10;                html.AppendLine($&quot;                &lt;li&gt;&lt;strong&gt;Most common structural issue:&lt;/strong&gt; \&quot;{allIssues[0].Key}\&quot; detected in {allIssues[0].Count()} files ({(double)allIssues[0].Count() / totalFiles * 100:F1}%)&lt;/li&gt;&quot;);&#10;            }&#10;&#10;            html.AppendLine(&quot;            &lt;/ul&gt;&quot;);&#10;&#10;            // Root cause conclusion&#10;            html.AppendLine(&quot;            &lt;div class=\&quot;conclusion\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;                &lt;strong&gt; Likely Root Cause:&lt;/strong&gt; &quot;);&#10;            &#10;            // Determine likely cause based on patterns&#10;            if (peakHours.Any() &amp;&amp; (double)peakHours[0].Count / peakHours[0].Total * 100 &gt; corruptionRate * 1.5)&#10;            {&#10;                var topHour = peakHours[0].Hour;&#10;                if (topHour &gt;= 2 &amp;&amp; topHour &lt;= 5)&#10;                {&#10;                    html.AppendLine(&quot;                Scheduled server maintenance or automatic shutdown during nightly hours (03:00-05:00) is likely interrupting ongoing file transfers.&quot;);&#10;                }&#10;                else if (topHour &gt;= 12 &amp;&amp; topHour &lt;= 14)&#10;                {&#10;                    html.AppendLine(&quot;                Network congestion or server load during peak hours (12:00-14:00) may be causing transfer timeouts and incomplete file writes.&quot;);&#10;                }&#10;                else&#10;                {&#10;                    html.AppendLine($&quot;                Systematic failures occur predominantly at {topHour:D2}:00-{(topHour + 1) % 24:D2}:00, suggesting scheduled operations or resource constraints during this time window.&quot;);&#10;                }&#10;            }&#10;            else if (highestRiskSize.Key != null &amp;&amp; highestRiskSize.Key.Contains(&quot;GB&quot;))&#10;            {&#10;                html.AppendLine(&quot;                Larger files are disproportionately affected, indicating network timeout issues or insufficient buffer sizes for large file transfers.&quot;);&#10;            }&#10;            else&#10;            {&#10;                html.AppendLine(&quot;                File transfers are being interrupted before completion, likely due to network instability, storage issues, or application crashes during write operations.&quot;);&#10;            }&#10;            &#10;            html.AppendLine(&quot;            &lt;/div&gt;&quot;);&#10;            html.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;&#10;            // Footer&#10;            html.AppendLine(&quot;        &lt;div class=\&quot;footer\&quot;&gt;&quot;);&#10;            html.AppendLine(&quot;            &lt;p&gt;Generated by MovFileIntegrityChecker v1.0&lt;/p&gt;&quot;);&#10;            html.AppendLine(&quot;        &lt;/div&gt;&quot;);&#10;            html.AppendLine(&quot;    &lt;/div&gt;&quot;);&#10;&#10;            // Chart.js scripts&#10;            html.AppendLine(&quot;    &lt;script&gt;&quot;);&#10;            html.AppendLine(&quot;        Chart.defaults.color = '#ffffff';&quot;);&#10;            html.AppendLine(&quot;        Chart.defaults.borderColor = 'rgba(255,255,255,0.1)';&quot;);&#10;&#10;            // Completeness chart&#10;            html.AppendLine(&quot;        new Chart(document.getElementById('completenessChart'), {&quot;);&#10;            html.AppendLine(&quot;            type: 'pie',&quot;);&#10;            html.AppendLine(&quot;            data: {&quot;);&#10;            html.AppendLine($&quot;                labels: ['Complete ({completeFiles})', 'Incomplete ({incompleteFiles})'],&quot;);&#10;            html.AppendLine(&quot;                datasets: [{&quot;);&#10;            html.AppendLine($&quot;                    data: [{completeFiles}, {incompleteFiles}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: ['#10b981', '#ef4444'],&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 2,&quot;);&#10;            html.AppendLine(&quot;                    borderColor: '#1a1a2e'&quot;);&#10;            html.AppendLine(&quot;                }]&quot;);&#10;            html.AppendLine(&quot;            },&quot;);&#10;            html.AppendLine(&quot;            options: {&quot;);&#10;            html.AppendLine(&quot;                responsive: true,&quot;);&#10;            html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;            html.AppendLine(&quot;                plugins: {&quot;);&#10;            html.AppendLine(&quot;                    legend: { position: 'bottom' }&quot;);&#10;            html.AppendLine(&quot;                }&quot;);&#10;            html.AppendLine(&quot;            }&quot;);&#10;            html.AppendLine(&quot;        });&quot;);&#10;&#10;            // Corruption chart&#10;            int nonCorrupted = totalFiles - corruptedFiles;&#10;            html.AppendLine(&quot;        new Chart(document.getElementById('corruptionChart'), {&quot;);&#10;            html.AppendLine(&quot;            type: 'pie',&quot;);&#10;            html.AppendLine(&quot;            data: {&quot;);&#10;            html.AppendLine($&quot;                labels: ['Valid ({nonCorrupted})', 'Corrupted ({corruptedFiles})'],&quot;);&#10;            html.AppendLine(&quot;                datasets: [{&quot;);&#10;            html.AppendLine($&quot;                    data: [{nonCorrupted}, {corruptedFiles}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: ['#10b981', '#ef4444'],&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 2,&quot;);&#10;            html.AppendLine(&quot;                    borderColor: '#1a1a2e'&quot;);&#10;            html.AppendLine(&quot;                }]&quot;);&#10;            html.AppendLine(&quot;            },&quot;);&#10;            html.AppendLine(&quot;            options: {&quot;);&#10;            html.AppendLine(&quot;                responsive: true,&quot;);&#10;            html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;            html.AppendLine(&quot;                plugins: {&quot;);&#10;            html.AppendLine(&quot;                    legend: { position: 'bottom' }&quot;);&#10;            html.AppendLine(&quot;                }&quot;);&#10;            html.AppendLine(&quot;            }&quot;);&#10;            html.AppendLine(&quot;        });&quot;);&#10;&#10;            // File size chart&#10;            var sizeLabels = string.Join(&quot;, &quot;, fileSizeRanges.Keys.Select(k =&gt; $&quot;'{k}'&quot;));&#10;            var sizeTotals = string.Join(&quot;, &quot;, fileSizeRanges.Values.Select(v =&gt; v.total));&#10;            var sizeCorrupted = string.Join(&quot;, &quot;, fileSizeRanges.Values.Select(v =&gt; v.corrupted));&#10;            var sizePercentages = string.Join(&quot;, &quot;, fileSizeRanges.Values.Select(v =&gt; &#10;                v.total &gt; 0 ? ((double)v.corrupted / v.total * 100).ToString(&quot;F1&quot;) : &quot;0&quot;));&#10;&#10;            html.AppendLine(&quot;        new Chart(document.getElementById('fileSizeChart'), {&quot;);&#10;            html.AppendLine(&quot;            type: 'bar',&quot;);&#10;            html.AppendLine(&quot;            data: {&quot;);&#10;            html.AppendLine($&quot;                labels: [{sizeLabels}],&quot;);&#10;            html.AppendLine(&quot;                datasets: [{&quot;);&#10;            html.AppendLine(&quot;                    label: 'Total Files',&quot;);&#10;            html.AppendLine($&quot;                    data: [{sizeTotals}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(102, 126, 234, 0.6)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(102, 126, 234, 1)',&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;            html.AppendLine(&quot;                }, {&quot;);&#10;            html.AppendLine(&quot;                    label: 'Corrupted Files',&quot;);&#10;            html.AppendLine($&quot;                    data: [{sizeCorrupted}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(239, 68, 68, 0.6)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(239, 68, 68, 1)',&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;            html.AppendLine(&quot;                }]&quot;);&#10;            html.AppendLine(&quot;            },&quot;);&#10;            html.AppendLine(&quot;            options: {&quot;);&#10;            html.AppendLine(&quot;                responsive: true,&quot;);&#10;            html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;            html.AppendLine(&quot;                scales: {&quot;);&#10;            html.AppendLine(&quot;                    y: { beginAtZero: true }&quot;);&#10;            html.AppendLine(&quot;                },&quot;);&#10;            html.AppendLine(&quot;                plugins: {&quot;);&#10;            html.AppendLine(&quot;                    legend: { position: 'top' },&quot;);&#10;            html.AppendLine(&quot;                    tooltip: {&quot;);&#10;            html.AppendLine(&quot;                        callbacks: {&quot;);&#10;            html.AppendLine(&quot;                            afterLabel: function(context) {&quot;);&#10;            html.AppendLine($&quot;                                const percentages = [{sizePercentages}];&quot;);&#10;            html.AppendLine(&quot;                                if (context.datasetIndex === 1) {&quot;);&#10;            html.AppendLine(&quot;                                    return 'Corruption Rate: ' + percentages[context.dataIndex] + '%';&quot;);&#10;            html.AppendLine(&quot;                                }&quot;);&#10;            html.AppendLine(&quot;                            }&quot;);&#10;            html.AppendLine(&quot;                        }&quot;);&#10;            html.AppendLine(&quot;                    }&quot;);&#10;            html.AppendLine(&quot;                }&quot;);&#10;            html.AppendLine(&quot;            }&quot;);&#10;            html.AppendLine(&quot;        });&quot;);&#10;&#10;            // Duration chart (if data available)&#10;            if (reportsWithDuration.Count &gt; 0)&#10;            {&#10;                var durationLabels = string.Join(&quot;, &quot;, durationRanges.Keys.Select(k =&gt; $&quot;'{k}'&quot;));&#10;                var durationTotals = string.Join(&quot;, &quot;, durationRanges.Values.Select(v =&gt; v.total));&#10;                var durationCorrupted = string.Join(&quot;, &quot;, durationRanges.Values.Select(v =&gt; v.corrupted));&#10;                var durationPercentages = string.Join(&quot;, &quot;, durationRanges.Values.Select(v =&gt; &#10;                    v.total &gt; 0 ? ((double)v.corrupted / v.total * 100).ToString(&quot;F1&quot;) : &quot;0&quot;));&#10;&#10;                html.AppendLine(&quot;        new Chart(document.getElementById('durationChart'), {&quot;);&#10;                html.AppendLine(&quot;            type: 'bar',&quot;);&#10;                html.AppendLine(&quot;            data: {&quot;);&#10;                html.AppendLine($&quot;                labels: [{durationLabels}],&quot;);&#10;                html.AppendLine(&quot;                datasets: [{&quot;);&#10;                html.AppendLine(&quot;                    label: 'Total Files',&quot;);&#10;                html.AppendLine($&quot;                    data: [{durationTotals}],&quot;);&#10;                html.AppendLine(&quot;                    backgroundColor: 'rgba(102, 126, 234, 0.6)',&quot;);&#10;                html.AppendLine(&quot;                    borderColor: 'rgba(102, 126, 234, 1)',&quot;);&#10;                html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;                html.AppendLine(&quot;                }, {&quot;);&#10;                html.AppendLine(&quot;                    label: 'Corrupted Files',&quot;);&#10;                html.AppendLine($&quot;                    data: [{durationCorrupted}],&quot;);&#10;                html.AppendLine(&quot;                    backgroundColor: 'rgba(239, 68, 68, 0.6)',&quot;);&#10;                html.AppendLine(&quot;                    borderColor: 'rgba(239, 68, 68, 1)',&quot;);&#10;                html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;                html.AppendLine(&quot;                }]&quot;);&#10;                html.AppendLine(&quot;            },&quot;);&#10;                html.AppendLine(&quot;            options: {&quot;);&#10;                html.AppendLine(&quot;                responsive: true,&quot;);&#10;                html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;                html.AppendLine(&quot;                scales: {&quot;);&#10;                html.AppendLine(&quot;                    y: { beginAtZero: true }&quot;);&#10;                html.AppendLine(&quot;                },&quot;);&#10;                html.AppendLine(&quot;                plugins: {&quot;);&#10;                html.AppendLine(&quot;                    legend: { position: 'top' },&quot;);&#10;                html.AppendLine(&quot;                    tooltip: {&quot;);&#10;                html.AppendLine(&quot;                        callbacks: {&quot;);&#10;                html.AppendLine(&quot;                            afterLabel: function(context) {&quot;);&#10;                html.AppendLine($&quot;                                const percentages = [{durationPercentages}];&quot;);&#10;                html.AppendLine(&quot;                                if (context.datasetIndex === 1) {&quot;);&#10;                html.AppendLine(&quot;                                    return 'Corruption Rate: ' + percentages[context.dataIndex] + '%';&quot;);&#10;                html.AppendLine(&quot;                                }&quot;);&#10;                html.AppendLine(&quot;                            }&quot;);&#10;                html.AppendLine(&quot;                        }&quot;);&#10;                html.AppendLine(&quot;                    }&quot;);&#10;                html.AppendLine(&quot;                }&quot;);&#10;                html.AppendLine(&quot;            }&quot;);&#10;                html.AppendLine(&quot;        });&quot;);&#10;            }&#10;&#10;            // Hourly heatmap&#10;            var hourLabels = string.Join(&quot;, &quot;, Enumerable.Range(0, 24).Select(h =&gt; $&quot;'{h:D2}:00'&quot;));&#10;            var hourFailureData = string.Join(&quot;, &quot;, hourlyFailures);&#10;            var hourTotalData = string.Join(&quot;, &quot;, hourlyTotal);&#10;            var hourPercentages = string.Join(&quot;, &quot;, hourlyTotal.Select((total, i) =&gt; &#10;                total &gt; 0 ? ((double)hourlyFailures[i] / total * 100).ToString(&quot;F1&quot;) : &quot;0&quot;));&#10;&#10;            html.AppendLine(&quot;        new Chart(document.getElementById('hourlyHeatmap'), {&quot;);&#10;            html.AppendLine(&quot;            type: 'bar',&quot;);&#10;            html.AppendLine(&quot;            data: {&quot;);&#10;            html.AppendLine($&quot;                labels: [{hourLabels}],&quot;);&#10;            html.AppendLine(&quot;                datasets: [{&quot;);&#10;            html.AppendLine(&quot;                    label: 'Total Files Modified',&quot;);&#10;            html.AppendLine($&quot;                    data: [{hourTotalData}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(102, 126, 234, 0.5)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(102, 126, 234, 1)',&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;            html.AppendLine(&quot;                }, {&quot;);&#10;            html.AppendLine(&quot;                    label: 'Failed/Corrupted Files',&quot;);&#10;            html.AppendLine($&quot;                    data: [{hourFailureData}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(239, 68, 68, 0.7)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(239, 68, 68, 1)',&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;            html.AppendLine(&quot;                }]&quot;);&#10;            html.AppendLine(&quot;            },&quot;);&#10;            html.AppendLine(&quot;            options: {&quot;);&#10;            html.AppendLine(&quot;                responsive: true,&quot;);&#10;            html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;            html.AppendLine(&quot;                scales: {&quot;);&#10;            html.AppendLine(&quot;                    y: { beginAtZero: true, title: { display: true, text: 'Number of Files' } },&quot;);&#10;            html.AppendLine(&quot;                    x: { title: { display: true, text: 'Hour of Day (Local Time)' } }&quot;);&#10;            html.AppendLine(&quot;                },&quot;);&#10;            html.AppendLine(&quot;                plugins: {&quot;);&#10;            html.AppendLine(&quot;                    legend: { position: 'top' },&quot;);&#10;            html.AppendLine(&quot;                    tooltip: {&quot;);&#10;            html.AppendLine(&quot;                        callbacks: {&quot;);&#10;            html.AppendLine(&quot;                            afterLabel: function(context) {&quot;);&#10;            html.AppendLine($&quot;                                const percentages = [{hourPercentages}];&quot;);&#10;            html.AppendLine(&quot;                                if (context.datasetIndex === 1) {&quot;);&#10;            html.AppendLine(&quot;                                    return 'Failure Rate: ' + percentages[context.dataIndex] + '%';&quot;);&#10;            html.AppendLine(&quot;                                }&quot;);&#10;            html.AppendLine(&quot;                            }&quot;);&#10;            html.AppendLine(&quot;                        }&quot;);&#10;            html.AppendLine(&quot;                    }&quot;);&#10;            html.AppendLine(&quot;                }&quot;);&#10;            html.AppendLine(&quot;            }&quot;);&#10;            html.AppendLine(&quot;        });&quot;);&#10;&#10;            // Scatter plot: File Size vs Playable %&#10;            if (scatterData.Count &gt; 0)&#10;            {&#10;                var scatterPointsCorrupted = string.Join(&quot;, &quot;, scatterDataCorrupted.Select(d =&gt; &#10;                    $&quot;{{x: {d.SizeMB.ToString(&quot;F2&quot;, CultureInfo.InvariantCulture)}, y: {d.PlayablePercent.ToString(&quot;F2&quot;, CultureInfo.InvariantCulture)}, label: '{System.Security.SecurityElement.Escape(d.FileName)}'}}&quot;));&#10;                &#10;                var scatterPointsValid = string.Join(&quot;, &quot;, scatterDataValid.Select(d =&gt; &#10;                    $&quot;{{x: {d.SizeMB.ToString(&quot;F2&quot;, CultureInfo.InvariantCulture)}, y: {d.PlayablePercent.ToString(&quot;F2&quot;, CultureInfo.InvariantCulture)}, label: '{System.Security.SecurityElement.Escape(d.FileName)}'}}&quot;));&#10;&#10;                html.AppendLine(&quot;        new Chart(document.getElementById('scatterSizePlayable'), {&quot;);&#10;                html.AppendLine(&quot;            type: 'scatter',&quot;);&#10;                html.AppendLine(&quot;            data: {&quot;);&#10;                html.AppendLine(&quot;                datasets: [{&quot;);&#10;                html.AppendLine(&quot;                    label: 'Valid Files (100% Playable)',&quot;);&#10;                html.AppendLine($&quot;                    data: [{scatterPointsValid}],&quot;);&#10;                html.AppendLine(&quot;                    backgroundColor: 'rgba(16, 185, 129, 0.6)',&quot;);&#10;                html.AppendLine(&quot;                    borderColor: 'rgba(16, 185, 129, 1)',&quot;);&#10;                html.AppendLine(&quot;                    borderWidth: 1,&quot;);&#10;                html.AppendLine(&quot;                    pointRadius: 6,&quot;);&#10;                html.AppendLine(&quot;                    pointHoverRadius: 8&quot;);&#10;                html.AppendLine(&quot;                }, {&quot;);&#10;                html.AppendLine(&quot;                    label: 'Corrupted Files',&quot;);&#10;                html.AppendLine($&quot;                    data: [{scatterPointsCorrupted}],&quot;);&#10;                html.AppendLine(&quot;                    backgroundColor: 'rgba(239, 68, 68, 0.6)',&quot;);&#10;                html.AppendLine(&quot;                    borderColor: 'rgba(239, 68, 68, 1)',&quot;);&#10;                html.AppendLine(&quot;                    borderWidth: 1,&quot;);&#10;                html.AppendLine(&quot;                    pointRadius: 6,&quot;);&#10;                html.AppendLine(&quot;                    pointHoverRadius: 8&quot;);&#10;                html.AppendLine(&quot;                }]&quot;);&#10;                html.AppendLine(&quot;            },&quot;);&#10;                html.AppendLine(&quot;            options: {&quot;);&#10;                html.AppendLine(&quot;                responsive: true,&quot;);&#10;                html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;                html.AppendLine(&quot;                scales: {&quot;);&#10;                html.AppendLine(&quot;                    x: { title: { display: true, text: 'File Size (MB)' }, beginAtZero: true },&quot;);&#10;                html.AppendLine(&quot;                    y: { title: { display: true, text: 'Playable Percentage (%)' }, beginAtZero: true, max: 100 }&quot;);&#10;                html.AppendLine(&quot;                },&quot;);&#10;                html.AppendLine(&quot;                plugins: {&quot;);&#10;                html.AppendLine(&quot;                    legend: { display: true, position: 'top' },&quot;);&#10;                html.AppendLine(&quot;                    tooltip: {&quot;);&#10;                html.AppendLine(&quot;                        callbacks: {&quot;);&#10;                html.AppendLine(&quot;                            label: function(context) {&quot;);&#10;                html.AppendLine(&quot;                                return context.raw.label + ': ' + context.parsed.y.toFixed(1) + '% playable';&quot;);&#10;                html.AppendLine(&quot;                            }&quot;);&#10;                html.AppendLine(&quot;                        }&quot;);&#10;                html.AppendLine(&quot;                    }&quot;);&#10;                html.AppendLine(&quot;                }&quot;);&#10;                html.AppendLine(&quot;            }&quot;);&#10;                html.AppendLine(&quot;        });&quot;);&#10;            }&#10;&#10;            // Scatter plot: Last Modified Hour vs Corruption&#10;            var hourCorruptionData = reports&#10;                .GroupBy(r =&gt; r.FileMetadata.LastModifiedTimeUtc.ToLocalTime().Hour)&#10;                .Select(g =&gt; new {&#10;                    Hour = g.Key,&#10;                    Total = g.Count(),&#10;                    Corrupted = g.Count(r =&gt; r.Status.IsCorrupted),&#10;                    Rate = g.Count() &gt; 0 ? (double)g.Count(r =&gt; r.Status.IsCorrupted) / g.Count() * 100 : 0&#10;                })&#10;                .ToList();&#10;&#10;            var hourScatterPoints = string.Join(&quot;, &quot;, hourCorruptionData.Select(d =&gt; &#10;                $&quot;{{x: {d.Hour}, y: {d.Rate.ToString(&quot;F2&quot;, CultureInfo.InvariantCulture)}, r: {Math.Max(5, d.Total * 2)}}}&quot;));&#10;&#10;            html.AppendLine(&quot;        new Chart(document.getElementById('scatterHourCorruption'), {&quot;);&#10;            html.AppendLine(&quot;            type: 'bubble',&quot;);&#10;            html.AppendLine(&quot;            data: {&quot;);&#10;            html.AppendLine($&quot;                datasets: [{{&quot;);&#10;            html.AppendLine(&quot;                    label: 'Corruption Rate by Hour',&quot;);&#10;            html.AppendLine($&quot;                    data: [{hourScatterPoints}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(245, 158, 11, 0.5)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(245, 158, 11, 1)',&quot;);&#10;            html.AppendLine(&quot;                    borderWidth: 1&quot;);&#10;            html.AppendLine(&quot;                }]&quot;);&#10;            html.AppendLine(&quot;            },&quot;);&#10;            html.AppendLine(&quot;            options: {&quot;);&#10;            html.AppendLine(&quot;                responsive: true,&quot;);&#10;            html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;            html.AppendLine(&quot;                scales: {&quot;);&#10;            html.AppendLine(&quot;                    x: { title: { display: true, text: 'Hour of Day (0-23)' }, min: 0, max: 23, ticks: { stepSize: 1 } },&quot;);&#10;            html.AppendLine(&quot;                    y: { title: { display: true, text: 'Corruption Rate (%)' }, beginAtZero: true, max: 100 }&quot;);&#10;            html.AppendLine(&quot;                },&quot;);&#10;            html.AppendLine(&quot;                plugins: {&quot;);&#10;            html.AppendLine(&quot;                    legend: { display: false },&quot;);&#10;            html.AppendLine(&quot;                    tooltip: {&quot;);&#10;            html.AppendLine(&quot;                        callbacks: {&quot;);&#10;            html.AppendLine(&quot;                            label: function(context) {&quot;);&#10;            html.AppendLine(&quot;                                return 'Hour ' + context.parsed.x + ':00 - ' + context.parsed.y.toFixed(1) + '% corruption rate';&quot;);&#10;            html.AppendLine(&quot;                            }&quot;);&#10;            html.AppendLine(&quot;                        }&quot;);&#10;            html.AppendLine(&quot;                    }&quot;);&#10;            html.AppendLine(&quot;                }&quot;);&#10;            html.AppendLine(&quot;            }&quot;);&#10;            html.AppendLine(&quot;        });&quot;);&#10;&#10;            // Timeline chart: Creation vs Last Modified&#10;            var timelineCreationData = string.Join(&quot;, &quot;, timelineData.Select(t =&gt; &#10;                $&quot;{{x: '{t.CreationTime:yyyy-MM-dd HH:mm}', y: 1}}&quot;));&#10;            var timelineModifiedData = string.Join(&quot;, &quot;, timelineData.Where(t =&gt; t.IsCorrupted).Select(t =&gt; &#10;                $&quot;{{x: '{t.LastModifiedTime:yyyy-MM-dd HH:mm}', y: 2}}&quot;));&#10;&#10;            html.AppendLine(&quot;        new Chart(document.getElementById('timelineChart'), {&quot;);&#10;            html.AppendLine(&quot;            type: 'scatter',&quot;);&#10;            html.AppendLine(&quot;            data: {&quot;);&#10;            html.AppendLine(&quot;                datasets: [{&quot;);&#10;            html.AppendLine(&quot;                    label: 'File Creation Time',&quot;);&#10;            html.AppendLine($&quot;                    data: [{timelineCreationData}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(16, 185, 129, 0.6)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(16, 185, 129, 1)',&quot;);&#10;            html.AppendLine(&quot;                    pointRadius: 4,&quot;);&#10;            html.AppendLine(&quot;                    showLine: false&quot;);&#10;            html.AppendLine(&quot;                }, {&quot;);&#10;            html.AppendLine(&quot;                    label: 'Last Modified (Corrupted Files)',&quot;);&#10;            html.AppendLine($&quot;                    data: [{timelineModifiedData}],&quot;);&#10;            html.AppendLine(&quot;                    backgroundColor: 'rgba(239, 68, 68, 0.6)',&quot;);&#10;            html.AppendLine(&quot;                    borderColor: 'rgba(239, 68, 68, 1)',&quot;);&#10;            html.AppendLine(&quot;                    pointRadius: 4,&quot;);&#10;            html.AppendLine(&quot;                    showLine: false&quot;);&#10;            html.AppendLine(&quot;                }]&quot;);&#10;            html.AppendLine(&quot;            },&quot;);&#10;            html.AppendLine(&quot;            options: {&quot;);&#10;            html.AppendLine(&quot;                responsive: true,&quot;);&#10;            html.AppendLine(&quot;                maintainAspectRatio: true,&quot;);&#10;            html.AppendLine(&quot;                scales: {&quot;);&#10;            html.AppendLine(&quot;                    x: { type: 'time', time: { unit: 'day' }, title: { display: true, text: 'Date &amp; Time' } },&quot;);&#10;            html.AppendLine(&quot;                    y: { display: false, min: 0, max: 3 }&quot;);&#10;            html.AppendLine(&quot;                },&quot;);&#10;            html.AppendLine(&quot;                plugins: {&quot;);&#10;            html.AppendLine(&quot;                    legend: { position: 'top' },&quot;);&#10;            html.AppendLine(&quot;                    tooltip: {&quot;);&#10;            html.AppendLine(&quot;                        callbacks: {&quot;);&#10;            html.AppendLine(&quot;                            label: function(context) {&quot;);&#10;            html.AppendLine(&quot;                                return context.dataset.label + ': ' + context.parsed.x;&quot;);&#10;            html.AppendLine(&quot;                            }&quot;);&#10;            html.AppendLine(&quot;                        }&quot;);&#10;            html.AppendLine(&quot;                    }&quot;);&#10;            html.AppendLine(&quot;                }&quot;);&#10;            html.AppendLine(&quot;            }&quot;);&#10;            html.AppendLine(&quot;        });&quot;);&#10;&#10;            html.AppendLine(&quot;    &lt;/script&gt;&quot;);&#10;            html.AppendLine(&quot;&lt;/body&gt;&quot;);&#10;            html.AppendLine(&quot;&lt;/html&gt;&quot;);&#10;&#10;            // Save the report&#10;            string reportPath = Path.Combine(outputDir, $&quot;global-report-{DateTime.Now:yyyyMMdd-HHmmss}.html&quot;);&#10;            File.WriteAllText(reportPath, html.ToString(), Encoding.UTF8);&#10;&#10;            WriteSuccess($&quot;\n✅ Global analysis report generated successfully!&quot;);&#10;            WriteSuccess($&quot; Report location: {reportPath}\n&quot;);&#10;&#10;            // Try to open the report in the default browser&#10;            try&#10;            {&#10;                Process.Start(new ProcessStartInfo&#10;                {&#10;                    FileName = reportPath,&#10;                    UseShellExecute = true&#10;                });&#10;                WriteInfo(&quot;Opening report in your default browser...\n&quot;);&#10;            }&#10;            catch&#10;            {&#10;                WriteWarning(&quot;Could not open report automatically. Please open it manually.\n&quot;);&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>